{"version":2,"kind":"Notebook","sha256":"8e44f2f30a13fd16e9caf530c0632c1c3952d54d8526d1ecb0af515332989f2e","slug":"modelos","location":"/notebooks/2_modelos.ipynb","dependencies":[],"frontmatter":{"title":"2. Preprocesamiento de datos y Modelados","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"gpu_venv","language":"python"},"authors":[{"nameParsed":{"literal":"Juan Aguirre","given":"Juan","family":"Aguirre"},"name":"Juan Aguirre","id":"contributors-Users\\taran\\OneDrive\\Documents\\uni\\machin\\miniprojects\\RF-XGB\\Prediccion_BusinessChurnMLOPS_GDHMMJA\\docs\\myst-generated-uid-0"},{"nameParsed":{"literal":"Mariangel Mercado","given":"Mariangel","family":"Mercado"},"name":"Mariangel Mercado","id":"contributors-Users\\taran\\OneDrive\\Documents\\uni\\machin\\miniprojects\\RF-XGB\\Prediccion_BusinessChurnMLOPS_GDHMMJA\\docs\\myst-generated-uid-1"},{"nameParsed":{"literal":"Guirlessa de la Hoz","given":"Guirlessa","non_dropping_particle":"de la","family":"Hoz"},"name":"Guirlessa de la Hoz","id":"contributors-Users\\taran\\OneDrive\\Documents\\uni\\machin\\miniprojects\\RF-XGB\\Prediccion_BusinessChurnMLOPS_GDHMMJA\\docs\\myst-generated-uid-2"}],"github":"https://github.com/juantellas","keywords":["Churn","Telecomunicaciones","Machine Learning","Predicción"],"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"2_modelos.ipynb","url":"/2_modelos-4b3b4817420e05941b02bbaa63c6395b.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"En esta seccion, vamos a empezar haciendo el preprocesado de los datos finales, y posteriormente modelando los diferentes modelos, con diferentes modificaciones en cada etapa.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VoglbqiJAU"}],"key":"ZUoeQIdUZN"}],"key":"lcdtYd2MJH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.1 Modelos benchmark (RandomForest, XGboost, CatBoost, LightGBM)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"v3NbsqcK7z"}],"key":"BPr69NMLmX"}],"identifier":"id-2-1-modelos-benchmark-randomforest-xgboost-catboost-lightgbm","label":"2.1 Modelos benchmark (RandomForest, XGboost, CatBoost, LightGBM)","html_id":"id-2-1-modelos-benchmark-randomforest-xgboost-catboost-lightgbm","implicit":true,"key":"srfwgYskeP"}],"key":"Qba4LcOuuQ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Antes de todo, vamos a empezar importando las librerias que usaremos.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kpjuO2qCzk"}],"key":"cjVvFiX6vc"}],"key":"FGdqNUZwFE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport numpy as np\nimport time\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nfrom sklearn.model_selection import train_test_split, GridSearchCV, StratifiedKFold\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.metrics import (\n    classification_report, ConfusionMatrixDisplay, RocCurveDisplay,\n    accuracy_score, recall_score, precision_score, f1_score, roc_auc_score\n)\n\nfrom sklearn.ensemble import RandomForestClassifier\nfrom xgboost import XGBClassifier\nfrom catboost import CatBoostClassifier\nfrom catboost.utils import get_gpu_device_count\n\nfrom lightgbm import LGBMClassifier\n\nfrom sklearn.metrics import (\n    confusion_matrix, ConfusionMatrixDisplay,\n    roc_curve, auc, classification_report\n)\n\nfrom imblearn.over_sampling import SMOTE\nimport joblib\nimport pikl","key":"bAEkm1An9x"},{"type":"output","id":"E0ZWUJWsSnuXWRDLkS_Fj","data":[],"key":"GZPYISw9AU"}],"key":"mTj5jYvO61"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Acto seguido, vamos a cargar los datos y hacer la separacion de las columnas categoricas y numericas para entrenar el modelo y nuestras “X”. Este proceso va a ser analogo en todas las etapas.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"G4imomiiPJ"}],"key":"oThGVYqk0V"}],"key":"LHGCsrFggF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df = pd.read_csv(\"data_churn_EDA.csv\")","key":"UvSbdQDKC0"},{"type":"output","id":"yMDr_kH9iYYRNWe0AKLm5","data":[],"key":"uiB3yH3wnO"}],"key":"ZTGJXJggip"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"X = df.drop(\"churn\", axis=1)\ny = df[\"churn\"]\n\nnum_cols = X.select_dtypes(include=[\"int64\", \"float64\"]).columns.tolist()\ncat_cols = X.select_dtypes(include=[\"object\", \"category\"]).columns.tolist()","key":"WpX1Xuy7Yw"},{"type":"output","id":"lcj4Ah16Fj9f-N2GQJEks","data":[],"key":"wtb7SiWIHF"}],"key":"okD2WOwDb4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"X_train, X_test, y_train, y_test = train_test_split(X, y, stratify=y, test_size=0.2, random_state=42)","key":"IeuZWVaUJj"},{"type":"output","id":"zQYfjiiosPAdosLhzDaCZ","data":[],"key":"ohb9rN0SjQ"}],"key":"PJcvrqpBTz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Luego de este split, vamos a aplicar el StandardScaler() a las variables numericas y OneHotEncoder a nuestras variables categoricas para futuro modelaje.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g5eYyaSXL2"}],"key":"cMd2GAWYcE"}],"key":"I4wR00Tgdd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = ColumnTransformer([\n    (\"num\", StandardScaler(), num_cols),\n    (\"cat\", OneHotEncoder(handle_unknown=\"ignore\"), cat_cols)\n])\n\nprint(\"Categóricas:\", cat_cols)\nprint(\"Numéricas:\", num_cols)","key":"NjwxclYeGq"},{"type":"output","id":"JWHL9r97vc9oOXm9onAUw","data":[{"name":"stdout","output_type":"stream","text":"Categóricas: ['gender', 'senior', 'partner', 'dependents', 'phone', 'phone_multiple', 'internet', 'internet_security', 'internet_backup', 'internet_protection', 'internet_support', 'streaming_tv', 'streaming_movies', 'contract', 'paperless', 'payment']\nNuméricas: ['tenure', 'charges_monthly']\n"}],"key":"M6IuFuyZo2"}],"key":"Ntl9o9sDZ7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aqui, usaremos solamente los modelos estandares:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IVVU6OdInL"}],"key":"QBj1YvXozU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Random Forest","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kExBt9tvCJ"}],"key":"R7T91k8DE2"}],"key":"I9ibA4qFRv"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"XGBoost","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"laupv3FjX4"}],"key":"dbZoIZOWj0"}],"key":"Yr9VdTU3b4"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"CatBoost","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"w4V2CxN8IZ"}],"key":"wA4eiH438U"}],"key":"vKtE6XRemD"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"LightGBM","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Plx52BgMA1"}],"key":"iwd5YydiPG"}],"key":"O4LkI7vgQf"}],"key":"WvQ9pNGsWe"}],"key":"DKLScdDEx6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"models = {\n    \"RandomForest\": RandomForestClassifier(random_state=42),\n    \"XGBoost\": XGBClassifier(use_label_encoder=False, eval_metric=\"logloss\", random_state=42),\n    \"CatBoost\": CatBoostClassifier(verbose=0, random_seed=42),\n    \"LightGBM\": LGBMClassifier(random_state=42)\n}","key":"MRVT819hNf"},{"type":"output","id":"Ifh3WUkBbvBuZLmVRYB6q","data":[],"key":"TxJ5X6JfKD"}],"key":"u5N6KZqy1q"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Y con ello, tambien haremos los respectivos pipelines para evitar cualquier fuga de datos dentro del proceso.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JcJ2XdOJyR"}],"key":"utC92nxFph"}],"key":"uwRY3OXf1Z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pipe_rf = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", RandomForestClassifier(random_state=42))\n])\n\npipe_xgb = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", XGBClassifier(use_label_encoder=False, eval_metric=\"logloss\", random_state=42))\n])\n\npipe_cat = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", CatBoostClassifier(verbose=0, random_seed=42))\n])\n\npipe_lgb = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", LGBMClassifier(random_state=42))\n])","key":"FxfXwW6XDw"},{"type":"output","id":"kbxdhnvNO-dIqxCr26gul","data":[],"key":"wK6qDya828"}],"key":"x710zRdehd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pipelines = {\n    \"RandomForest\": pipe_rf,\n    \"XGBoost\": pipe_xgb,\n    \"CatBoost\": pipe_cat,\n    \"LightGBM\": pipe_lgb\n}\n\nprint(\" Pipelines creados manualmente para cada modelo:\")\nfor name in pipelines:\n    print(f\" - {name}\")","key":"UdKlfn4c9e"},{"type":"output","id":"PVesTj3YwEtiKgCzxNZSm","data":[{"name":"stdout","output_type":"stream","text":" Pipelines creados manualmente para cada modelo:\n - RandomForest\n - XGBoost\n - CatBoost\n - LightGBM\n"}],"key":"GE3Yj1ojSj"}],"key":"xdkXTYiH3Q"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Junto a ello, a pesar de que no usaremos hiperparametros, usaremos validacion cruzada para entrenar los modelos, y acumularemos los resultados para analizarlos a nivel global mas adelante.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XFHoOieYPU"}],"key":"itT8X93Vta"}],"key":"xEslDE6wcs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n\nparam_grids_empty = {\n    \"RandomForest\": {},\n    \"XGBoost\": {},\n    \"CatBoost\": {},\n    \"LightGBM\": {}\n}\n\nresultados1 = []","key":"kPuGCHRYOq"},{"type":"output","id":"XEu30pxTWjDdy0CPRwHYp","data":[],"key":"h6XdgtVZ98"}],"key":"pOMbIjgSOY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.1.1 RandomForest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iRF2GuZCs0"}],"key":"uRjyE2NEQN"}],"identifier":"id-2-1-1-randomforest","label":"2.1.1 RandomForest","html_id":"id-2-1-1-randomforest","implicit":true,"key":"DtTWz7GCYN"}],"key":"PUWoALiIZM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_rf = GridSearchCV(\n    estimator=pipe_rf,\n    param_grid={},  \n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"sw75zrcmU5"},{"type":"output","id":"fprIUrcbjbMUnwAyqYnq0","data":[],"key":"P8kLO3UOl4"}],"key":"bulKE2Icgb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_rf.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_rf = grid_rf.predict(X_test)\n\nprint(\"\\nResultados - RandomForest\")\nprint(classification_report(y_test, y_pred_rf))\nprint(\"Mejores parámetros:\", grid_rf.best_params_)\n\nresultados1.append({\n    \"Modelo\": \"RandomForest\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_rf),\n    \"Recall\": recall_score(y_test, y_pred_rf),\n    \"Precision\": precision_score(y_test, y_pred_rf),\n    \"F1\": f1_score(y_test, y_pred_rf),\n    \"AUC\": roc_auc_score(y_test, y_pred_rf),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_rf.best_params_\n})","key":"o4ssIzu7bk"},{"type":"output","id":"yBf8u8dswgiKNBz4UMKRa","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 1 candidates, totalling 5 fits\n"},{"name":"stdout","output_type":"stream","text":"\nResultados - RandomForest\n              precision    recall  f1-score   support\n\n           0       0.83      0.88      0.86      1035\n           1       0.60      0.49      0.54       374\n\n    accuracy                           0.78      1409\n   macro avg       0.72      0.69      0.70      1409\nweighted avg       0.77      0.78      0.77      1409\n\nMejores parámetros: {}\n"}],"key":"IQVEO5mNiZ"}],"key":"af4WBjLOZ7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\n\nConfusionMatrixDisplay.from_estimator(\n    grid_rf, X_test, y_test, cmap=\"Blues\", ax=axes[0]\n)\naxes[0].set_title(\"Matriz de Confusión - RandomForest\")\n\nRocCurveDisplay.from_estimator(grid_rf, X_test, y_test, ax=axes[1])\naxes[1].plot([0, 1], [0, 1], \"k--\", label=\"Línea base (y=x)\")\naxes[1].set_title(\"Curva ROC - RandomForest\")\naxes[1].legend()\n\nplt.tight_layout()\nplt.show()","key":"jB6a7XRlo7"},{"type":"output","id":"1ov-_h3PRBH8zwma4SeXM","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d7c57ada287e2e2f2bf473d3c2b91ffd","path":"/d7c57ada287e2e2f2bf473d3c2b91ffd.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"FsdlcKdqMp"}],"key":"vTBoldmqPf"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cenCg8RGQz"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo inicial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"heDhfL33Gp"}],"key":"zVFfLwePnI"},{"type":"text","value":" de Random Forest nos da un resultado útil, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uvtfQaHU0B"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.78","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f1IUepJn9l"}],"key":"uouNrR0Vws"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yCjEkBlRCc"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.81","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H0Z2g1hKIJ"}],"key":"rmGagAjOSW"},{"type":"text","value":". La matriz de confusión demuestra un desempeño normal, enfatizando el desbalance que hay entre las clases, ya que la clase mayoritaria (positiva) tiene mayores tasas de clasificacion a diferencia de la clase negativa. En esta ultima clase, la tasa tanto de positivos como negativos es casi equivalente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GxCvS9cgQ5"}],"key":"MR3lnRYgqr"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MyUKv82vnj"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"b9EdwcfZhm"}],"key":"mtim41V9aY"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"t7HSCQz2Tt"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.69","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sghpy7pQKr"}],"key":"RYtDLGUmwz"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bPhqxEV5f6"}],"key":"YfcES2V861"}],"key":"mjyYIOq4fM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.1.2 XGBoost","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zXpC7z2QTw"}],"key":"YvM7dTsFvc"}],"identifier":"id-2-1-2-xgboost","label":"2.1.2 XGBoost","html_id":"id-2-1-2-xgboost","implicit":true,"key":"FuRi28x0zx"}],"key":"o3yInghQJR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_xgb = GridSearchCV(\n    estimator=pipe_xgb,\n    param_grid={},\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"mEAkp7SzWI"},{"type":"output","id":"IDk2TJDbRmYPC55nklEmm","data":[],"key":"q4BDi3RwCR"}],"key":"dEBqTh3O66"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_xgb.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_xgb = grid_xgb.predict(X_test)\n\nprint(\"\\nResultados - XGBoost\")\nprint(classification_report(y_test, y_pred_xgb))\nprint(\"Mejores parámetros:\", grid_xgb.best_params_)\n\nresultados1.append({\n    \"Modelo\": \"XGBoost\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_xgb),\n    \"Recall\": recall_score(y_test, y_pred_xgb),\n    \"Precision\": precision_score(y_test, y_pred_xgb),\n    \"F1\": f1_score(y_test, y_pred_xgb),\n    \"AUC\": roc_auc_score(y_test, y_pred_xgb),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_xgb.best_params_\n})","key":"m3Ke8cTtxK"},{"type":"output","id":"ACt7Ezz8O-QRzjxTT6rzJ","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 1 candidates, totalling 5 fits\n\nResultados - XGBoost\n              precision    recall  f1-score   support\n\n           0       0.83      0.88      0.85      1035\n           1       0.60      0.51      0.55       374\n\n    accuracy                           0.78      1409\n   macro avg       0.71      0.69      0.70      1409\nweighted avg       0.77      0.78      0.77      1409\n\nMejores parámetros: {}\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\xgboost\\core.py:158: UserWarning: [14:16:37] WARNING: C:\\buildkite-agent\\builds\\buildkite-windows-cpu-autoscaling-group-i-08cbc0333d8d4aae1-1\\xgboost\\xgboost-ci-windows\\src\\learner.cc:740: \nParameters: { \"use_label_encoder\" } are not used.\n\n  warnings.warn(smsg, UserWarning)\n"}],"key":"kwfNPaeo0b"}],"key":"fRFADOQ85R"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\n\nConfusionMatrixDisplay.from_estimator(grid_xgb, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - XGBoost\")\n\nRocCurveDisplay.from_estimator(grid_xgb, X_test, y_test, ax=axes[1])\naxes[1].plot([0, 1], [0, 1], \"k--\", label=\"Línea base (y=x)\")\naxes[1].set_title(\"Curva ROC - XGBoost\")\naxes[1].legend()\n\nplt.tight_layout()\nplt.show()","key":"Li564i0KUX"},{"type":"output","id":"0AVsnqJC34eyRdxKVRK2o","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1c87af00ef3b061144b445b1bdf4e168","path":"/1c87af00ef3b061144b445b1bdf4e168.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"zA0QSc45uI"}],"key":"KztqhQptHO"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kvX3VRtprL"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo inicial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m9gdQBZ6Tw"}],"key":"K8bw6XEKP4"},{"type":"text","value":" de XGBoost nos da un resultado útil, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"leWRART7It"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.78","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e3Afp7RdXj"}],"key":"h6IZmyBo49"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CYBc8aJNj6"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.82","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AIVTOp8RS8"}],"key":"Q6ay9xFeSj"},{"type":"text","value":". La matriz de confusión demuestra un desempeño normal, enfatizando el desbalance que hay entre las clases, ya que la clase mayoritaria (positiva) tiene mayores tasas de clasificacion a diferencia de la clase negativa. En esta ultima clase, la tasa tanto de positivos como negativos es casi equivalente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q4MRiiUm3K"}],"key":"gYAXvPM3jI"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"O3qScccLtN"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mrrvhOA4gf"}],"key":"zKoUXxBLpR"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RvzC1GEJFf"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.69","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CVyMhnsrxn"}],"key":"r6omPbqFtv"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pE0gQewnm8"}],"key":"bcLhwK4z99"}],"key":"rZlzQO9K4p"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.1.3 CatBoost","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"u98QhIPEcY"}],"key":"FrgiYRB0dS"}],"identifier":"id-2-1-3-catboost","label":"2.1.3 CatBoost","html_id":"id-2-1-3-catboost","implicit":true,"key":"ZcjtBwhJS3"}],"key":"yKZd5pdsRq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_cat = GridSearchCV(\n    estimator=pipe_cat,\n    param_grid={},\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"wY7pBH45Oq"},{"type":"output","id":"gf0oH8BU6QxgKdUqpR5fN","data":[],"key":"lcQoddSuxn"}],"key":"TvrPkay7Gw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_cat.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_cat = grid_cat.predict(X_test)\n\nprint(\"\\nResultados - CatBoost\")\nprint(classification_report(y_test, y_pred_cat))\nprint(\"Mejores parámetros:\", grid_cat.best_params_)\n\nresultados1.append({\n    \"Modelo\": \"CatBoost\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_cat),\n    \"Recall\": recall_score(y_test, y_pred_cat),\n    \"Precision\": precision_score(y_test, y_pred_cat),\n    \"F1\": f1_score(y_test, y_pred_cat),\n    \"AUC\": roc_auc_score(y_test, y_pred_cat),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_cat.best_params_\n})","key":"zAcV9mx8Lz"},{"type":"output","id":"fsx86m-vGe3jKbnFlS_HX","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 1 candidates, totalling 5 fits\n\nResultados - CatBoost\n              precision    recall  f1-score   support\n\n           0       0.84      0.89      0.86      1035\n           1       0.64      0.52      0.57       374\n\n    accuracy                           0.79      1409\n   macro avg       0.74      0.71      0.72      1409\nweighted avg       0.78      0.79      0.79      1409\n\nMejores parámetros: {}\n"}],"key":"kIxhiw7OJI"}],"key":"yGys65UlBa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\n\nConfusionMatrixDisplay.from_estimator(grid_cat, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - CatBoost\")\n\nRocCurveDisplay.from_estimator(grid_cat, X_test, y_test, ax=axes[1])\naxes[1].plot([0, 1], [0, 1], \"k--\", label=\"Línea base (y=x)\")\naxes[1].set_title(\"Curva ROC - CatBoost\")\naxes[1].legend()\n\nplt.tight_layout()\nplt.show()","key":"xn0Xn11r4j"},{"type":"output","id":"EXkMM8oRvI32WJdr5VqoE","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"17207f670dbdb3ccb05bb6779410211f","path":"/17207f670dbdb3ccb05bb6779410211f.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"jGC71svxeC"}],"key":"z4BUTnCE9Q"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VvJxmXD6O1"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo inicial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YuxeCwzQgU"}],"key":"OQP8NoY12K"},{"type":"text","value":" de CatBoost nos da un resultado útil, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VPiDPOjtp9"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.79","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dU3xeSibcq"}],"key":"FIJVOfypJA"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XSYMzJABwI"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.84","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PTPSsLcxSo"}],"key":"ll6W5xvr00"},{"type":"text","value":". La matriz de confusión demuestra un desempeño ligeramente moderado, enfatizando el desbalance que hay entre las clases, ya que la clase mayoritaria (positiva) tiene mayores tasas de clasificacion a diferencia de la clase negativa. En esta ultima clase, la tasa tanto de positivos como negativos es casi equivalente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ogKIvMR20f"}],"key":"crzNfIua0k"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ih7kpm8xHA"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ofDuREH5m6"}],"key":"HEGhajYVMB"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nrDIeiI6fn"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.71","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ePlbg3ZpU7"}],"key":"BuAz5s0nq9"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"B0Lo4lx2jj"}],"key":"DLvCsYqn6A"}],"key":"zzZ3u1ocYe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.1.4 LightGBM","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uDsilyw50A"}],"key":"NX932HYmAi"}],"identifier":"id-2-1-4-lightgbm","label":"2.1.4 LightGBM","html_id":"id-2-1-4-lightgbm","implicit":true,"key":"LZ57vL7qae"}],"key":"hX02TgI6se"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_lgb = GridSearchCV(\n    estimator=pipe_lgb,\n    param_grid={},\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"mPSIBBuQxC"},{"type":"output","id":"jz26reAjbEI2q7msMuSoR","data":[],"key":"z9ROB37Nkr"}],"key":"ImGX8raC5Y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_lgb.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_lgb = grid_lgb.predict(X_test)\n\nprint(\"\\nResultados - LightGBM\")\nprint(classification_report(y_test, y_pred_lgb))\nprint(\"Mejores parámetros:\", grid_lgb.best_params_)\n\nConfusionMatrixDisplay.from_estimator(grid_lgb, X_test, y_test, cmap=\"Blues\")\n\nresultados1.append({\n    \"Modelo\": \"LightGBM\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_lgb),\n    \"Recall\": recall_score(y_test, y_pred_lgb),\n    \"Precision\": precision_score(y_test, y_pred_lgb),\n    \"F1\": f1_score(y_test, y_pred_lgb),\n    \"AUC\": roc_auc_score(y_test, y_pred_lgb),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_lgb.best_params_\n})","key":"VmAyzhhyQl"},{"type":"output","id":"eLCETCROWOi2FF5GRQovo","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 1 candidates, totalling 5 fits\n[LightGBM] [Info] Number of positive: 1495, number of negative: 4139\n[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0,000623 seconds.\nYou can set `force_row_wise=true` to remove the overhead.\nAnd if memory is not enough, you can set `force_col_wise=true`.\n[LightGBM] [Info] Total Bins 415\n[LightGBM] [Info] Number of data points in the train set: 5634, number of used features: 45\n[LightGBM] [Info] [binary:BoostFromScore]: pavg=0,265353 -> initscore=-1,018328\n[LightGBM] [Info] Start training from score -1,018328\n\nResultados - LightGBM\n              precision    recall  f1-score   support\n\n           0       0.84      0.89      0.86      1035\n           1       0.64      0.52      0.57       374\n\n    accuracy                           0.79      1409\n   macro avg       0.74      0.71      0.72      1409\nweighted avg       0.79      0.79      0.79      1409\n\nMejores parámetros: {}\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\nc:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fdd078296fb1c151abcf21c60755b5d3","path":"/fdd078296fb1c151abcf21c60755b5d3.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"cUPxAiVAs6"}],"key":"sdWzpj8x8o"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\n\nConfusionMatrixDisplay.from_estimator(grid_lgb, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - LightGBM\")\n\nRocCurveDisplay.from_estimator(grid_lgb, X_test, y_test, ax=axes[1])\naxes[1].plot([0, 1], [0, 1], \"k--\", label=\"Línea base (y=x)\")\naxes[1].set_title(\"Curva ROC - LightGBM\")\naxes[1].legend()\n\nplt.tight_layout()\nplt.show()\n","key":"vSEj1aAMPx"},{"type":"output","id":"Mt33aE3OEFn25Zh5A3iPw","data":[{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\nc:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cafcde75a4798dfd8328c33b84efe6bc","path":"/cafcde75a4798dfd8328c33b84efe6bc.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"mRflnaA2Eg"}],"key":"cCEytQA3h6"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x2oxewQv9t"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo inicial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i8M1M15IkK"}],"key":"scboqWOOV8"},{"type":"text","value":" de LightGBM nos da un resultado útil, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bwFK8IwyDA"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.79","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Opb8jV686D"}],"key":"XTFdPFNnHS"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JkJEuWkskK"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.84","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yLyNXHZAnx"}],"key":"x35DgjWWcH"},{"type":"text","value":". La matriz de confusión demuestra un desempeño normal, enfatizando el desbalance que hay entre las clases, ya que la clase mayoritaria (positiva) tiene mayores tasas de clasificacion a diferencia de la clase negativa. En esta ultima clase, la tasa tanto de positivos como negativos es casi equivalente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QH0H6FjN21"}],"key":"WFi4EZgRTY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tIHqz6P3Fi"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OA2emtJoUt"}],"key":"X8iFB4XYPd"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uQiO8I7q8c"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.71","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xs41K0xFuD"}],"key":"hlNjk77F7u"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UophWacbue"}],"key":"ng3dDto8YD"}],"key":"rqPcOjf8va"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.1.5 Resultados Preliminares","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KWXNprnN6e"}],"key":"ynuJ70UZ5F"}],"identifier":"id-2-1-5-resultados-preliminares","label":"2.1.5 Resultados Preliminares","html_id":"id-2-1-5-resultados-preliminares","implicit":true,"key":"Eb58drHjgS"}],"key":"o35Y0nAtku"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"res1_df = pd.DataFrame(resultados1)\nres1_df_sorted = res1_df.sort_values(by=\"Recall\", ascending=False)\nprint(\"\\n Resultados finales:\")\ndisplay(res1_df_sorted)","key":"u4k0jqRkHv"},{"type":"output","id":"7xZtFKLYpKWavFAVnm7PC","data":[{"name":"stdout","output_type":"stream","text":"\n Resultados finales:\n"},{"output_type":"display_data","metadata":{},"data":{"application/vnd.microsoft.datawrangler.viewer.v0+json":{"content":"{\"columns\":[{\"name\":\"index\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"Modelo\",\"rawType\":\"object\",\"type\":\"string\"},{\"name\":\"Accuracy\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Recall\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Precision\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"F1\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"AUC\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Tiempo (s)\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Mejores Parámetros\",\"rawType\":\"object\",\"type\":\"unknown\"}],\"ref\":\"4742fac9-ed3c-4f84-bec5-a8e26bef904d\",\"rows\":[[\"2\",\"CatBoost\",\"0.7934705464868701\",\"0.5213903743315508\",\"0.6351791530944625\",\"0.5726872246696035\",\"0.7065889069725387\",\"8.13\",\"{}\"],[\"3\",\"LightGBM\",\"0.794889992902768\",\"0.5213903743315508\",\"0.639344262295082\",\"0.5743740795287187\",\"0.7075550905474179\",\"0.93\",\"{}\"],[\"1\",\"XGBoost\",\"0.7778566359119943\",\"0.5080213903743316\",\"0.5956112852664577\",\"0.5483405483405484\",\"0.6916918546074556\",\"0.64\",\"{}\"],[\"0\",\"RandomForest\",\"0.7799858055358411\",\"0.4946524064171123\",\"0.6045751633986928\",\"0.5441176470588235\",\"0.6888720969283629\",\"1.07\",\"{}\"]],\"shape\":{\"columns\":8,\"rows\":4}}","content_type":"application/vnd.microsoft.datawrangler.viewer.v0+json"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Modelo</th>\n      <th>Accuracy</th>\n      <th>Recall</th>\n      <th>Precision</th>\n      <th>F1</th>\n      <th>AUC</th>\n      <th>Tiempo (s)</th>\n      <th>Mejores Parámetros</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2</th>\n      <td>CatBoost</td>\n      <td>0.793471</td>\n      <td>0.521390</td>\n      <td>0.635179</td>\n      <td>0.572687</td>\n      <td>0.706589</td>\n      <td>8.13</td>\n      <td>{}</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>LightGBM</td>\n      <td>0.794890</td>\n      <td>0.521390</td>\n      <td>0.639344</td>\n      <td>0.574374</td>\n      <td>0.707555</td>\n      <td>0.93</td>\n      <td>{}</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>XGBoost</td>\n      <td>0.777857</td>\n      <td>0.508021</td>\n      <td>0.595611</td>\n      <td>0.548341</td>\n      <td>0.691692</td>\n      <td>0.64</td>\n      <td>{}</td>\n    </tr>\n    <tr>\n      <th>0</th>\n      <td>RandomForest</td>\n      <td>0.779986</td>\n      <td>0.494652</td>\n      <td>0.604575</td>\n      <td>0.544118</td>\n      <td>0.688872</td>\n      <td>1.07</td>\n      <td>{}</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"         Modelo  Accuracy    Recall  Precision        F1       AUC  \\\n2      CatBoost  0.793471  0.521390   0.635179  0.572687  0.706589   \n3      LightGBM  0.794890  0.521390   0.639344  0.574374  0.707555   \n1       XGBoost  0.777857  0.508021   0.595611  0.548341  0.691692   \n0  RandomForest  0.779986  0.494652   0.604575  0.544118  0.688872   \n\n   Tiempo (s) Mejores Parámetros  \n2        8.13                 {}  \n3        0.93                 {}  \n1        0.64                 {}  \n0        1.07                 {}  ","content_type":"text/plain"}}}],"key":"oCunlpwlyv"}],"key":"MB3Lo1dbXH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"metricas = [\"Accuracy\", \"Recall\", \"Precision\", \"F1\", \"AUC\"]\n\nres1_df_sorted = res1_df.sort_values(by=\"Recall\", ascending=False).reset_index(drop=True)\n\nres1_melt = res1_df_sorted.melt(\n    id_vars=\"Modelo\", \n    value_vars=metricas, \n    var_name=\"Métrica\", \n    value_name=\"Valor\"\n)","key":"IipziKTvfT"},{"type":"output","id":"QPhk2lAYx4kT8zquLfr1F","data":[],"key":"b1xoJpz7Cr"}],"key":"d2OwGw575a"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(16, 6))\n\nsns.barplot(\n    data=res1_melt, \n    x=\"Modelo\", \n    y=\"Valor\", \n    hue=\"Métrica\", \n    palette=\"Blues_r\", \n    ax=axes[0]\n)\naxes[0].set_title(\"Comparación de Métricas por Modelo\", fontsize=14)\naxes[0].set_ylim(0, 1)\naxes[0].set_ylabel(\"Valor de la Métrica\")\naxes[0].set_xlabel(\"Modelo\")\naxes[0].legend(title=\"Métrica\", bbox_to_anchor=(1.05, 1), loc=\"upper left\")\n\nsns.barplot(\n    data=res1_df_sorted, \n    x=\"Modelo\", \n    y=\"Tiempo (s)\", \n    palette=\"Blues_r\", \n    ax=axes[1]\n)\naxes[1].set_title(\"Tiempo de Entrenamiento por Modelo\", fontsize=14)\naxes[1].set_ylabel(\"Tiempo (segundos)\")\naxes[1].set_xlabel(\"Modelo\")\n\nplt.tight_layout()\nplt.show()\n","key":"mG07zNxCpk"},{"type":"output","id":"Jdi8ykLSAhofhITAW9TGj","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\1102010564.py:17: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e943e1ce04bad0ae46d67f06d17b0613","path":"/e943e1ce04bad0ae46d67f06d17b0613.png"},"text/plain":{"content":"<Figure size 1600x600 with 2 Axes>","content_type":"text/plain"}}}],"key":"sFz19qtEi7"}],"key":"kTcBjMatWy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"De forma preliminar, vemos que los modelos de CatBoost y LightGBM tienen mejores metricas al comparar con otros modelos. En este caso, la metrica de interes es Recall (ya que queremos reducir los falsos negativos para este caso), y tanto CatBoost como LightGBM alcanzaron los mejores rendimientos. Junto a esto, notamos que CatBoost tuvo una duracion elevada a comparacion del resto (LightGBM, XGBoost y RandomForest)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WmqT4Rh7Ct"}],"key":"ba6j0Kl5RB"}],"key":"Wvp4ctANFI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\n\nmodelos_entrenados = {\n    \"RandomForest\": grid_rf,\n    \"XGBoost\": grid_xgb,\n    \"CatBoost\": grid_cat,\n    \"LightGBM\": grid_lgb\n}\n\nfor name, model in modelos_entrenados.items():\n    RocCurveDisplay.from_estimator(model, X_test, y_test, ax=plt.gca(), name=name)\n\nplt.plot([0, 1], [0, 1], \"k--\", label=\"Aleatorio\")\n\nplt.title(\"Comparación de Curvas ROC\", fontsize=14)\nplt.xlabel(\"Tasa de Falsos Positivos (FPR)\")\nplt.ylabel(\"Tasa de Verdaderos Positivos (TPR)\")\nplt.legend(loc=\"lower right\")\nplt.grid(alpha=0.3)\nplt.tight_layout()\nplt.show()","key":"FwISgzKIDL"},{"type":"output","id":"SJgs6pU8iFOeP1XAXWZaW","data":[{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"423dbdfa5bf25348c8403af21b002aee","path":"/423dbdfa5bf25348c8403af21b002aee.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"gajaxspVZG"}],"key":"MfduC7Vlcn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Comparando curvas ROC, los rendimientos son bastantes similares a la grafica anterior, con LightGBM y CatBoost con un AUC de 0.84, con los modelos restantes estando con 0.82 (XGboost) y 0.81 (RandomForest) respectivamente, teniendo un desempeño similar.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a5sA34lG0b"}],"key":"cV7R3Zrlk3"}],"key":"kR7Nf7NAjJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.2. Modelos benchmark (RandomForest, XGboost, CatBoost, LightGBM) con hiperparametros establecidos","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T6yTZfbS36"}],"key":"PQoEvkRQYf"}],"identifier":"id-2-2-modelos-benchmark-randomforest-xgboost-catboost-lightgbm-con-hiperparametros-establecidos","label":"2.2. Modelos benchmark (RandomForest, XGboost, CatBoost, LightGBM) con hiperparametros establecidos","html_id":"id-2-2-modelos-benchmark-randomforest-xgboost-catboost-lightgbm-con-hiperparametros-establecidos","implicit":true,"key":"KX5Lulr9eL"}],"key":"uZe1f5YSW6"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"En esta seccion, haremos analogamente a lo que hicimos a la seccion anterior, pero implementaremos diferentes hiperparametros para revisar su rendimiento.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bNbVRaP9hQ"}],"key":"hLkZH5v6pG"}],"key":"E63pzq0ACV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df = pd.read_csv(\"data_churn_EDA.csv\")","key":"tvLaGyCpBt"},{"type":"output","id":"a9hG8-A2BUzEON_ujL-ae","data":[],"key":"CU9S52Q4tG"}],"key":"Q75qBulWeB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"X = df.drop(\"churn\", axis=1)\ny = df[\"churn\"]\n\nnum_cols = X.select_dtypes(include=[\"int64\", \"float64\"]).columns.tolist()\ncat_cols = X.select_dtypes(include=[\"object\", \"category\"]).columns.tolist()","key":"AQG8EGPfpG"},{"type":"output","id":"BXak2tbJ9vM1kmatSM8EL","data":[],"key":"Nmf8Ltvmpp"}],"key":"DD98okjeTa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"X_train, X_test, y_train, y_test = train_test_split(X, y, stratify=y, test_size=0.2, random_state=42)","key":"cEO6265bQs"},{"type":"output","id":"A4iuMCvBbuS1p6M9BEMlQ","data":[],"key":"YX99nukUhm"}],"key":"J4OwYDEc1y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = ColumnTransformer([\n    (\"num\", StandardScaler(), num_cols),\n    (\"cat\", OneHotEncoder(handle_unknown=\"ignore\"), cat_cols)\n])\n\nprint(\"Categóricas:\", cat_cols)\nprint(\"Numéricas:\", num_cols)","key":"QpsoNfxeaC"},{"type":"output","id":"wZJ_Es-hIWzpzG_uLx9P1","data":[{"name":"stdout","output_type":"stream","text":"Categóricas: ['gender', 'senior', 'partner', 'dependents', 'phone', 'phone_multiple', 'internet', 'internet_security', 'internet_backup', 'internet_protection', 'internet_support', 'streaming_tv', 'streaming_movies', 'contract', 'paperless', 'payment']\nNuméricas: ['tenure', 'charges_monthly']\n"}],"key":"wgfIiHEhUd"}],"key":"E5djCRxkPa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"models = {\n    \"RandomForest\": RandomForestClassifier(random_state=42),\n    \"XGBoost\": XGBClassifier(use_label_encoder=False, eval_metric=\"logloss\", random_state=42),\n    \"CatBoost\": CatBoostClassifier(verbose=0, random_seed=42),\n    \"LightGBM\": LGBMClassifier(random_state=42)\n}","key":"JHAv3zSzo8"},{"type":"output","id":"x6WoQoiDtczUP66M1NNr1","data":[],"key":"K0co7Fh5Lh"}],"key":"MOtwNp5mkB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pipe_rf = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", RandomForestClassifier(random_state=42))\n])\n\npipe_xgb = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", XGBClassifier(use_label_encoder=False, eval_metric=\"logloss\", random_state=42))\n])\n\npipe_cat = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", CatBoostClassifier(verbose=0, random_seed=42))\n])\n\npipe_lgb = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", LGBMClassifier(random_state=42))\n])\n","key":"m13pH97nWo"},{"type":"output","id":"LQMzvb1SeAkocNsMNWXGl","data":[],"key":"NIoLOz1OMF"}],"key":"opkiXwwmPw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pipelines = {\n    \"RandomForest\": pipe_rf,\n    \"XGBoost\": pipe_xgb,\n    \"CatBoost\": pipe_cat,\n    \"LightGBM\": pipe_lgb\n}\n\nprint(\" Pipelines creados manualmente para cada modelo:\")\nfor name in pipelines:\n    print(f\" - {name}\")","key":"GgfAgDyQyX"},{"type":"output","id":"jVgz7WrQuPlihTh1lN6HG","data":[{"name":"stdout","output_type":"stream","text":" Pipelines creados manualmente para cada modelo:\n - RandomForest\n - XGBoost\n - CatBoost\n - LightGBM\n"}],"key":"hyt9qj3OqY"}],"key":"xAidlaJbp5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n\nparam_grids = {\n    \"RandomForest\": {\n        \"clf__min_samples_split\": [2, 5, 10],\n        \"clf__min_samples_leaf\": [1, 2, 4],\n        \"clf__max_features\": [\"sqrt\", \"log2\"],\n        \"clf__bootstrap\": [True, False],\n        \"clf__criterion\": [\"gini\", \"entropy\"]\n    },\n    \n    \"XGBoost\": {\n        \"clf__subsample\": [0.8, 1.0],\n        \"clf__gamma\": [0, 1],\n        \"clf__min_child_weight\": [1, 5],\n        \"clf__reg_alpha\": [0, 0.1, 0.5],\n        \"clf__reg_lambda\": [1, 2, 5],\n        \"clf__scale_pos_weight\": [1, 2, 5]\n    },\n\n    \"CatBoost\": {\n        \"clf__l2_leaf_reg\": [1, 3, 5],\n        \"clf__border_count\": [32, 64],\n    },\n\n    \"LightGBM\": {\n        \"clf__min_child_samples\": [10, 20, 50],\n        \"clf__min_child_weight\": [1e-3, 1e-2, 1e-1],\n        \"clf__subsample\": [0.8, 1.0],\n        \"clf__colsample_bytree\": [0.8, 1.0],\n        \"clf__reg_alpha\": [0],\n        \"clf__reg_lambda\": [0, 0.5, 1],\n        \"clf__max_bin\": [255]\n    }\n}\n\nresultados2 = []","key":"dFJ1hsY6QV"},{"type":"output","id":"5Xg1FVZ4EiUNNqJ4fXNpf","data":[],"key":"Txh9WMMAWs"}],"key":"kIaFxaqKLB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.2.1 RandomForest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BMq6DuApaG"}],"key":"qT8axtt9tI"}],"identifier":"id-2-2-1-randomforest","label":"2.2.1 RandomForest","html_id":"id-2-2-1-randomforest","implicit":true,"key":"lApHsOxNlW"}],"key":"DSdbqSHj4h"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_rf = GridSearchCV(\n    estimator=pipe_rf,\n    param_grid=param_grids[\"RandomForest\"],\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"C4WV1R0UUc"},{"type":"output","id":"mBX_mHnp5oav692jgR8az","data":[],"key":"ZKdHIppuSl"}],"key":"Te521CBfN9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_rf.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_rf = grid_rf.predict(X_test)\n\nprint(\"\\n Resultados - RandomForest\")\nprint(classification_report(y_test, y_pred_rf))\nprint(\"---------------------------------------------\")\nprint(\"Mejores parámetros:\", grid_rf.best_params_)\n\nresultados2.append({\n    \"Modelo\": \"RandomForest + HP\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_rf),\n    \"Recall\": recall_score(y_test, y_pred_rf),\n    \"Precision\": precision_score(y_test, y_pred_rf),\n    \"F1\": f1_score(y_test, y_pred_rf),\n    \"AUC\": roc_auc_score(y_test, y_pred_rf),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_rf.best_params_\n})","key":"FptWm4zHnS"},{"type":"output","id":"QjucDbxCpZUqXK8c1Bchh","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 72 candidates, totalling 360 fits\n\n Resultados - RandomForest\n              precision    recall  f1-score   support\n\n           0       0.83      0.91      0.87      1035\n           1       0.66      0.50      0.57       374\n\n    accuracy                           0.80      1409\n   macro avg       0.75      0.70      0.72      1409\nweighted avg       0.79      0.80      0.79      1409\n\n---------------------------------------------\nMejores parámetros: {'clf__bootstrap': True, 'clf__criterion': 'gini', 'clf__max_features': 'sqrt', 'clf__min_samples_leaf': 2, 'clf__min_samples_split': 5}\n"}],"key":"FVZdZQkt4Y"}],"key":"vYrxQRnyjP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\nConfusionMatrixDisplay.from_estimator(grid_rf, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - RandomForest\")\n\nRocCurveDisplay.from_estimator(grid_rf, X_test, y_test, ax=axes[1], name=\"RandomForest\")\naxes[1].plot([0, 1], [0, 1], \"k--\")\naxes[1].set_title(\"Curva ROC - RandomForest\")\n\nplt.tight_layout()\nplt.show()","key":"CGKYF0grrK"},{"type":"output","id":"_tx9EQaGaptUDglwfjFyv","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"eb8dfdd216b67627e29f8b4b6afa80cb","path":"/eb8dfdd216b67627e29f8b4b6afa80cb.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"TqnV396kd4"}],"key":"DTtuAZMfF1"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"X0H5eGc7HZ"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo Hiperparametrizado","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PmmV6X3iws"}],"key":"t4qsR4zX9L"},{"type":"text","value":" de Random Forest nos da un resultado interesante, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HWfqYAEAwM"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.80","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gKPkUTRIlS"}],"key":"tlhy51vyxm"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Nr74AnPNR6"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.83","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RuvoqpEaNc"}],"key":"WDnhoLS5H5"},{"type":"text","value":". La matriz de confusión demuestra un desempeño normal, enfatizando el desbalance que hay entre las clases, ya que la clase mayoritaria (positiva) tiene mayores tasas de clasificacion a diferencia de la clase negativa. En esta ultima clase, la tasa tanto de positivos como negativos es casi equivalente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QKTZXxlxEZ"}],"key":"KMGvIYdQFL"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lt5ZellHWS"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SeqNgQs1Bx"}],"key":"KCGd6DmOP8"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rCuR1n7q0E"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.70","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"isn2hZZ2VJ"}],"key":"c0UdIgbERZ"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ELCeXVsJTH"}],"key":"CH6qbkq83K"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Los mejores parametros fueron: {‘clf__bootstrap’: True, ‘clf__criterion’: ‘gini’, ‘clf__max_features’: ‘sqrt’, ‘clf__min_samples_leaf’: 2, ‘clf__min_samples_split’: 5}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kJ0HTCQZYC"}],"key":"fFfbQUr2uT"}],"key":"LQJiP4lf1V"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.2.2 XGBoost","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ty1MGgEr2z"}],"key":"NExckU8269"}],"identifier":"id-2-2-2-xgboost","label":"2.2.2 XGBoost","html_id":"id-2-2-2-xgboost","implicit":true,"key":"SMewdWJdbO"}],"key":"KRBzGL2MuK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_xgb = GridSearchCV(\n    estimator=pipe_xgb,\n    param_grid=param_grids[\"XGBoost\"],\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"yNtf7iWBgW"},{"type":"output","id":"hFYghtB5fNQkLaeZqqFAH","data":[],"key":"Z6ZAjjBUuv"}],"key":"gbnwUwrUtp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_xgb.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_xgb = grid_xgb.predict(X_test)\n\nprint(\"\\n Resultados - XGBoost\")\nprint(classification_report(y_test, y_pred_xgb))\nprint(\"---------------------------------------------\")\nprint(\"Mejores parámetros:\", grid_xgb.best_params_)\n\n\nresultados2.append({\n    \"Modelo\": \"XGBoost + HP\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_xgb),\n    \"Recall\": recall_score(y_test, y_pred_xgb),\n    \"Precision\": precision_score(y_test, y_pred_xgb),\n    \"F1\": f1_score(y_test, y_pred_xgb),\n    \"AUC\": roc_auc_score(y_test, y_pred_xgb),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_xgb.best_params_\n})","key":"lveLvYn7Fx"},{"type":"output","id":"Cq224vgPC8bXdov7YfGOv","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 216 candidates, totalling 1080 fits\n\n Resultados - XGBoost\n              precision    recall  f1-score   support\n\n           0       0.92      0.66      0.77      1035\n           1       0.47      0.85      0.61       374\n\n    accuracy                           0.71      1409\n   macro avg       0.70      0.75      0.69      1409\nweighted avg       0.80      0.71      0.73      1409\n\n---------------------------------------------\nMejores parámetros: {'clf__gamma': 1, 'clf__min_child_weight': 5, 'clf__reg_alpha': 0, 'clf__reg_lambda': 5, 'clf__scale_pos_weight': 5, 'clf__subsample': 1.0}\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\xgboost\\core.py:158: UserWarning: [14:17:38] WARNING: C:\\buildkite-agent\\builds\\buildkite-windows-cpu-autoscaling-group-i-08cbc0333d8d4aae1-1\\xgboost\\xgboost-ci-windows\\src\\learner.cc:740: \nParameters: { \"use_label_encoder\" } are not used.\n\n  warnings.warn(smsg, UserWarning)\n"}],"key":"rhL0NPKLZs"}],"key":"YUTnZxHZ1o"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\nConfusionMatrixDisplay.from_estimator(grid_xgb, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - XGBoost\")\n\nRocCurveDisplay.from_estimator(grid_xgb, X_test, y_test, ax=axes[1], name=\"XGBoost\")\naxes[1].plot([0, 1], [0, 1], \"k--\")\naxes[1].set_title(\"Curva ROC - XGBoost\")\n\nplt.tight_layout()\nplt.show()","key":"x5ywGf4ZBF"},{"type":"output","id":"sREm-A30WycIUT9KNV7GZ","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3def07d83de8008f8d020743bcfdc733","path":"/3def07d83de8008f8d020743bcfdc733.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"CcM8BI4FNb"}],"key":"Z9vj6uqutk"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PP0jkzteNP"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo Hiperparametrizado","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XaQYPPyC2v"}],"key":"clxLThotqY"},{"type":"text","value":" de XGBoost nos da un resultado interesante, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gn8XNJLeqs"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.71","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ib0ZpwJZcD"}],"key":"divEzfu0H5"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H7ETa7Bhug"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.84","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NVHkMARql6"}],"key":"PhySHC4Mtk"},{"type":"text","value":". La matriz de confusión demuestra un desempeño diferente al planteado, donde se tuvo una mejoria en la clasificacion de la clase 1, a costo de la clase mayoritaria 0.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eh6lD7iU9x"}],"key":"BHmVL9DDuP"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Kd8YDjDzy2"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gVc2569cUg"}],"key":"UOIbvpmpeN"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YsQULuVjRH"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.75","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wu3Yq7vmgf"}],"key":"BynyCbKQNA"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"quwLofkey2"}],"key":"eVevcboMZN"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Los mejores parametros fueron: {‘clf__gamma’: 1, ‘clf__min_child_weight’: 5, ‘clf__reg_alpha’: 0, ‘clf__reg_lambda’: 5, ‘clf__scale_pos_weight’: 5, ‘clf__subsample’: 1.0}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HQzcOO7r8P"}],"key":"agOxzLBHAf"}],"key":"NA47rvhtyD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.2.3 CatBoost","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r64zwVBRar"}],"key":"KFeMgd4lR1"}],"identifier":"id-2-2-3-catboost","label":"2.2.3 CatBoost","html_id":"id-2-2-3-catboost","implicit":true,"key":"aeQTKDIvjD"}],"key":"htl2vjd2iq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_cat = GridSearchCV(\n    estimator=pipe_cat,\n    param_grid=param_grids[\"CatBoost\"],\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"nc6nY6PZ3X"},{"type":"output","id":"TYmBe0fT81o2F7PcxCuAH","data":[],"key":"kt5b20CsCw"}],"key":"XG9eT3xEqF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_cat.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_cat = grid_cat.predict(X_test)\n\nprint(\"\\nResultados - CatBoost\")\nprint(classification_report(y_test, y_pred_cat))\nprint(\"---------------------------------------------\")\nprint(\"Mejores parámetros:\", grid_cat.best_params_)\n\nresultados2.append({\n    \"Modelo\": \"CatBoost + HP\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_cat),\n    \"Recall\": recall_score(y_test, y_pred_cat),\n    \"Precision\": precision_score(y_test, y_pred_cat),\n    \"F1\": f1_score(y_test, y_pred_cat),\n    \"AUC\": roc_auc_score(y_test, y_pred_cat),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_cat.best_params_\n})\n","key":"qeKZJcU1c7"},{"type":"output","id":"SEQFAIhRM79iDGCZZE6k0","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 6 candidates, totalling 30 fits\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\joblib\\externals\\loky\\process_executor.py:782: UserWarning: A worker stopped while some jobs were given to the executor. This can be caused by a too short worker timeout or by a memory leak.\n  warnings.warn(\n"},{"name":"stdout","output_type":"stream","text":"\nResultados - CatBoost\n              precision    recall  f1-score   support\n\n           0       0.84      0.88      0.86      1035\n           1       0.62      0.55      0.58       374\n\n    accuracy                           0.79      1409\n   macro avg       0.73      0.71      0.72      1409\nweighted avg       0.78      0.79      0.79      1409\n\n---------------------------------------------\nMejores parámetros: {'clf__border_count': 32, 'clf__l2_leaf_reg': 1}\n"}],"key":"DqTOPEiuMc"}],"key":"EZ9OldZigt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\n\nConfusionMatrixDisplay.from_estimator(grid_cat, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - CatBoost\")\n\nRocCurveDisplay.from_estimator(grid_cat, X_test, y_test, ax=axes[1])\naxes[1].plot([0, 1], [0, 1], \"k--\")\naxes[1].set_title(\"Curva ROC - CatBoost\")\naxes[1].legend()\n\nplt.tight_layout()\nplt.show()","key":"Xyp25TfjmE"},{"type":"output","id":"zMKFX5lAW9eNfi4RUNfVy","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"018a740bca257396e3b23dbcba633b1c","path":"/018a740bca257396e3b23dbcba633b1c.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"EwvKLj8d6V"}],"key":"LqPDXXXllz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eaU2oaOIJ6"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo Hiperparametrizado","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i8f2zwud57"}],"key":"XfVlC3wYGB"},{"type":"text","value":" de CatBoost nos da un resultado interesante, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lhoP07WBRp"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.79","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BUKvpcHAyR"}],"key":"gGZ4B98buy"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"emMZdPkYna"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.83","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B1QLzvjZ2T"}],"key":"iEQvgpLetF"},{"type":"text","value":". La matriz de confusión demuestra un desempeño diferente al planteado, donde se tuvo una mejoria en la clasificacion de la clase 1, a costo de la clase mayoritaria 0.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vyT8iqzI9e"}],"key":"pKhrb6UXxk"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SdRUSOko9I"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AJIjoVvPFD"}],"key":"uUbDZ02PN1"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UlhQkdD8YT"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.71","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aCBPUImxtV"}],"key":"RTRIlFHyBw"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eOooesfW5E"}],"key":"SPpNvn80RZ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"En este caso, los mejores parametros fueron {‘clf__border_count’: 32, ‘clf__l2_leaf_reg’: 1}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"t6q1LnTqGH"}],"key":"crFCxEJgaq"}],"key":"WB8vjW1wCs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.2.4 LightGBM","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k3hhVxFzy9"}],"key":"lbATJIY9IR"}],"identifier":"id-2-2-4-lightgbm","label":"2.2.4 LightGBM","html_id":"id-2-2-4-lightgbm","implicit":true,"key":"v7KnpRS7RL"}],"key":"d6sFBgxqJr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_lgb = GridSearchCV(\n    estimator=pipe_lgb,\n    param_grid=param_grids[\"LightGBM\"],\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"ifSYLVr3WU"},{"type":"output","id":"sGZyObw4rwMfzAVJkKEGQ","data":[],"key":"yGchyp5M8h"}],"key":"Sp3PeN9wi1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_lgb.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_lgb = grid_lgb.predict(X_test)\n\nprint(\"\\nResultados - LightGBM\")\nprint(classification_report(y_test, y_pred_lgb))\nprint(\"Mejores parámetros:\", grid_lgb.best_params_)\n\nConfusionMatrixDisplay.from_estimator(grid_lgb, X_test, y_test, cmap=\"Blues\")\n\nresultados2.append({\n    \"Modelo\": \"LightGBM + HP\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_lgb),\n    \"Recall\": recall_score(y_test, y_pred_lgb),\n    \"Precision\": precision_score(y_test, y_pred_lgb),\n    \"F1\": f1_score(y_test, y_pred_lgb),\n    \"AUC\": roc_auc_score(y_test, y_pred_lgb),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_lgb.best_params_\n})","key":"gluuY6CB3z"},{"type":"output","id":"aNQGyyeByStZZwAM8mY9P","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 108 candidates, totalling 540 fits\n[LightGBM] [Info] Number of positive: 1495, number of negative: 4139\n[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0,000361 seconds.\nYou can set `force_row_wise=true` to remove the overhead.\nAnd if memory is not enough, you can set `force_col_wise=true`.\n[LightGBM] [Info] Total Bins 415\n[LightGBM] [Info] Number of data points in the train set: 5634, number of used features: 45\n[LightGBM] [Info] [binary:BoostFromScore]: pavg=0,265353 -> initscore=-1,018328\n[LightGBM] [Info] Start training from score -1,018328\n\nResultados - LightGBM\n              precision    recall  f1-score   support\n\n           0       0.83      0.89      0.86      1035\n           1       0.63      0.51      0.57       374\n\n    accuracy                           0.79      1409\n   macro avg       0.73      0.70      0.71      1409\nweighted avg       0.78      0.79      0.78      1409\n\nMejores parámetros: {'clf__colsample_bytree': 1.0, 'clf__max_bin': 255, 'clf__min_child_samples': 10, 'clf__min_child_weight': 0.001, 'clf__reg_alpha': 0, 'clf__reg_lambda': 1, 'clf__subsample': 0.8}\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\nc:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c95aa958492974bc127f4803dac4b706","path":"/c95aa958492974bc127f4803dac4b706.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"nQu6jvSeIc"}],"key":"XP2BVegHED"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\n\nConfusionMatrixDisplay.from_estimator(grid_lgb, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - LightGBM\")\n\nRocCurveDisplay.from_estimator(grid_lgb, X_test, y_test, ax=axes[1])\naxes[1].plot([0, 1], [0, 1], \"k--\")\naxes[1].set_title(\"Curva ROC - LightGBM\")\naxes[1].legend()\n\nplt.tight_layout()\nplt.show()","key":"zbwLq0WPcZ"},{"type":"output","id":"d8bWx0hnDi1Hcb9G1GU-W","data":[{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\nc:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b30af8f33c4716bcf9c98e9033492aa1","path":"/b30af8f33c4716bcf9c98e9033492aa1.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"jVqIpoVZ9p"}],"key":"D2zvF2m7qR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CyRcqjrvaj"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo Hiperparametrizado","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DpfelleRIC"}],"key":"fM1yHxHja0"},{"type":"text","value":" de LightGBM nos da un resultado interesante, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pZjBblAZI0"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.79","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TOfXYHc2MV"}],"key":"PjXcYzJSoK"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qu3D1Jj89M"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.84","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fEFBpO2AIL"}],"key":"REHNXFU4ij"},{"type":"text","value":". La matriz de confusión demuestra un desempeño diferente al planteado, donde se tuvo una mejoria en la clasificacion de la clase 1, a costo de la clase mayoritaria 0.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HJaFr5Yx0I"}],"key":"KbFUUGaptH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hPDn7N6PdQ"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OY0BrIW8Vi"}],"key":"blBJmQ1wA0"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"C47Irs2rW8"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.70","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wxBKKzPie9"}],"key":"zqhgZWZ2uF"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DgizMEcypQ"}],"key":"h71QdEmvjV"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"En este caso, los mejores parametros fueron: {‘clf__colsample_bytree’: 1.0, ‘clf__max_bin’: 255, ‘clf__min_child_samples’: 10, ‘clf__min_child_weight’: 0.001, ‘clf__reg_alpha’: 0, ‘clf__reg_lambda’: 1, ‘clf__subsample’: 0.8}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ebBVi0rYN3"}],"key":"FLEFF0Y1c2"}],"key":"Z3XJ2IsT1P"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.2.5 Resultados Preliminares","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DBuQYryGh3"}],"key":"fNO6yaV2Ea"}],"identifier":"id-2-2-5-resultados-preliminares","label":"2.2.5 Resultados Preliminares","html_id":"id-2-2-5-resultados-preliminares","implicit":true,"key":"wFNsO4RIcW"}],"key":"pSm1OBr57w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"res2_df = pd.DataFrame(resultados2)\nres2_df_sorted = res2_df.sort_values(by=\"Recall\", ascending=False)\nprint(\"\\n Resultados finales:\")\ndisplay(res2_df_sorted)","key":"Ul1qq0uWgT"},{"type":"output","id":"IB8H9LNHuxhJkXBy1MA3B","data":[{"name":"stdout","output_type":"stream","text":"\n Resultados finales:\n"},{"output_type":"display_data","metadata":{},"data":{"application/vnd.microsoft.datawrangler.viewer.v0+json":{"content":"{\"columns\":[{\"name\":\"index\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"Modelo\",\"rawType\":\"object\",\"type\":\"string\"},{\"name\":\"Accuracy\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Recall\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Precision\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"F1\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"AUC\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Tiempo (s)\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Mejores Parámetros\",\"rawType\":\"object\",\"type\":\"unknown\"}],\"ref\":\"70c94261-37e4-42d4-a66e-e1bb351f8859\",\"rows\":[[\"1\",\"XGBoost + HP\",\"0.7083037615330021\",\"0.8475935828877005\",\"0.47242921013412814\",\"0.6066985645933014\",\"0.7527822986902271\",\"24.53\",\"{'clf__gamma': 1, 'clf__min_child_weight': 5, 'clf__reg_alpha': 0, 'clf__reg_lambda': 5, 'clf__scale_pos_weight': 5, 'clf__subsample': 1.0}\"],[\"2\",\"CatBoost + HP\",\"0.7913413768630234\",\"0.5454545454545454\",\"0.6219512195121951\",\"0.5811965811965812\",\"0.7128238910847606\",\"30.81\",\"{'clf__border_count': 32, 'clf__l2_leaf_reg': 1}\"],[\"3\",\"LightGBM + HP\",\"0.7920511000709723\",\"0.5106951871657754\",\"0.6345514950166113\",\"0.5659259259259259\",\"0.7022074969645302\",\"42.95\",\"{'clf__colsample_bytree': 1.0, 'clf__max_bin': 255, 'clf__min_child_samples': 10, 'clf__min_child_weight': 0.001, 'clf__reg_alpha': 0, 'clf__reg_lambda': 1, 'clf__subsample': 0.8}\"],[\"0\",\"RandomForest + HP\",\"0.7977288857345636\",\"0.49732620320855614\",\"0.657243816254417\",\"0.5662100456621004\",\"0.7018031982226355\",\"25.0\",\"{'clf__bootstrap': True, 'clf__criterion': 'gini', 'clf__max_features': 'sqrt', 'clf__min_samples_leaf': 2, 'clf__min_samples_split': 5}\"]],\"shape\":{\"columns\":8,\"rows\":4}}","content_type":"application/vnd.microsoft.datawrangler.viewer.v0+json"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Modelo</th>\n      <th>Accuracy</th>\n      <th>Recall</th>\n      <th>Precision</th>\n      <th>F1</th>\n      <th>AUC</th>\n      <th>Tiempo (s)</th>\n      <th>Mejores Parámetros</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>XGBoost + HP</td>\n      <td>0.708304</td>\n      <td>0.847594</td>\n      <td>0.472429</td>\n      <td>0.606699</td>\n      <td>0.752782</td>\n      <td>24.53</td>\n      <td>{'clf__gamma': 1, 'clf__min_child_weight': 5, ...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>CatBoost + HP</td>\n      <td>0.791341</td>\n      <td>0.545455</td>\n      <td>0.621951</td>\n      <td>0.581197</td>\n      <td>0.712824</td>\n      <td>30.81</td>\n      <td>{'clf__border_count': 32, 'clf__l2_leaf_reg': 1}</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>LightGBM + HP</td>\n      <td>0.792051</td>\n      <td>0.510695</td>\n      <td>0.634551</td>\n      <td>0.565926</td>\n      <td>0.702207</td>\n      <td>42.95</td>\n      <td>{'clf__colsample_bytree': 1.0, 'clf__max_bin':...</td>\n    </tr>\n    <tr>\n      <th>0</th>\n      <td>RandomForest + HP</td>\n      <td>0.797729</td>\n      <td>0.497326</td>\n      <td>0.657244</td>\n      <td>0.566210</td>\n      <td>0.701803</td>\n      <td>25.00</td>\n      <td>{'clf__bootstrap': True, 'clf__criterion': 'gi...</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"              Modelo  Accuracy    Recall  Precision        F1       AUC  \\\n1       XGBoost + HP  0.708304  0.847594   0.472429  0.606699  0.752782   \n2      CatBoost + HP  0.791341  0.545455   0.621951  0.581197  0.712824   \n3      LightGBM + HP  0.792051  0.510695   0.634551  0.565926  0.702207   \n0  RandomForest + HP  0.797729  0.497326   0.657244  0.566210  0.701803   \n\n   Tiempo (s)                                 Mejores Parámetros  \n1       24.53  {'clf__gamma': 1, 'clf__min_child_weight': 5, ...  \n2       30.81   {'clf__border_count': 32, 'clf__l2_leaf_reg': 1}  \n3       42.95  {'clf__colsample_bytree': 1.0, 'clf__max_bin':...  \n0       25.00  {'clf__bootstrap': True, 'clf__criterion': 'gi...  ","content_type":"text/plain"}}}],"key":"sR2fn5j3e4"}],"key":"FsSxrTxIsm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"metricas = [\"Accuracy\", \"Recall\", \"Precision\", \"F1\", \"AUC\"]\n\nres2_df_sorted = res2_df.sort_values(by=\"Recall\", ascending=False).reset_index(drop=True)\n\nres2_melt = res2_df_sorted.melt(\n    id_vars=\"Modelo\", \n    value_vars=metricas, \n    var_name=\"Métrica\", \n    value_name=\"Valor\"\n)","key":"PeWPbF9Z5k"},{"type":"output","id":"g8qacqLse9Njk373ediqa","data":[],"key":"K4ms3dYZr3"}],"key":"nzQ4qFr3JT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(16, 6))\n\nsns.barplot(\n    data=res2_melt, \n    x=\"Modelo\", \n    y=\"Valor\", \n    hue=\"Métrica\", \n    palette=\"Blues_r\", \n    ax=axes[0]\n)\naxes[0].set_title(\"Comparación de Métricas por Modelo\", fontsize=14)\naxes[0].set_ylim(0, 1)\naxes[0].set_ylabel(\"Valor de la Métrica\")\naxes[0].set_xlabel(\"Modelo\")\naxes[0].legend(title=\"Métrica\", bbox_to_anchor=(1.05, 1), loc=\"upper left\")\n\nsns.barplot(\n    data=res2_df_sorted, \n    x=\"Modelo\", \n    y=\"Tiempo (s)\", \n    palette=\"Blues_r\", \n    ax=axes[1]\n)\naxes[1].set_title(\"Tiempo de Entrenamiento por Modelo\", fontsize=14)\naxes[1].set_ylabel(\"Tiempo (segundos)\")\naxes[1].set_xlabel(\"Modelo\")\n\nplt.tight_layout()\nplt.show()\n","key":"yNRgLJbrYe"},{"type":"output","id":"7Fu_hu_EyOiPw2sG_Gqcz","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\2340569329.py:17: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fcca4bbf6090d3322b38b05acb599f43","path":"/fcca4bbf6090d3322b38b05acb599f43.png"},"text/plain":{"content":"<Figure size 1600x600 with 2 Axes>","content_type":"text/plain"}}}],"key":"BQbFGaBoiY"}],"key":"CYOFvioWmu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"De forma preliminar, vemos que los modelos de CatBoost y XGBoost tienen mejores metricas al comparar con otros modelos. En este caso, la metrica de interes es Recall (ya que queremos reducir los falsos negativos para este caso), y tanto XGBoost como LightGBM alcanzaron los mejores rendimientos. Junto a esto, notamos que XGBoost tuvo una duracion elevada a comparacion del resto (CatBoost, LightGBM y RandomForest)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K9HfLhLCwK"}],"key":"lL84LBOXsy"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Los modelos de XGBoost y RandomForest fueron los que menos duracion tuvieron a la hora de ejecutar.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"e9HLXAulLo"}],"key":"dgEBTGj2kR"}],"key":"kv8oUtqfoE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\n\nmodelos_entrenados = {\n    \"RandomForest\": grid_rf,\n    \"XGBoost\": grid_xgb,\n    \"CatBoost\": grid_cat,\n    \"LightGBM\": grid_lgb\n}\n\nfor name, model in modelos_entrenados.items():\n    RocCurveDisplay.from_estimator(model, X_test, y_test, ax=plt.gca(), name=name)\n\nplt.plot([0, 1], [0, 1], \"k--\", label=\"Aleatorio\")\n\nplt.title(\"Comparación de Curvas ROC /w HP\", fontsize=14)\nplt.xlabel(\"Tasa de Falsos Positivos (FPR)\")\nplt.ylabel(\"Tasa de Verdaderos Positivos (TPR)\")\nplt.legend(loc=\"lower right\")\nplt.grid(alpha=0.3)\nplt.tight_layout()\nplt.show()","key":"J8YOoSOgwt"},{"type":"output","id":"Phk5QHEcFoHgcljAfP95L","data":[{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2a1b212f56aec87e9a509f324f860c51","path":"/2a1b212f56aec87e9a509f324f860c51.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"gXVlSsbCHF"}],"key":"iWu799CsnY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Comparando curvas ROC, los rendimientos son bastantes similares a la grafica anterior, con LightGBM y XGBoost con un AUC de 0.84, con los modelos restantes estando con 0.83 (RandomForest) y 0.83 (CatBoost) respectivamente, teniendo un desempeño muy similar en comparacion.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YngsOnbmSh"}],"key":"BlQlOuaFGB"}],"key":"U8e8BgINvv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.3 Modelos con tecnicas de balanceo + GPU (RandomForest, XGboost, CatBoost, LightGBM) e hiperparametros establecidos","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nd1DaeLCpw"}],"key":"nVKSiShYMd"}],"identifier":"id-2-3-modelos-con-tecnicas-de-balanceo-gpu-randomforest-xgboost-catboost-lightgbm-e-hiperparametros-establecidos","label":"2.3 Modelos con tecnicas de balanceo + GPU (RandomForest, XGboost, CatBoost, LightGBM) e hiperparametros establecidos","html_id":"id-2-3-modelos-con-tecnicas-de-balanceo-gpu-randomforest-xgboost-catboost-lightgbm-e-hiperparametros-establecidos","implicit":true,"key":"DH75lrmkUg"}],"key":"wAgh5SmAt0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta ultima seccion, usaremos los modelos anteriores y aplicaremos el uso de GPU para maximizar el tiempo de computo, manteniendo la complejidad de los modelos, con hiperparametros y validacion cruzada entre estos. Junto a lo anterior, aplicaremos un metodo especifico de balanceo a cada modelo para observar su rendimiento.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pHPHAUGemz"}],"key":"EwEp0ssoO4"}],"key":"ElBxAIh2Xq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"TensorFlow GPU disponible:\", tf.config.list_physical_devices('GPU'))","key":"iVlmT4fIat"},{"type":"output","id":"3PV8rGGpJ4N0OzoxjvfHY","data":[{"name":"stdout","output_type":"stream","text":"TensorFlow GPU disponible: [PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')]\n"}],"key":"h0QG0FPFZH"}],"key":"FnUXfTngmS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"X_dummy = np.random.rand(1000, 10)\ny_dummy = np.random.randint(0, 2, 1000)\n\nmodel = XGBClassifier(\n    tree_method=\"gpu_hist\",\n    predictor=\"gpu_predictor\",\n    use_label_encoder=False,\n    eval_metric=\"logloss\"\n)\n\nmodel.fit(X_dummy, y_dummy)\nprint(\"XGBoost entrenado en GPU con éxito.\")","key":"gH5chSoYBr"},{"type":"output","id":"hgc7NcEFcg8PSEPF9B80h","data":[{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\xgboost\\core.py:158: UserWarning: [14:18:54] WARNING: C:\\buildkite-agent\\builds\\buildkite-windows-cpu-autoscaling-group-i-08cbc0333d8d4aae1-1\\xgboost\\xgboost-ci-windows\\src\\common\\error_msg.cc:27: The tree method `gpu_hist` is deprecated since 2.0.0. To use GPU training, set the `device` parameter to CUDA instead.\n\n    E.g. tree_method = \"hist\", device = \"cuda\"\n\n  warnings.warn(smsg, UserWarning)\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\xgboost\\core.py:158: UserWarning: [14:18:54] WARNING: C:\\buildkite-agent\\builds\\buildkite-windows-cpu-autoscaling-group-i-08cbc0333d8d4aae1-1\\xgboost\\xgboost-ci-windows\\src\\learner.cc:740: \nParameters: { \"predictor\", \"use_label_encoder\" } are not used.\n\n  warnings.warn(smsg, UserWarning)\n"},{"name":"stdout","output_type":"stream","text":"XGBoost entrenado en GPU con éxito.\n"}],"key":"aoKAIoSPEa"}],"key":"VqQvpR3cDa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model = LGBMClassifier(device=\"gpu\")\nprint(\"LightGBM GPU activo:\", model.get_params()[\"device\"])","key":"vwBO0hDeSb"},{"type":"output","id":"qGZwVFvpzlh2HTPxspW15","data":[{"name":"stdout","output_type":"stream","text":"LightGBM GPU activo: gpu\n"}],"key":"dPXyLdhrZs"}],"key":"dGLx1BY9jM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df = pd.read_csv(\"data_churn_EDA.csv\")","key":"o7rEqnoQhf"},{"type":"output","id":"Xei1cy013YaHRBf-oNkgX","data":[],"key":"EKLO2TANEE"}],"key":"DgIimJom6i"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"X = df.drop(\"churn\", axis=1)\ny = df[\"churn\"]\n\nnum_cols = X.select_dtypes(include=[\"int64\", \"float64\"]).columns.tolist()\ncat_cols = X.select_dtypes(include=[\"object\", \"category\"]).columns.tolist()","key":"Y9A6R4H7T8"},{"type":"output","id":"5F08IkEpnOrdEcNsMupoL","data":[],"key":"hoNWAaNmpp"}],"key":"nRv9mJqWXY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"X_train, X_test, y_train, y_test = train_test_split(X, y, stratify=y, test_size=0.2, random_state=42)","key":"RZXYTLWVxX"},{"type":"output","id":"svHBIxjJL41FH1A8wqWO0","data":[],"key":"OAEjlbHVpk"}],"key":"jFmzqJe27Q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = ColumnTransformer([\n    (\"num\", StandardScaler(), num_cols),\n    (\"cat\", OneHotEncoder(handle_unknown=\"ignore\"), cat_cols)\n])\n\nprint(\"Categóricas:\", cat_cols)\nprint(\"Numéricas:\", num_cols)\n\nsmote = SMOTE(random_state=42)","key":"Fyoz3vpvpG"},{"type":"output","id":"WUegECq4FNgX6j9FrmesC","data":[{"name":"stdout","output_type":"stream","text":"Categóricas: ['gender', 'senior', 'partner', 'dependents', 'phone', 'phone_multiple', 'internet', 'internet_security', 'internet_backup', 'internet_protection', 'internet_support', 'streaming_tv', 'streaming_movies', 'contract', 'paperless', 'payment']\nNuméricas: ['tenure', 'charges_monthly']\n"}],"key":"xDu0n3vCrB"}],"key":"x1zpZnFQEm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"n_pos = df['churn'].value_counts()[1]\nn_neg = df['churn'].value_counts()[0]\nw1 = n_neg / n_pos  \nw0 = 1\n\nmodels = {\n    \"RandomForest\": RandomForestClassifier(\n        random_state=42\n    ),\n\n    \"XGBoost\": XGBClassifier(\n        tree_method=\"hist\",\n        predictor=\"cpu_predictor\",  # fuerza CPU en predicción\n        use_label_encoder=False,\n        eval_metric=\"logloss\",\n        scale_pos_weight=w1,  \n        random_state=42\n    ),\n\n    \"LightGBM\": LGBMClassifier(\n        device=\"gpu\",\n        is_unbalance=True, \n        random_state=42\n    )\n}","key":"XcqwHQYsH9"},{"type":"output","id":"WTjv8_yTflZJyL6xWa3Ho","data":[],"key":"aI3gNZ28QF"}],"key":"O3m4B0xVbs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from imblearn.pipeline import Pipeline\n\n\npipe_rf = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"smote\", SMOTE(random_state=42)),  \n    (\"clf\", models[\"RandomForest\"])\n])\n\npipe_xgb = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", models[\"XGBoost\"])\n])\n\npipe_lgb = Pipeline([\n    (\"preprocessor\", preprocessor),\n    (\"clf\", models[\"LightGBM\"]) \n])","key":"Kr3cGk47gx"},{"type":"output","id":"Psa0mUydg6ocH86FXcQEF","data":[],"key":"BrRaKnj1uj"}],"key":"tJpH5pHH3h"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n\nparam_grids = {\n    \"RandomForest\": {\n        \"clf__min_samples_split\": [2, 5, 10],\n        \"clf__min_samples_leaf\": [1, 2, 4],\n        \"clf__max_features\": [\"sqrt\", \"log2\"],\n        \"clf__bootstrap\": [True, False],\n        \"clf__criterion\": [\"gini\", \"entropy\"]\n    },\n    \"XGBoost\": {\n        \"clf__subsample\": [0.8, 1.0],\n        \"clf__gamma\": [0, 1],\n        \"clf__min_child_weight\": [1, 5],\n        \"clf__reg_alpha\": [0, 0.1, 0.5],\n        \"clf__reg_lambda\": [1, 2, 5],\n        \"clf__scale_pos_weight\": [1, 2, 5]\n    },\n\n    \"LightGBM\": {\n        \"clf__min_child_samples\": [10, 20, 50],\n        \"clf__min_child_weight\": [1e-3, 1e-2, 1e-1],\n        \"clf__subsample\": [0.8, 1.0],\n        \"clf__colsample_bytree\": [0.8, 1.0],\n        \"clf__reg_alpha\": [0],\n        \"clf__reg_lambda\": [0, 0.5, 1],\n        \"clf__max_bin\": [255]\n    }\n}\n\nresultados3 = []","key":"b36lozlkTg"},{"type":"output","id":"VyFgYBiGr4POScBCgwLF3","data":[],"key":"tRt4P21kMN"}],"key":"WIABDip0ro"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.3.1 RandomForest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QuBE3H9flR"}],"key":"OiGcoF5msv"}],"identifier":"id-2-3-1-randomforest","label":"2.3.1 RandomForest","html_id":"id-2-3-1-randomforest","implicit":true,"key":"yXVYi5fSg2"}],"key":"xIb2siUEQA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_rf = GridSearchCV(\n    estimator=pipe_rf,\n    param_grid=param_grids[\"RandomForest\"],\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"AexR23CHch"},{"type":"output","id":"qJx0baoRGYE0C2F3Yq5zf","data":[],"key":"XOBqOlqYPv"}],"key":"IjXNmlMJVB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_rf.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_rf = grid_rf.predict(X_test)\n\nprint(\"\\n Resultados - RandomForest\")\nprint(classification_report(y_test, y_pred_rf))\nprint(\"---------------------------------------------\")\nprint(\"Mejores parámetros:\", grid_rf.best_params_)\n\nresultados3.append({\n    \"Modelo\": \"RandomForest + HP + SMOTE (GPU)\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_rf),\n    \"Recall\": recall_score(y_test, y_pred_rf),\n    \"Precision\": precision_score(y_test, y_pred_rf),\n    \"F1\": f1_score(y_test, y_pred_rf),\n    \"AUC\": roc_auc_score(y_test, y_pred_rf),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_rf.best_params_\n})","key":"EFfoke2l6L"},{"type":"output","id":"ffTtbhJbXy654eNuZQQnw","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 72 candidates, totalling 360 fits\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\base.py:474: FutureWarning: `BaseEstimator._validate_data` is deprecated in 1.6 and will be removed in 1.7. Use `sklearn.utils.validation.validate_data` instead. This function becomes public and is part of the scikit-learn developer API.\n  warnings.warn(\n"},{"name":"stdout","output_type":"stream","text":"\n Resultados - RandomForest\n              precision    recall  f1-score   support\n\n           0       0.86      0.81      0.83      1035\n           1       0.54      0.64      0.59       374\n\n    accuracy                           0.76      1409\n   macro avg       0.70      0.72      0.71      1409\nweighted avg       0.78      0.76      0.77      1409\n\n---------------------------------------------\nMejores parámetros: {'clf__bootstrap': True, 'clf__criterion': 'gini', 'clf__max_features': 'log2', 'clf__min_samples_leaf': 4, 'clf__min_samples_split': 2}\n"}],"key":"VtXHxD3jIW"}],"key":"J01z2yExCU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\nConfusionMatrixDisplay.from_estimator(grid_rf, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - RandomForest\")\n\nRocCurveDisplay.from_estimator(grid_rf, X_test, y_test, ax=axes[1], name=\"RandomForest\")\naxes[1].plot([0, 1], [0, 1], \"k--\")\naxes[1].set_title(\"Curva ROC - RandomForest\")\n\nplt.tight_layout()\nplt.show()","key":"NtR3kEAqwe"},{"type":"output","id":"tPJKyDswU7BmzzR6cCN4-","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4519c736019995bb7504608fdffeadca","path":"/4519c736019995bb7504608fdffeadca.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"oj3CPWdMcl"}],"key":"iWqrXIDAIx"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZSBeCz95k6"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo Hiperparametrizado + Balaceno y GPU","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CuPduzVR7m"}],"key":"zxdbFNrPbM"},{"type":"text","value":" de Random Forest nos da un resultado interesante, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EjrCRkWfM9"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.76","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tz2B0wS7RU"}],"key":"gmJ36Iddkt"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pcwIOMiCwc"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.83","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iIRO2SNcAR"}],"key":"s7vidvKEDl"},{"type":"text","value":". La matriz de confusión demuestra un desempeño normal, enfatizando el desbalance que hay entre las clases, ya que la clase mayoritaria (positiva) tiene mayores tasas de clasificacion a diferencia de la clase negativa. En esta ultima clase, la tasa tanto de positivos como negativos es casi equivalente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xcONNhaV6T"}],"key":"nTwhYB5k1a"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Wjf4Nbrd3a"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EGILKD1A5p"}],"key":"EVyBMJAv5O"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Xp3vawVTAB"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.72","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Y2wHzNtBw9"}],"key":"R8UAjUrfxu"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yj5ZCLnNT6"}],"key":"yy5swST3Bp"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Los mejores parametros fueron: {‘clf__bootstrap’: True, ‘clf__criterion’: ‘gini’, ‘clf__max_features’: ‘log2’, ‘clf__min_samples_leaf’: 4, ‘clf__min_samples_split’: 2}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xFTzrS5XyU"}],"key":"v0CKZM4NeO"}],"key":"cg81JQDZ53"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.3.2 XGBoost","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d6wGY7lsCP"}],"key":"VqWQN6dTtp"}],"identifier":"id-2-3-2-xgboost","label":"2.3.2 XGBoost","html_id":"id-2-3-2-xgboost","implicit":true,"key":"Rksjq6qGBv"}],"key":"pp23DuLn2L"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_xgb = GridSearchCV(\n    estimator=pipe_xgb,\n    param_grid=param_grids[\"XGBoost\"],\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"ESZlVMpCjm"},{"type":"output","id":"f0PuGg01RgPgwPYtNN2QD","data":[],"key":"VifYPFaQis"}],"key":"Sg6EcXj6ML"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_xgb.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_xgb = grid_xgb.predict(X_test)\n\nprint(\"\\n Resultados - XGBoost\")\nprint(classification_report(y_test, y_pred_xgb))\nprint(\"---------------------------------------------\")\nprint(\"Mejores parámetros:\", grid_xgb.best_params_)\n\nresultados3.append({\n    \"Modelo\": \"XGBoost + HP + scale_pos_weight=w1 (GPU)\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_xgb),\n    \"Recall\": recall_score(y_test, y_pred_xgb),\n    \"Precision\": precision_score(y_test, y_pred_xgb),\n    \"F1\": f1_score(y_test, y_pred_xgb),\n    \"AUC\": roc_auc_score(y_test, y_pred_xgb),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_xgb.best_params_\n})","key":"YC5lIe1jD3"},{"type":"output","id":"HkLPeN7SmPhQEtZFnz-qe","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 216 candidates, totalling 1080 fits\n\n Resultados - XGBoost\n              precision    recall  f1-score   support\n\n           0       0.92      0.66      0.77      1035\n           1       0.47      0.85      0.61       374\n\n    accuracy                           0.71      1409\n   macro avg       0.70      0.75      0.69      1409\nweighted avg       0.80      0.71      0.73      1409\n\n---------------------------------------------\nMejores parámetros: {'clf__gamma': 1, 'clf__min_child_weight': 5, 'clf__reg_alpha': 0, 'clf__reg_lambda': 5, 'clf__scale_pos_weight': 5, 'clf__subsample': 1.0}\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\xgboost\\core.py:158: UserWarning: [13:36:20] WARNING: C:\\buildkite-agent\\builds\\buildkite-windows-cpu-autoscaling-group-i-08cbc0333d8d4aae1-1\\xgboost\\xgboost-ci-windows\\src\\learner.cc:740: \nParameters: { \"predictor\", \"use_label_encoder\" } are not used.\n\n  warnings.warn(smsg, UserWarning)\n"}],"key":"U61EHLZ7Lb"}],"key":"idTetPpl1V"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\nConfusionMatrixDisplay.from_estimator(grid_xgb, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - XGBoost\")\n\nRocCurveDisplay.from_estimator(grid_xgb, X_test, y_test, ax=axes[1], name=\"XGBoost\")\naxes[1].plot([0, 1], [0, 1], \"k--\")\naxes[1].set_title(\"Curva ROC - XGBoost\")\n\nplt.tight_layout()\nplt.show()","key":"XY0l9kiZtF"},{"type":"output","id":"THPtu0lII3F_PPbU1Xn91","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3def07d83de8008f8d020743bcfdc733","path":"/3def07d83de8008f8d020743bcfdc733.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"WIpCHe6nWp"}],"key":"mCL1ZwZSpM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yngV7pNujb"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo Hiperparametrizado + Balaceno y GPU","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Melhn93FIc"}],"key":"xs5QNasmRx"},{"type":"text","value":" de XGBoost nos da un resultado interesante, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qtkWdiC0f2"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.71","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bojmx3AwhD"}],"key":"q7PXaFOfUI"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pGPYVm3gCu"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.84","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tdgU8nGJGq"}],"key":"nv3FTduuG8"},{"type":"text","value":". La matriz de confusión demuestra un desempeño normal, enfatizando el desbalance que hay entre las clases, ya que la clase mayoritaria (positiva) tiene mayores tasas de clasificacion a diferencia de la clase negativa. En esta ultima clase, la tasa tanto de positivos como negativos es casi equivalente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dPUUPWO79S"}],"key":"pAZ9lkPx5X"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TUfuFPNaMk"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dBIbtksqGE"}],"key":"yG385bvL7t"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VfapMmZm51"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.75","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wqRMOzj2rw"}],"key":"roNfnXLDcb"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lUvpbVwVP7"}],"key":"dN9iR3GCZD"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Los mejores parametros fueron: {‘clf__gamma’: 1, ‘clf__min_child_weight’: 5, ‘clf__reg_alpha’: 0, ‘clf__reg_lambda’: 5, ‘clf__scale_pos_weight’: 5, ‘clf__subsample’: 1.0}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IsYYhR5XKM"}],"key":"jdV8UFSaIg"}],"key":"uoGaFQJkfj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.3.4 LightGBM","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yewOfC6OOU"}],"key":"cT6z0VSyxJ"}],"identifier":"id-2-3-4-lightgbm","label":"2.3.4 LightGBM","html_id":"id-2-3-4-lightgbm","implicit":true,"key":"wHGLaNTT9d"}],"key":"i5MkPgZLfk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"grid_lgb = GridSearchCV(\n    estimator=pipe_lgb,\n    param_grid=param_grids[\"LightGBM\"],\n    scoring=\"recall\",\n    cv=cv,\n    n_jobs=-1,\n    verbose=1\n)","key":"JEY3ve6deN"},{"type":"output","id":"sKmDUX3kR6-bAumn-QKhr","data":[],"key":"jQLGLWZh6m"}],"key":"UNnxkSBkBA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inicio = time.time()\ngrid_lgb.fit(X_train, y_train)\nfin = time.time()\n\ny_pred_lgb = grid_lgb.predict(X_test)\n\nprint(\"\\nResultados - LightGBM\")\nprint(classification_report(y_test, y_pred_lgb))\nprint(\"Mejores parámetros:\", grid_lgb.best_params_)\n\nConfusionMatrixDisplay.from_estimator(grid_lgb, X_test, y_test, cmap=\"Blues\")\n\nresultados3.append({\n    \"Modelo\": \"LightGBM + HP + is_unbalance=True (GPU)\",\n    \"Accuracy\": accuracy_score(y_test, y_pred_lgb),\n    \"Recall\": recall_score(y_test, y_pred_lgb),\n    \"Precision\": precision_score(y_test, y_pred_lgb),\n    \"F1\": f1_score(y_test, y_pred_lgb),\n    \"AUC\": roc_auc_score(y_test, y_pred_lgb),\n    \"Tiempo (s)\": round(fin - inicio, 2),\n    \"Mejores Parámetros\": grid_lgb.best_params_\n})","key":"vvEH7WcNuB"},{"type":"output","id":"1jIwGH0YbWAq6zXXXMQnG","data":[{"name":"stdout","output_type":"stream","text":"Fitting 5 folds for each of 108 candidates, totalling 540 fits\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\joblib\\externals\\loky\\process_executor.py:782: UserWarning: A worker stopped while some jobs were given to the executor. This can be caused by a too short worker timeout or by a memory leak.\n  warnings.warn(\n"},{"name":"stdout","output_type":"stream","text":"[LightGBM] [Info] Number of positive: 1495, number of negative: 4139\n[LightGBM] [Info] This is the GPU trainer!!\n[LightGBM] [Info] Total Bins 415\n[LightGBM] [Info] Number of data points in the train set: 5634, number of used features: 45\n[LightGBM] [Info] Using GPU Device: NVIDIA GeForce RTX 3050 6GB Laptop GPU, Vendor: NVIDIA Corporation\n[LightGBM] [Info] Compiling OpenCL Kernel with 256 bins...\n[LightGBM] [Info] GPU programs have been built\n[LightGBM] [Info] Size of histogram bin entry: 8\n[LightGBM] [Info] 15 dense feature groups (0,09 MB) transferred to GPU in 0,001572 secs. 1 sparse feature groups\n[LightGBM] [Info] [binary:BoostFromScore]: pavg=0,265353 -> initscore=-1,018328\n[LightGBM] [Info] Start training from score -1,018328\n\nResultados - LightGBM\n              precision    recall  f1-score   support\n\n           0       0.89      0.76      0.82      1035\n           1       0.53      0.74      0.62       374\n\n    accuracy                           0.76      1409\n   macro avg       0.71      0.75      0.72      1409\nweighted avg       0.79      0.76      0.77      1409\n\nMejores parámetros: {'clf__colsample_bytree': 1.0, 'clf__max_bin': 255, 'clf__min_child_samples': 50, 'clf__min_child_weight': 0.001, 'clf__reg_alpha': 0, 'clf__reg_lambda': 0.5, 'clf__subsample': 0.8}\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\nc:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8e7c72093e0ee675ab5db319b4b5182d","path":"/8e7c72093e0ee675ab5db319b4b5182d.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}}],"key":"gEanQN6q7U"}],"key":"JCPvGyhKGw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\n\nConfusionMatrixDisplay.from_estimator(grid_lgb, X_test, y_test, cmap=\"Blues\", ax=axes[0])\naxes[0].set_title(\"Matriz de Confusión - LightGBM\")\n\nRocCurveDisplay.from_estimator(grid_lgb, X_test, y_test, ax=axes[1])\naxes[1].plot([0, 1], [0, 1], \"k--\")\naxes[1].set_title(\"Curva ROC - LightGBM\")\naxes[1].legend()\n\nplt.tight_layout()\nplt.show()","key":"i8iF84IwTV"},{"type":"output","id":"5B280qMUBuysK8VbC0hzC","data":[{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\nc:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d563a486a9f9a22e5331ee029cb5215f","path":"/d563a486a9f9a22e5331ee029cb5215f.png"},"text/plain":{"content":"<Figure size 1200x500 with 3 Axes>","content_type":"text/plain"}}}],"key":"spbT1EGyA4"}],"key":"PTco16jsxp"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"El conjunto de resultados del ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SJuQd10rHB"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modelo Hiperparametrizado + Balaceno y GPU","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"s0YUnsgG7Q"}],"key":"tS8NrG7REs"},{"type":"text","value":" de XGBoost nos da un resultado interesante, presentando un rendimiento de prueba sólido con una ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rcviLxTcKx"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accuracy de 0.76","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E24IusXBKw"}],"key":"HZsJeMIucD"},{"type":"text","value":" y un ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PPnQ5hqiSl"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AUC de 0.84","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jR9qKdK2M7"}],"key":"JmlnbxJkMn"},{"type":"text","value":". La matriz de confusión demuestra un desempeño normal, enfatizando el desbalance que hay entre las clases, ya que la clase mayoritaria (positiva) tiene mayores tasas de clasificacion a diferencia de la clase negativa. En esta ultima clase, la tasa tanto de positivos como negativos es casi equivalente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QLk9VBKLaf"}],"key":"tkl1adWxj5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El reporte de clasificación muestra que el modelo es mejor en la identificación de la clase ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AzcZ4jwqKX"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"‘0’","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OB7jpK6fOq"}],"key":"qM1wp2Tywt"},{"type":"text","value":" (clase 1), logrando un ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Y0yRI3FbaN"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall de 0.75","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ux8ln8509g"}],"key":"wCVYeWCso2"},{"type":"text","value":". Este rendimiento indica una situacion interesante de desbalanceo entre las clases, y veremos si esto cambia a medida que implementemos diversos metodos de balanceo e hiperparametrizacion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vT71JdUHuv"}],"key":"v1Suk1TgbA"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Los mejores parametros fueron: {‘clf__colsample_bytree’: 1.0, ‘clf__max_bin’: 255, ‘clf__min_child_samples’: 50, ‘clf__min_child_weight’: 0.001, ‘clf__reg_alpha’: 0, ‘clf__reg_lambda’: 0.5, ‘clf__subsample’: 0.8}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fl3m7p8dMG"}],"key":"tXieyyq9vD"}],"key":"mZqKTQFeAx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.3.5 Resultados preliminares","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N3CwI0WRPL"}],"key":"DXltTuyFa3"}],"identifier":"id-2-3-5-resultados-preliminares","label":"2.3.5 Resultados preliminares","html_id":"id-2-3-5-resultados-preliminares","implicit":true,"key":"QBL9yUg6q1"}],"key":"ZhY9cxQzwq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"res3_df = pd.DataFrame(resultados3)\nres3_df_sorted = res3_df.sort_values(by=\"Recall\", ascending=False)\nprint(\"\\n Resultados finales:\")\ndisplay(res3_df_sorted)","key":"d48t0qKvkR"},{"type":"output","id":"tOhlki5sRFgSnpzDwyROM","data":[{"name":"stdout","output_type":"stream","text":"\n Resultados finales:\n"},{"output_type":"display_data","metadata":{},"data":{"application/vnd.microsoft.datawrangler.viewer.v0+json":{"content":"{\"columns\":[{\"name\":\"index\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"Modelo\",\"rawType\":\"object\",\"type\":\"string\"},{\"name\":\"Accuracy\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Recall\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Precision\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"F1\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"AUC\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Tiempo (s)\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Mejores Parámetros\",\"rawType\":\"object\",\"type\":\"unknown\"}],\"ref\":\"af81c5ae-b5d2-4304-bf3d-605cc6930517\",\"rows\":[[\"1\",\"XGBoost + HP + scale_pos_weight=w1 (GPU)\",\"0.7075940383250532\",\"0.839572192513369\",\"0.47147147147147145\",\"0.6038461538461538\",\"0.7497377870779405\",\"361.79\",\"{'clf__gamma': 1, 'clf__min_child_weight': 5, 'clf__reg_alpha': 0, 'clf__reg_lambda': 5, 'clf__scale_pos_weight': 5, 'clf__subsample': 1.0}\"],[\"2\",\"LightGBM + HP + is_unbalance=True (GPU)\",\"0.7558552164655784\",\"0.7433155080213903\",\"0.5285171102661597\",\"0.6177777777777778\",\"0.7518509907256711\",\"302.2\",\"{'clf__colsample_bytree': 1.0, 'clf__max_bin': 255, 'clf__min_child_samples': 50, 'clf__min_child_weight': 0.001, 'clf__reg_alpha': 0, 'clf__reg_lambda': 0.5, 'clf__subsample': 0.8}\"],[\"0\",\"RandomForest + HP + SMOTE (GPU)\",\"0.7622427253371186\",\"0.6390374331550802\",\"0.5444191343963554\",\"0.5879458794587946\",\"0.7229003590896175\",\"41.86\",\"{'clf__bootstrap': True, 'clf__criterion': 'gini', 'clf__max_features': 'log2', 'clf__min_samples_leaf': 4, 'clf__min_samples_split': 2}\"]],\"shape\":{\"columns\":8,\"rows\":3}}","content_type":"application/vnd.microsoft.datawrangler.viewer.v0+json"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Modelo</th>\n      <th>Accuracy</th>\n      <th>Recall</th>\n      <th>Precision</th>\n      <th>F1</th>\n      <th>AUC</th>\n      <th>Tiempo (s)</th>\n      <th>Mejores Parámetros</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>XGBoost + HP + scale_pos_weight=w1 (GPU)</td>\n      <td>0.707594</td>\n      <td>0.839572</td>\n      <td>0.471471</td>\n      <td>0.603846</td>\n      <td>0.749738</td>\n      <td>361.79</td>\n      <td>{'clf__gamma': 1, 'clf__min_child_weight': 5, ...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>LightGBM + HP + is_unbalance=True (GPU)</td>\n      <td>0.755855</td>\n      <td>0.743316</td>\n      <td>0.528517</td>\n      <td>0.617778</td>\n      <td>0.751851</td>\n      <td>302.20</td>\n      <td>{'clf__colsample_bytree': 1.0, 'clf__max_bin':...</td>\n    </tr>\n    <tr>\n      <th>0</th>\n      <td>RandomForest + HP + SMOTE (GPU)</td>\n      <td>0.762243</td>\n      <td>0.639037</td>\n      <td>0.544419</td>\n      <td>0.587946</td>\n      <td>0.722900</td>\n      <td>41.86</td>\n      <td>{'clf__bootstrap': True, 'clf__criterion': 'gi...</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"                                     Modelo  Accuracy    Recall  Precision  \\\n1  XGBoost + HP + scale_pos_weight=w1 (GPU)  0.707594  0.839572   0.471471   \n2   LightGBM + HP + is_unbalance=True (GPU)  0.755855  0.743316   0.528517   \n0           RandomForest + HP + SMOTE (GPU)  0.762243  0.639037   0.544419   \n\n         F1       AUC  Tiempo (s)  \\\n1  0.603846  0.749738      361.79   \n2  0.617778  0.751851      302.20   \n0  0.587946  0.722900       41.86   \n\n                                  Mejores Parámetros  \n1  {'clf__gamma': 1, 'clf__min_child_weight': 5, ...  \n2  {'clf__colsample_bytree': 1.0, 'clf__max_bin':...  \n0  {'clf__bootstrap': True, 'clf__criterion': 'gi...  ","content_type":"text/plain"}}}],"key":"wnVjoB6bs5"}],"key":"sJw4kE7zpO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"metricas = [\"Accuracy\", \"Recall\", \"Precision\", \"F1\", \"AUC\"]\n\nres3_df_sorted = res3_df.sort_values(by=\"Recall\", ascending=False).reset_index(drop=True)\n\nres3_melt = res3_df_sorted.melt(\n    id_vars=\"Modelo\", \n    value_vars=metricas, \n    var_name=\"Métrica\", \n    value_name=\"Valor\"\n)","key":"LKYKbXv5tm"},{"type":"output","id":"rzDh19gKxs8N9i_m_srk4","data":[],"key":"ibFadUP8HB"}],"key":"MmSfGpzrME"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(1, 2, figsize=(16, 6))\n\nsns.barplot(\n    data=res3_melt, \n    x=\"Modelo\", \n    y=\"Valor\", \n    hue=\"Métrica\", \n    palette=\"Blues_r\", \n    ax=axes[0]\n)\naxes[0].set_title(\"Comparación de Métricas por Modelo\", fontsize=14)\naxes[0].set_ylim(0, 1)\naxes[0].set_ylabel(\"Valor de la Métrica\")\naxes[0].set_xlabel(\"Modelo\")\naxes[0].legend(title=\"Métrica\", bbox_to_anchor=(1.05, 1), loc=\"upper left\")\n\nsns.barplot(\n    data=res3_df_sorted, \n    x=\"Modelo\", \n    y=\"Tiempo (s)\", \n    palette=\"Blues_r\", \n    ax=axes[1]\n)\naxes[1].set_title(\"Tiempo de Entrenamiento por Modelo\", fontsize=14)\naxes[1].set_ylabel(\"Tiempo (segundos)\")\naxes[1].set_xlabel(\"Modelo\")\n\nplt.tight_layout()\nplt.show()\n","key":"sP15oVDrIv"},{"type":"output","id":"A2RzKqeouMVWTHs_KfX15","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\216536320.py:17: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fc5c4bece9f90e38b971c7cad41a3190","path":"/fc5c4bece9f90e38b971c7cad41a3190.png"},"text/plain":{"content":"<Figure size 1600x600 with 2 Axes>","content_type":"text/plain"}}}],"key":"DFfByfdZnV"}],"key":"W8HaNCnram"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"De forma preliminar, vemos que los modelos de XGBoost y LightGBM tienen mejores metricas al comparar con otros modelos. En este caso, la metrica de interes es Recall (ya que queremos reducir los falsos negativos para este caso), y XGBoost alcanzó los mejores rendimientos. Junto a esto, notamos que XGBoost tuvo una duracion elevada a comparacion del resto (LightGBM y RandomForest)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"X1clB972kL"}],"key":"cMVX9NihDx"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Los modelos de XGBoost y RandomForest fueron los que menos duracion tuvieron a la hora de ejecutar.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l1s8V1RD2W"}],"key":"XEk4VXtQyE"}],"key":"FJV6pdLa6Y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\n\nmodelos_entrenados = {\n    \"RandomForest\": grid_rf,\n    \"XGBoost\": grid_xgb,\n    \"LightGBM\": grid_lgb\n}\n\nfor name, model in modelos_entrenados.items():\n    RocCurveDisplay.from_estimator(model, X_test, y_test, ax=plt.gca(), name=name)\n\nplt.plot([0, 1], [0, 1], \"k--\", label=\"Aleatorio\")\n\nplt.title(\"Comparación de Curvas ROC /w HP\", fontsize=14)\nplt.xlabel(\"Tasa de Falsos Positivos (FPR)\")\nplt.ylabel(\"Tasa de Verdaderos Positivos (TPR)\")\nplt.legend(loc=\"lower right\")\nplt.grid(alpha=0.3)\nplt.tight_layout()\nplt.show()","key":"yUYtWfQDgr"},{"type":"output","id":"rbid_81glnSkMrZJ9iHJT","data":[{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"873bca9393a2a33565aad313abc695a8","path":"/873bca9393a2a33565aad313abc695a8.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"BxKXOs1D1H"}],"key":"IF1l05anAY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Comparando curvas ROC, los rendimientos son bastantes similares a la grafica anterior, con LightGBM y XGBoost con un AUC de 0.84, con los modelos restantes estando con 0.83 (RandomForest) respectivamente, teniendo un desempeño muy similar en comparacion.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gFYcu8GfG0"}],"key":"Wiycc0TZzq"}],"key":"PXkawMYYwV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.4 Resultados generales","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bvcYdn0GI7"}],"key":"RMpTarEm4z"}],"identifier":"id-2-4-resultados-generales","label":"2.4 Resultados generales","html_id":"id-2-4-resultados-generales","implicit":true,"key":"QiAYqR186e"}],"key":"kM4crmlhsQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"res_all = pd.concat([res1_df, res2_df, res3_df], ignore_index=True)\n\nres_all_sorted = res_all.sort_values(by=\"Recall\", ascending=False)\n\nprint(\"\\nResultados combinados:\")\ndisplay(res_all_sorted)","key":"s4XwLDN8Rg"},{"type":"output","id":"B4TZQMu--Py7leZFQp3Je","data":[{"name":"stdout","output_type":"stream","text":"\nResultados combinados:\n"},{"output_type":"display_data","metadata":{},"data":{"application/vnd.microsoft.datawrangler.viewer.v0+json":{"content":"{\"columns\":[{\"name\":\"index\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"Modelo\",\"rawType\":\"object\",\"type\":\"string\"},{\"name\":\"Accuracy\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Recall\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Precision\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"F1\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"AUC\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Tiempo (s)\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"Mejores Parámetros\",\"rawType\":\"object\",\"type\":\"unknown\"}],\"ref\":\"6ad086e9-d847-4781-88eb-d190b722db4b\",\"rows\":[[\"5\",\"XGBoost + HP\",\"0.7083037615330021\",\"0.8475935828877005\",\"0.47242921013412814\",\"0.6066985645933014\",\"0.7527822986902271\",\"24.53\",\"{'clf__gamma': 1, 'clf__min_child_weight': 5, 'clf__reg_alpha': 0, 'clf__reg_lambda': 5, 'clf__scale_pos_weight': 5, 'clf__subsample': 1.0}\"],[\"9\",\"XGBoost + HP + scale_pos_weight=w1 (GPU)\",\"0.7075940383250532\",\"0.839572192513369\",\"0.47147147147147145\",\"0.6038461538461538\",\"0.7497377870779405\",\"361.79\",\"{'clf__gamma': 1, 'clf__min_child_weight': 5, 'clf__reg_alpha': 0, 'clf__reg_lambda': 5, 'clf__scale_pos_weight': 5, 'clf__subsample': 1.0}\"],[\"10\",\"LightGBM + HP + is_unbalance=True (GPU)\",\"0.7558552164655784\",\"0.7433155080213903\",\"0.5285171102661597\",\"0.6177777777777778\",\"0.7518509907256711\",\"302.2\",\"{'clf__colsample_bytree': 1.0, 'clf__max_bin': 255, 'clf__min_child_samples': 50, 'clf__min_child_weight': 0.001, 'clf__reg_alpha': 0, 'clf__reg_lambda': 0.5, 'clf__subsample': 0.8}\"],[\"8\",\"RandomForest + HP + SMOTE (GPU)\",\"0.7622427253371186\",\"0.6390374331550802\",\"0.5444191343963554\",\"0.5879458794587946\",\"0.7229003590896175\",\"41.86\",\"{'clf__bootstrap': True, 'clf__criterion': 'gini', 'clf__max_features': 'log2', 'clf__min_samples_leaf': 4, 'clf__min_samples_split': 2}\"],[\"6\",\"CatBoost + HP\",\"0.7913413768630234\",\"0.5454545454545454\",\"0.6219512195121951\",\"0.5811965811965812\",\"0.7128238910847606\",\"30.81\",\"{'clf__border_count': 32, 'clf__l2_leaf_reg': 1}\"],[\"2\",\"CatBoost\",\"0.7934705464868701\",\"0.5213903743315508\",\"0.6351791530944625\",\"0.5726872246696035\",\"0.7065889069725387\",\"8.13\",\"{}\"],[\"3\",\"LightGBM\",\"0.794889992902768\",\"0.5213903743315508\",\"0.639344262295082\",\"0.5743740795287187\",\"0.7075550905474179\",\"0.93\",\"{}\"],[\"7\",\"LightGBM + HP\",\"0.7920511000709723\",\"0.5106951871657754\",\"0.6345514950166113\",\"0.5659259259259259\",\"0.7022074969645302\",\"42.95\",\"{'clf__colsample_bytree': 1.0, 'clf__max_bin': 255, 'clf__min_child_samples': 10, 'clf__min_child_weight': 0.001, 'clf__reg_alpha': 0, 'clf__reg_lambda': 1, 'clf__subsample': 0.8}\"],[\"1\",\"XGBoost\",\"0.7778566359119943\",\"0.5080213903743316\",\"0.5956112852664577\",\"0.5483405483405484\",\"0.6916918546074556\",\"0.64\",\"{}\"],[\"4\",\"RandomForest + HP\",\"0.7977288857345636\",\"0.49732620320855614\",\"0.657243816254417\",\"0.5662100456621004\",\"0.7018031982226355\",\"25.0\",\"{'clf__bootstrap': True, 'clf__criterion': 'gini', 'clf__max_features': 'sqrt', 'clf__min_samples_leaf': 2, 'clf__min_samples_split': 5}\"],[\"0\",\"RandomForest\",\"0.7799858055358411\",\"0.4946524064171123\",\"0.6045751633986928\",\"0.5441176470588235\",\"0.6888720969283629\",\"1.07\",\"{}\"]],\"shape\":{\"columns\":8,\"rows\":11}}","content_type":"application/vnd.microsoft.datawrangler.viewer.v0+json"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Modelo</th>\n      <th>Accuracy</th>\n      <th>Recall</th>\n      <th>Precision</th>\n      <th>F1</th>\n      <th>AUC</th>\n      <th>Tiempo (s)</th>\n      <th>Mejores Parámetros</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>5</th>\n      <td>XGBoost + HP</td>\n      <td>0.708304</td>\n      <td>0.847594</td>\n      <td>0.472429</td>\n      <td>0.606699</td>\n      <td>0.752782</td>\n      <td>24.53</td>\n      <td>{'clf__gamma': 1, 'clf__min_child_weight': 5, ...</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>XGBoost + HP + scale_pos_weight=w1 (GPU)</td>\n      <td>0.707594</td>\n      <td>0.839572</td>\n      <td>0.471471</td>\n      <td>0.603846</td>\n      <td>0.749738</td>\n      <td>361.79</td>\n      <td>{'clf__gamma': 1, 'clf__min_child_weight': 5, ...</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>LightGBM + HP + is_unbalance=True (GPU)</td>\n      <td>0.755855</td>\n      <td>0.743316</td>\n      <td>0.528517</td>\n      <td>0.617778</td>\n      <td>0.751851</td>\n      <td>302.20</td>\n      <td>{'clf__colsample_bytree': 1.0, 'clf__max_bin':...</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>RandomForest + HP + SMOTE (GPU)</td>\n      <td>0.762243</td>\n      <td>0.639037</td>\n      <td>0.544419</td>\n      <td>0.587946</td>\n      <td>0.722900</td>\n      <td>41.86</td>\n      <td>{'clf__bootstrap': True, 'clf__criterion': 'gi...</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>CatBoost + HP</td>\n      <td>0.791341</td>\n      <td>0.545455</td>\n      <td>0.621951</td>\n      <td>0.581197</td>\n      <td>0.712824</td>\n      <td>30.81</td>\n      <td>{'clf__border_count': 32, 'clf__l2_leaf_reg': 1}</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>CatBoost</td>\n      <td>0.793471</td>\n      <td>0.521390</td>\n      <td>0.635179</td>\n      <td>0.572687</td>\n      <td>0.706589</td>\n      <td>8.13</td>\n      <td>{}</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>LightGBM</td>\n      <td>0.794890</td>\n      <td>0.521390</td>\n      <td>0.639344</td>\n      <td>0.574374</td>\n      <td>0.707555</td>\n      <td>0.93</td>\n      <td>{}</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>LightGBM + HP</td>\n      <td>0.792051</td>\n      <td>0.510695</td>\n      <td>0.634551</td>\n      <td>0.565926</td>\n      <td>0.702207</td>\n      <td>42.95</td>\n      <td>{'clf__colsample_bytree': 1.0, 'clf__max_bin':...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>XGBoost</td>\n      <td>0.777857</td>\n      <td>0.508021</td>\n      <td>0.595611</td>\n      <td>0.548341</td>\n      <td>0.691692</td>\n      <td>0.64</td>\n      <td>{}</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>RandomForest + HP</td>\n      <td>0.797729</td>\n      <td>0.497326</td>\n      <td>0.657244</td>\n      <td>0.566210</td>\n      <td>0.701803</td>\n      <td>25.00</td>\n      <td>{'clf__bootstrap': True, 'clf__criterion': 'gi...</td>\n    </tr>\n    <tr>\n      <th>0</th>\n      <td>RandomForest</td>\n      <td>0.779986</td>\n      <td>0.494652</td>\n      <td>0.604575</td>\n      <td>0.544118</td>\n      <td>0.688872</td>\n      <td>1.07</td>\n      <td>{}</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"                                      Modelo  Accuracy    Recall  Precision  \\\n5                               XGBoost + HP  0.708304  0.847594   0.472429   \n9   XGBoost + HP + scale_pos_weight=w1 (GPU)  0.707594  0.839572   0.471471   \n10   LightGBM + HP + is_unbalance=True (GPU)  0.755855  0.743316   0.528517   \n8            RandomForest + HP + SMOTE (GPU)  0.762243  0.639037   0.544419   \n6                              CatBoost + HP  0.791341  0.545455   0.621951   \n2                                   CatBoost  0.793471  0.521390   0.635179   \n3                                   LightGBM  0.794890  0.521390   0.639344   \n7                              LightGBM + HP  0.792051  0.510695   0.634551   \n1                                    XGBoost  0.777857  0.508021   0.595611   \n4                          RandomForest + HP  0.797729  0.497326   0.657244   \n0                               RandomForest  0.779986  0.494652   0.604575   \n\n          F1       AUC  Tiempo (s)  \\\n5   0.606699  0.752782       24.53   \n9   0.603846  0.749738      361.79   \n10  0.617778  0.751851      302.20   \n8   0.587946  0.722900       41.86   \n6   0.581197  0.712824       30.81   \n2   0.572687  0.706589        8.13   \n3   0.574374  0.707555        0.93   \n7   0.565926  0.702207       42.95   \n1   0.548341  0.691692        0.64   \n4   0.566210  0.701803       25.00   \n0   0.544118  0.688872        1.07   \n\n                                   Mejores Parámetros  \n5   {'clf__gamma': 1, 'clf__min_child_weight': 5, ...  \n9   {'clf__gamma': 1, 'clf__min_child_weight': 5, ...  \n10  {'clf__colsample_bytree': 1.0, 'clf__max_bin':...  \n8   {'clf__bootstrap': True, 'clf__criterion': 'gi...  \n6    {'clf__border_count': 32, 'clf__l2_leaf_reg': 1}  \n2                                                  {}  \n3                                                  {}  \n7   {'clf__colsample_bytree': 1.0, 'clf__max_bin':...  \n1                                                  {}  \n4   {'clf__bootstrap': True, 'clf__criterion': 'gi...  \n0                                                  {}  ","content_type":"text/plain"}}}],"key":"DWeVqqg9TG"}],"key":"nAxNZXzyad"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"metricas = [\"Accuracy\", \"Recall\", \"Precision\", \"F1\", \"AUC\"]\n\nres_all_melt = res_all.melt(\n    id_vars=[\"Modelo\"], \n    value_vars=metricas,\n    var_name=\"Métrica\",\n    value_name=\"Valor\"\n)\n","key":"EAsGzjPX32"},{"type":"output","id":"RUoW-7D3tCIqVLjjCEzzU","data":[],"key":"UF1potCwlh"}],"key":"u1NQetGinx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"top5 = res_all_sorted.nlargest(5, \"Recall\")\n\ntop5_melt = top5.melt(\n    id_vars=[\"Modelo\"],\n    value_vars=[\"Accuracy\", \"Recall\", \"Precision\", \"F1\", \"AUC\"],\n    var_name=\"Métrica\",\n    value_name=\"Valor\"\n)\n\nfig, axes = plt.subplots(1, 2, figsize=(18, 6))\n\nsns.barplot(\n    data=top5_melt, \n    x=\"Modelo\", \n    y=\"Valor\", \n    hue=\"Métrica\", \n    palette=\"Blues_r\", \n    ax=axes[0]\n)\n\naxes[0].set_title(\"Top 5 Modelos - Comparación de Métricas\", fontsize=14)\naxes[0].set_ylim(0, 1)\naxes[0].set_ylabel(\"Valor de la Métrica\")\naxes[0].set_xlabel(\"Modelo\")\naxes[0].grid(alpha=0.3)\n\naxes[0].set_xticklabels(\n    axes[0].get_xticklabels(),\n    rotation=35,\n    ha=\"right\",\n    fontsize=11\n)\n\nfor p in axes[0].patches:\n    value = p.get_height()\n    if not np.isnan(value) and value > 0.01:  \n        axes[0].text(\n            p.get_x() + p.get_width() / 2,\n            value + 0.015,\n            f\"{value:.2f}\",\n            ha=\"center\",\n            va=\"bottom\",\n            fontsize=9,\n            color=\"black\"\n        )\n\naxes[0].legend(title=\"Métrica\", bbox_to_anchor=(1.05, 1), loc=\"upper left\")\n\nsns.barplot(\n    data=top5, \n    x=\"Modelo\", \n    y=\"Tiempo (s)\", \n    palette=\"Blues_r\", \n    ax=axes[1]\n)\n\naxes[1].set_title(\"Top 5 Modelos - Tiempo de Entrenamiento\", fontsize=14)\naxes[1].set_ylabel(\"Tiempo (segundos)\")\naxes[1].set_xlabel(\"Modelo\")\naxes[1].grid(alpha=0.3)\n\naxes[1].set_xticklabels(\n    axes[1].get_xticklabels(),\n    rotation=35,\n    ha=\"right\",\n    fontsize=11\n)\n\nfor p in axes[1].patches:\n    value = p.get_height()\n    if not np.isnan(value):\n        axes[1].text(\n            p.get_x() + p.get_width() / 2,\n            value + (value * 0.02),\n            f\"{value:.2f}s\",\n            ha=\"center\",\n            va=\"bottom\",\n            fontsize=9,\n            color=\"black\"\n        )\n\nplt.tight_layout()\nplt.show()\n","key":"P0FuIE7KfV"},{"type":"output","id":"-UJzSweJkPvmYNq_J5RMO","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3250643461.py:31: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.\n  axes[0].set_xticklabels(\nC:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3250643461.py:55: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\nC:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3250643461.py:69: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.\n  axes[1].set_xticklabels(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d1eadcf91f32b1376b2e7df3fddeba62","path":"/d1eadcf91f32b1376b2e7df3fddeba62.png"},"text/plain":{"content":"<Figure size 1800x600 with 2 Axes>","content_type":"text/plain"}}}],"key":"uoqCMsI6bD"}],"key":"o5tBy35MV2"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Tras todos los modeladados, tenemos estos resultados en base a las metricas que hemos planteado. En base a esto, vemos que los mejores modelos fueron una combinacion entre hiperparametrizar, usar balaceno y GPU. Para esto, observaremos los mejores tres modelos:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r1aT1Cubpb"}],"key":"wO8OeihgbP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"El mejor modelo a estudio fue XGBoost + Hiperparametros, que alcanzo 0.848 en recall.Y tuvo el menor tiempo de computo a comparacion del resto de los modelos.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yCxrP3eDhO"}],"key":"fv3KfmZj13"}],"key":"DklDOqGbuD"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"El segundo mejor modelo fue una combinacion de XGBoost + Hiperparametros y tecnicas de balanceo, que a pesar de tener un tiempo de computo elevado, tuvo una metrica de recall global de 0.840.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FUP7IqYwb6"}],"key":"hftL4yqU6Z"}],"key":"tOMTuqstvP"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"En tercer lugar fue el modelo de LightGBM con las mismas especificaciones que el segundo modelo, que tuvo un desempeño moderado, con un recall global de 0.743.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Xw9SAH8bnf"}],"key":"aaHxw027M8"}],"key":"xZsJ6GcQg4"}],"key":"Eh2LlZg5aO"}],"key":"hWOFhI1H9H"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(10, 6))\n\nres_sorted = res_all_sorted.sort_values(\"Recall\", ascending=False)\n\nsns.barplot(\n    data=res_sorted,\n    x=\"Modelo\",\n    y=\"Recall\",\n    palette=\"Blues_r\"\n)\n\nplt.title(\"Comparación Global de Recall por Modelo\", fontsize=14)\nplt.ylabel(\"Recall\")\nplt.xlabel(\"Modelo\")\nplt.ylim(0, 1)\nplt.xticks(rotation=45, ha=\"right\")\nplt.grid(alpha=0.3)\n\nfor i, val in enumerate(res_sorted[\"Recall\"]):\n    plt.text(\n        i,\n        val + 0.015,  \n        f\"{val:.3f}\",\n        ha=\"center\",\n        va=\"bottom\",\n        fontsize=10,\n        color=\"black\"\n    )\n\nmean_recall = res_sorted[\"Recall\"].mean()\nplt.axhline(mean_recall, color=\"black\", linestyle=\"--\", linewidth=1)\nplt.text(\n    len(res_sorted) - 0.5, mean_recall + 0.015,\n    f\"Promedio: {mean_recall:.3f}\",\n    color=\"black\",\n    fontsize=10,\n    ha=\"right\",\n    va=\"bottom\",\n    fontweight=\"bold\"\n)\n\nbest_model = res_sorted.iloc[0]\noffset = 0.08 \nplt.text(\n    x=0,\n    y=min(best_model[\"Recall\"] + offset, 0.98), \n    s=f\"Mejor modelo: {best_model['Modelo']} ({best_model['Recall']:.3f})\",\n    fontsize=12,\n    color=sns.color_palette(\"Blues\")[-1],\n    fontweight=\"bold\"\n)\n\nplt.tight_layout()\nplt.show()\n","key":"dPBjxB88Xe"},{"type":"output","id":"RluXQawxyKKwVtb9I6Ah1","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\329827691.py:7: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"759713898e33d68146ff146bf4011ebc","path":"/759713898e33d68146ff146bf4011ebc.png"},"text/plain":{"content":"<Figure size 1000x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"yQyoD9MCrG"}],"key":"UqPWHVSBD1"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Observandolo de otra perspectiva, esta es una comparacion solamente de recall por modelos, observando los valores que hay entre los diferentes modelos, de forma ascendente, con el promedio de los modelos tambien especificado. Aqui, XGBoost + HP fue coronado como el mejor modelo en terminos de tanto metricas globales, como en la metrica objetivo, la cual fue Recall.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N5OLulXKJq"}],"key":"Embcbp3cDN"}],"key":"iWTc9k5b3X"}],"key":"QXHtJKr54K"},"references":{"cite":{"order":[],"data":{}}}}