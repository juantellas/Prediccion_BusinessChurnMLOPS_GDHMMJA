{"version":2,"kind":"Notebook","sha256":"ad6477ab3f599cdef81635b2a443a69a6bab6d92c37d7248913370a8a6891757","slug":"interpretables-resultados","location":"/notebooks/3_interpretables_resultados.ipynb","dependencies":[],"frontmatter":{"title":"3. Interpretabilidad y feature_importance","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"gpu_venv","language":"python"},"authors":[{"nameParsed":{"literal":"Juan Aguirre","given":"Juan","family":"Aguirre"},"name":"Juan Aguirre","id":"contributors-Users\\taran\\OneDrive\\Documents\\uni\\machin\\miniprojects\\RF-XGB\\Prediccion_BusinessChurnMLOPS_GDHMMJA\\docs\\myst-generated-uid-0"},{"nameParsed":{"literal":"Mariangel Mercado","given":"Mariangel","family":"Mercado"},"name":"Mariangel Mercado","id":"contributors-Users\\taran\\OneDrive\\Documents\\uni\\machin\\miniprojects\\RF-XGB\\Prediccion_BusinessChurnMLOPS_GDHMMJA\\docs\\myst-generated-uid-1"},{"nameParsed":{"literal":"Guirlessa de la Hoz","given":"Guirlessa","non_dropping_particle":"de la","family":"Hoz"},"name":"Guirlessa de la Hoz","id":"contributors-Users\\taran\\OneDrive\\Documents\\uni\\machin\\miniprojects\\RF-XGB\\Prediccion_BusinessChurnMLOPS_GDHMMJA\\docs\\myst-generated-uid-2"}],"github":"https://github.com/juantellas","keywords":["Churn","Telecomunicaciones","Machine Learning","Predicci√≥n"],"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"3_interpretables_resultados.ipynb","url":"/3_interpretables_res-3cb2d7dff1602e5bf56338b5e6e27c61.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Ahora, usaremos los mejores modelos de cada seccion, y observamos el feature importance de cada uno, ejemplificandolo con diversos casos dentro de los datos estudiados.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E3rsMfJ4VG"}],"key":"Sok8vdSSUG"}],"key":"b0UNiqdwOW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom lime.lime_tabular import LimeTabularExplainer\nimport pickle\n\nimport joblib","key":"sc8CpoMSlx"},{"type":"output","id":"oYwk8bDg3bJWMTBMYGUbL","data":[],"key":"C07tJqDNTU"}],"key":"S653DOI27j"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.1 XGBoost Hiperparametrizado","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q4FzLIdC9D"}],"key":"HMqeqksTsQ"}],"identifier":"id-3-1-xgboost-hiperparametrizado","label":"3.1 XGBoost Hiperparametrizado","html_id":"id-3-1-xgboost-hiperparametrizado","implicit":true,"key":"KPTq9PG99s"}],"key":"IuDoDFTDJ4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Acto siguiente, vamos a observar cuales fueron las diez features mas importantes por modelo, de forma descendente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yHwZU28qXZ"}],"key":"IzYLdKS9Y1"}],"key":"FOZzFANJvY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"xgb_final = joblib.load(\"xgb_hp_best.pkl\")\n\nxgb_final\n","key":"ujMrk6Xn3P"},{"type":"output","id":"JbJsCVcE-dGzsVkiR1MZM","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<style>#sk-container-id-10 {\n  /* Definition of color scheme common for light and dark mode */\n  --sklearn-color-text: #000;\n  --sklearn-color-text-muted: #666;\n  --sklearn-color-line: gray;\n  /* Definition of color scheme for unfitted estimators */\n  --sklearn-color-unfitted-level-0: #fff5e6;\n  --sklearn-color-unfitted-level-1: #f6e4d2;\n  --sklearn-color-unfitted-level-2: #ffe0b3;\n  --sklearn-color-unfitted-level-3: chocolate;\n  /* Definition of color scheme for fitted estimators */\n  --sklearn-color-fitted-level-0: #f0f8ff;\n  --sklearn-color-fitted-level-1: #d4ebff;\n  --sklearn-color-fitted-level-2: #b3dbfd;\n  --sklearn-color-fitted-level-3: cornflowerblue;\n\n  /* Specific color for light theme */\n  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));\n  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-icon: #696969;\n\n  @media (prefers-color-scheme: dark) {\n    /* Redefinition of color scheme for dark theme */\n    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));\n    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-icon: #878787;\n  }\n}\n\n#sk-container-id-10 {\n  color: var(--sklearn-color-text);\n}\n\n#sk-container-id-10 pre {\n  padding: 0;\n}\n\n#sk-container-id-10 input.sk-hidden--visually {\n  border: 0;\n  clip: rect(1px 1px 1px 1px);\n  clip: rect(1px, 1px, 1px, 1px);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n#sk-container-id-10 div.sk-dashed-wrapped {\n  border: 1px dashed var(--sklearn-color-line);\n  margin: 0 0.4em 0.5em 0.4em;\n  box-sizing: border-box;\n  padding-bottom: 0.4em;\n  background-color: var(--sklearn-color-background);\n}\n\n#sk-container-id-10 div.sk-container {\n  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`\n     but bootstrap.min.css set `[hidden] { display: none !important; }`\n     so we also need the `!important` here to be able to override the\n     default hidden behavior on the sphinx rendered scikit-learn.org.\n     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */\n  display: inline-block !important;\n  position: relative;\n}\n\n#sk-container-id-10 div.sk-text-repr-fallback {\n  display: none;\n}\n\ndiv.sk-parallel-item,\ndiv.sk-serial,\ndiv.sk-item {\n  /* draw centered vertical line to link estimators */\n  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));\n  background-size: 2px 100%;\n  background-repeat: no-repeat;\n  background-position: center center;\n}\n\n/* Parallel-specific style estimator block */\n\n#sk-container-id-10 div.sk-parallel-item::after {\n  content: \"\";\n  width: 100%;\n  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);\n  flex-grow: 1;\n}\n\n#sk-container-id-10 div.sk-parallel {\n  display: flex;\n  align-items: stretch;\n  justify-content: center;\n  background-color: var(--sklearn-color-background);\n  position: relative;\n}\n\n#sk-container-id-10 div.sk-parallel-item {\n  display: flex;\n  flex-direction: column;\n}\n\n#sk-container-id-10 div.sk-parallel-item:first-child::after {\n  align-self: flex-end;\n  width: 50%;\n}\n\n#sk-container-id-10 div.sk-parallel-item:last-child::after {\n  align-self: flex-start;\n  width: 50%;\n}\n\n#sk-container-id-10 div.sk-parallel-item:only-child::after {\n  width: 0;\n}\n\n/* Serial-specific style estimator block */\n\n#sk-container-id-10 div.sk-serial {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background-color: var(--sklearn-color-background);\n  padding-right: 1em;\n  padding-left: 1em;\n}\n\n\n/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is\nclickable and can be expanded/collapsed.\n- Pipeline and ColumnTransformer use this feature and define the default style\n- Estimators will overwrite some part of the style using the `sk-estimator` class\n*/\n\n/* Pipeline and ColumnTransformer style (default) */\n\n#sk-container-id-10 div.sk-toggleable {\n  /* Default theme specific background. It is overwritten whether we have a\n  specific estimator or a Pipeline/ColumnTransformer */\n  background-color: var(--sklearn-color-background);\n}\n\n/* Toggleable label */\n#sk-container-id-10 label.sk-toggleable__label {\n  cursor: pointer;\n  display: flex;\n  width: 100%;\n  margin-bottom: 0;\n  padding: 0.5em;\n  box-sizing: border-box;\n  text-align: center;\n  align-items: start;\n  justify-content: space-between;\n  gap: 0.5em;\n}\n\n#sk-container-id-10 label.sk-toggleable__label .caption {\n  font-size: 0.6rem;\n  font-weight: lighter;\n  color: var(--sklearn-color-text-muted);\n}\n\n#sk-container-id-10 label.sk-toggleable__label-arrow:before {\n  /* Arrow on the left of the label */\n  content: \"‚ñ∏\";\n  float: left;\n  margin-right: 0.25em;\n  color: var(--sklearn-color-icon);\n}\n\n#sk-container-id-10 label.sk-toggleable__label-arrow:hover:before {\n  color: var(--sklearn-color-text);\n}\n\n/* Toggleable content - dropdown */\n\n#sk-container-id-10 div.sk-toggleable__content {\n  max-height: 0;\n  max-width: 0;\n  overflow: hidden;\n  text-align: left;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-10 div.sk-toggleable__content.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-10 div.sk-toggleable__content pre {\n  margin: 0.2em;\n  border-radius: 0.25em;\n  color: var(--sklearn-color-text);\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-10 div.sk-toggleable__content.fitted pre {\n  /* unfitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-10 input.sk-toggleable__control:checked~div.sk-toggleable__content {\n  /* Expand drop-down */\n  max-height: 200px;\n  max-width: 100%;\n  overflow: auto;\n}\n\n#sk-container-id-10 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {\n  content: \"‚ñæ\";\n}\n\n/* Pipeline/ColumnTransformer-specific style */\n\n#sk-container-id-10 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-10 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator-specific style */\n\n/* Colorize estimator box */\n#sk-container-id-10 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-10 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n#sk-container-id-10 div.sk-label label.sk-toggleable__label,\n#sk-container-id-10 div.sk-label label {\n  /* The background is the default theme color */\n  color: var(--sklearn-color-text-on-default-background);\n}\n\n/* On hover, darken the color of the background */\n#sk-container-id-10 div.sk-label:hover label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n/* Label box, darken color on hover, fitted */\n#sk-container-id-10 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator label */\n\n#sk-container-id-10 div.sk-label label {\n  font-family: monospace;\n  font-weight: bold;\n  display: inline-block;\n  line-height: 1.2em;\n}\n\n#sk-container-id-10 div.sk-label-container {\n  text-align: center;\n}\n\n/* Estimator-specific */\n#sk-container-id-10 div.sk-estimator {\n  font-family: monospace;\n  border: 1px dotted var(--sklearn-color-border-box);\n  border-radius: 0.25em;\n  box-sizing: border-box;\n  margin-bottom: 0.5em;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-10 div.sk-estimator.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n/* on hover */\n#sk-container-id-10 div.sk-estimator:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-10 div.sk-estimator.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Specification for estimator info (e.g. \"i\" and \"?\") */\n\n/* Common style for \"i\" and \"?\" */\n\n.sk-estimator-doc-link,\na:link.sk-estimator-doc-link,\na:visited.sk-estimator-doc-link {\n  float: right;\n  font-size: smaller;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1em;\n  height: 1em;\n  width: 1em;\n  text-decoration: none !important;\n  margin-left: 0.5em;\n  text-align: center;\n  /* unfitted */\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n  color: var(--sklearn-color-unfitted-level-1);\n}\n\n.sk-estimator-doc-link.fitted,\na:link.sk-estimator-doc-link.fitted,\na:visited.sk-estimator-doc-link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\ndiv.sk-estimator:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\ndiv.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n/* Span, style for the box shown on hovering the info icon */\n.sk-estimator-doc-link span {\n  display: none;\n  z-index: 9999;\n  position: relative;\n  font-weight: normal;\n  right: .2ex;\n  padding: .5ex;\n  margin: .5ex;\n  width: min-content;\n  min-width: 20ex;\n  max-width: 50ex;\n  color: var(--sklearn-color-text);\n  box-shadow: 2pt 2pt 4pt #999;\n  /* unfitted */\n  background: var(--sklearn-color-unfitted-level-0);\n  border: .5pt solid var(--sklearn-color-unfitted-level-3);\n}\n\n.sk-estimator-doc-link.fitted span {\n  /* fitted */\n  background: var(--sklearn-color-fitted-level-0);\n  border: var(--sklearn-color-fitted-level-3);\n}\n\n.sk-estimator-doc-link:hover span {\n  display: block;\n}\n\n/* \"?\"-specific style due to the `<a>` HTML tag */\n\n#sk-container-id-10 a.estimator_doc_link {\n  float: right;\n  font-size: 1rem;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1rem;\n  height: 1rem;\n  width: 1rem;\n  text-decoration: none;\n  /* unfitted */\n  color: var(--sklearn-color-unfitted-level-1);\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n}\n\n#sk-container-id-10 a.estimator_doc_link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\n#sk-container-id-10 a.estimator_doc_link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n#sk-container-id-10 a.estimator_doc_link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n}\n</style><div id=\"sk-container-id-10\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,\n                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                                  [&#x27;tenure&#x27;,\n                                                   &#x27;charges_monthly&#x27;]),\n                                                 (&#x27;cat&#x27;,\n                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                                  [&#x27;gender&#x27;, &#x27;senior&#x27;,\n                                                   &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                                   &#x27;phone&#x27;, &#x27;phone_multiple&#x27;,\n                                                   &#x27;internet&#x27;,\n                                                   &#x27;internet_security&#x27;,\n                                                   &#x27;internet_backup&#x27;,\n                                                   &#x27;internet_protection&#x27;,\n                                                   &#x27;internet_support&#x27;,\n                                                   &#x27;streaming_tv&#x27;,\n                                                   &#x27;streaming_mov...\n                               feature_types=None, gamma=1, grow_policy=None,\n                               importance_type=None,\n                               interaction_constraints=None, learning_rate=None,\n                               max_bin=None, max_cat_threshold=None,\n                               max_cat_to_onehot=None, max_delta_step=None,\n                               max_depth=None, max_leaves=None,\n                               min_child_weight=5, missing=nan,\n                               monotone_constraints=None, multi_strategy=None,\n                               n_estimators=None, n_jobs=None,\n                               num_parallel_tree=None, random_state=42, ...))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item sk-dashed-wrapped\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-66\" type=\"checkbox\" ><label for=\"sk-estimator-id-66\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>Pipeline</div></div><div><span class=\"sk-estimator-doc-link fitted\">i<span>Fitted</span></span></div></label><div class=\"sk-toggleable__content fitted\"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,\n                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                                  [&#x27;tenure&#x27;,\n                                                   &#x27;charges_monthly&#x27;]),\n                                                 (&#x27;cat&#x27;,\n                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                                  [&#x27;gender&#x27;, &#x27;senior&#x27;,\n                                                   &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                                   &#x27;phone&#x27;, &#x27;phone_multiple&#x27;,\n                                                   &#x27;internet&#x27;,\n                                                   &#x27;internet_security&#x27;,\n                                                   &#x27;internet_backup&#x27;,\n                                                   &#x27;internet_protection&#x27;,\n                                                   &#x27;internet_support&#x27;,\n                                                   &#x27;streaming_tv&#x27;,\n                                                   &#x27;streaming_mov...\n                               feature_types=None, gamma=1, grow_policy=None,\n                               importance_type=None,\n                               interaction_constraints=None, learning_rate=None,\n                               max_bin=None, max_cat_threshold=None,\n                               max_cat_to_onehot=None, max_delta_step=None,\n                               max_depth=None, max_leaves=None,\n                               min_child_weight=5, missing=nan,\n                               monotone_constraints=None, multi_strategy=None,\n                               n_estimators=None, n_jobs=None,\n                               num_parallel_tree=None, random_state=42, ...))])</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item sk-dashed-wrapped\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-67\" type=\"checkbox\" ><label for=\"sk-estimator-id-67\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>preprocessor: ColumnTransformer</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html\">?<span>Documentation for preprocessor: ColumnTransformer</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                 [&#x27;tenure&#x27;, &#x27;charges_monthly&#x27;]),\n                                (&#x27;cat&#x27;, OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                 [&#x27;gender&#x27;, &#x27;senior&#x27;, &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                  &#x27;phone&#x27;, &#x27;phone_multiple&#x27;, &#x27;internet&#x27;,\n                                  &#x27;internet_security&#x27;, &#x27;internet_backup&#x27;,\n                                  &#x27;internet_protection&#x27;, &#x27;internet_support&#x27;,\n                                  &#x27;streaming_tv&#x27;, &#x27;streaming_movies&#x27;,\n                                  &#x27;contract&#x27;, &#x27;paperless&#x27;, &#x27;payment&#x27;])])</pre></div> </div></div><div class=\"sk-parallel\"><div class=\"sk-parallel-item\"><div class=\"sk-item\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-68\" type=\"checkbox\" ><label for=\"sk-estimator-id-68\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>num</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>[&#x27;tenure&#x27;, &#x27;charges_monthly&#x27;]</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-69\" type=\"checkbox\" ><label for=\"sk-estimator-id-69\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>StandardScaler</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html\">?<span>Documentation for StandardScaler</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class=\"sk-parallel-item\"><div class=\"sk-item\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-70\" type=\"checkbox\" ><label for=\"sk-estimator-id-70\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>cat</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>[&#x27;gender&#x27;, &#x27;senior&#x27;, &#x27;partner&#x27;, &#x27;dependents&#x27;, &#x27;phone&#x27;, &#x27;phone_multiple&#x27;, &#x27;internet&#x27;, &#x27;internet_security&#x27;, &#x27;internet_backup&#x27;, &#x27;internet_protection&#x27;, &#x27;internet_support&#x27;, &#x27;streaming_tv&#x27;, &#x27;streaming_movies&#x27;, &#x27;contract&#x27;, &#x27;paperless&#x27;, &#x27;payment&#x27;]</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-71\" type=\"checkbox\" ><label for=\"sk-estimator-id-71\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>OneHotEncoder</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.OneHotEncoder.html\">?<span>Documentation for OneHotEncoder</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-72\" type=\"checkbox\" ><label for=\"sk-estimator-id-72\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>XGBClassifier</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,\n              colsample_bylevel=None, colsample_bynode=None,\n              colsample_bytree=None, device=None, early_stopping_rounds=None,\n              enable_categorical=False, eval_metric=&#x27;logloss&#x27;,\n              feature_types=None, gamma=1, grow_policy=None,\n              importance_type=None, interaction_constraints=None,\n              learning_rate=None, max_bin=None, max_cat_threshold=None,\n              max_cat_to_onehot=None, max_delta_step=None, max_depth=None,\n              max_leaves=None, min_child_weight=5, missing=nan,\n              monotone_constraints=None, multi_strategy=None, n_estimators=None,\n              n_jobs=None, num_parallel_tree=None, random_state=42, ...)</pre></div> </div></div></div></div></div></div>","content_type":"text/html"},"text/plain":{"content":"Pipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num', StandardScaler(),\n                                                  ['tenure',\n                                                   'charges_monthly']),\n                                                 ('cat',\n                                                  OneHotEncoder(handle_unknown='ignore'),\n                                                  ['gender', 'senior',\n                                                   'partner', 'dependents',\n                                                   'phone', 'phone_multiple',\n                                                   'internet',\n                                                   'internet_security',\n                                                   'internet_backup',\n                                                   'internet_protection',\n                                                   'internet_support',\n                                                   'streaming_tv',\n                                                   'streaming_mov...\n                               feature_types=None, gamma=1, grow_policy=None,\n                               importance_type=None,\n                               interaction_constraints=None, learning_rate=None,\n                               max_bin=None, max_cat_threshold=None,\n                               max_cat_to_onehot=None, max_delta_step=None,\n                               max_depth=None, max_leaves=None,\n                               min_child_weight=5, missing=nan,\n                               monotone_constraints=None, multi_strategy=None,\n                               n_estimators=None, n_jobs=None,\n                               num_parallel_tree=None, random_state=42, ...))])","content_type":"text/plain"}}}],"key":"N2FBD3N9qJ"}],"key":"hU0gbXmCDv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"xgb_model = list(xgb_final.named_steps.values())[-1] \nfeature_names = xgb_final.named_steps[\"preprocessor\"].get_feature_names_out()\nimportances = xgb_model.feature_importances_\n\nfeat_importance = (\n    pd.DataFrame({\"Feature\": feature_names, \"Importance\": importances})\n    .sort_values(by=\"Importance\", ascending=False)\n    .reset_index(drop=True)\n)\n\ntop10 = feat_importance.head(10)\n\nplt.figure(figsize=(10, 6))\nsns.barplot(data=top10, x=\"Importance\", y=\"Feature\", palette=\"Blues_r\")\nplt.title(\"Top 10 Features m√°s importantes ‚Äî XGBoost + HP\", fontsize=14)\nplt.xlabel(\"Importancia\")\nplt.ylabel(\"Caracter√≠sticas\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"h11yMRoYvK"},{"type":"output","id":"qg_FfLgk7KkJDRoDXJU2Z","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\1175004313.py:14: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(data=top10, x=\"Importance\", y=\"Feature\", palette=\"Blues_r\")\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"823bc6d71a9c1f79f44f3de46bbce370","path":"/823bc6d71a9c1f79f44f3de46bbce370.png"},"text/plain":{"content":"<Figure size 1000x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"YN8p7IUNRY"}],"key":"fKbEuYqQZv"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aqui, los features mas importantes fueron:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B7iREAXTOB"}],"key":"QBdFi8vDVU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"cat_contract_Month-to-month, cat_internet_Fiber optic, cat_streaming_movies_Yes, cat_contract_One year, cat_internet_security_no","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ELT0gmW5d6"}],"key":"kz0IVmRSXV"}],"key":"aSrtwn6bWq"}],"key":"WOMCKa7GEV"}],"key":"h4R7s5aoOi"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.1.1 Caso mixto de Churn (i=10)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lqylz505fB"}],"key":"TNC1xNP7XW"}],"identifier":"id-3-1-1-caso-mixto-de-churn-i-10","label":"3.1.1 Caso mixto de Churn (i=10)","html_id":"id-3-1-1-caso-mixto-de-churn-i-10","implicit":true,"key":"R47yVEdI9L"}],"key":"zgX335Fzi9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #10 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pshGfVRpCy"}],"key":"gcz8Wz31Hi"}],"key":"ycQGXmFx7M"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = xgb_final.named_steps[\"preprocessor\"]\nclassifier = xgb_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"MG92firAdp"},{"type":"output","id":"Uz63HOQVs7M2ArJ76hgkN","data":[],"key":"u2JLHnH0CA"}],"key":"RDUKKVcPC2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 10\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"eoHKn4cJmM"},{"type":"output","id":"iS8He9gOl2ktjUHp2YzKz","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #10\n--------------------------------------------------------------------------------\nClase predicha: S√≠ Churn \nProbabilidades -> No: 0.342 | S√≠: 0.658\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                              Caracter√≠stica      Peso\n 0.00 < cat__contract_Month-to-month <= 1.00  0.308844\n                          num__tenure > 0.92 -0.219157\n                 num__charges_monthly > 0.83  0.108097\n     0.00 < cat__internet_support_No <= 1.00  0.082618\n    0.00 < cat__internet_Fiber optic <= 1.00  0.066119\n           cat__internet_security_No <= 0.00 -0.058938\n              cat__contract_One year <= 0.00 -0.051164\n              cat__contract_Two year <= 0.00  0.047030\n0.00 < cat__payment_Electronic check <= 1.00  0.045049\n                  cat__dependents_No <= 0.00 -0.035897\n================================================================================\n"}],"key":"Id99PmYYbf"}],"key":"ASQ5IHOCRV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 10  \nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"qHAZEUIOhp"},{"type":"output","id":"Njr8D-un7qz_8d1rbh2qA","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"5123443a68fe7fb2bcf0b30dc2e47287","path":"/5123443a68fe7fb2bcf0b30dc2e47287.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"AwVhcMVzS2"}],"key":"qTgPdDjjDV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî XGBoost + HP (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"CnndOyftZT"},{"type":"output","id":"SFO1LfpGIWIjon69EDJ6G","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3241674099.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2b1b5c15d6978ef21356e2d117cd78bb","path":"/2b1b5c15d6978ef21356e2d117cd78bb.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"kTAktotD9a"}],"key":"vbkuYo0wgx"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üé® Significado de los colores rojo y azul","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vFxD5YlZTW"}],"key":"U2IYsOFm8j"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"En la gr√°fica que generamos:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EbiQ8PXsfV"}],"key":"OLc92dUjmf"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"üî¥ Rojo ‚Üí La caracter√≠stica empuja la predicci√≥n hacia la clase positiva (por ejemplo, ‚ÄúS√≠ churn‚Äù).","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"yT4kb3bjgu"}],"key":"hDxDAhqFJC"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"üîµ Azul ‚Üí La caracter√≠stica empuja la predicci√≥n hacia la clase negativa (por ejemplo, ‚ÄúNo churn‚Äù).","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"o8N8U9HC6S"}],"key":"WDby54ZdhQ"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"‚öôÔ∏è Interpretaci√≥n pr√°ctica (en tu contexto de churn)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lKHkQ9g8YE"}],"key":"VxtjS0Cw8I"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Supongamos que el modelo predice si un cliente har√° churn (‚ÄúS√≠‚Äù) o no (‚ÄúNo‚Äù).\nEntonces:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Dua8zYfDdV"}],"key":"s7DVVeeeN7"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Color\tSignificado\tEjemplo\nüî¥ Rojo\tContribuye a que el modelo prediga ‚ÄúS√≠ churn‚Äù\ttenure bajo o MonthlyCharges alto hacen m√°s probable que se vaya\nüîµ Azul\tContribuye a que el modelo prediga ‚ÄúNo churn‚Äù\ttenure alto o contract tipo ‚Äútwo year‚Äù hacen menos probable que se vaya","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"deoAdQ8B4b"}],"key":"dqaer8P3IN"}],"key":"RhzrCHmrxU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.1.2 Caso positivo de Churn (i=100)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"M8NeyISWFf"}],"key":"FymQVdMRJO"}],"identifier":"id-3-1-2-caso-positivo-de-churn-i-100","label":"3.1.2 Caso positivo de Churn (i=100)","html_id":"id-3-1-2-caso-positivo-de-churn-i-100","implicit":true,"key":"t6plz5c6px"}],"key":"pxHZ1enDq0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #100 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K6QsKnzftr"}],"key":"N9mDscmMaM"}],"key":"XHN7dwSeLJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = xgb_final.named_steps[\"preprocessor\"]\nclassifier = xgb_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"VwbKwaO18C"},{"type":"output","id":"zXAeH1yGOcZ-4rxqJSkTd","data":[],"key":"fR5i10QaiU"}],"key":"nHg0EikJ54"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 100\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"XXsAwCFaEi"},{"type":"output","id":"Mvkee32xf6G8sb13BYUf_","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #100\n--------------------------------------------------------------------------------\nClase predicha: S√≠ Churn \nProbabilidades -> No: 0.057 | S√≠: 0.943\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                              Caracter√≠stica      Peso\n 0.00 < cat__contract_Month-to-month <= 1.00  0.308345\n                 num__charges_monthly > 0.83  0.114031\n     0.00 < cat__internet_support_No <= 1.00  0.080076\n    0.00 < cat__internet_security_No <= 1.00  0.063614\n    0.00 < cat__internet_Fiber optic <= 1.00  0.062803\n                -0.96 < num__tenure <= -0.14  0.062403\n              cat__contract_One year <= 0.00 -0.056287\n0.00 < cat__payment_Electronic check <= 1.00  0.052427\n              cat__contract_Two year <= 0.00  0.037556\n             cat__internet_backup_No <= 0.00 -0.029726\n================================================================================\n"}],"key":"OYsqxzb2rH"}],"key":"LJ7snuI1j1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 100\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"JcTBAqAt3V"},{"type":"output","id":"o26_YQXokfQJTzuLsBba2","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"1546ed04b5bdd61665fb1821390948c4","path":"/1546ed04b5bdd61665fb1821390948c4.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"MQ37VXCGfS"}],"key":"Hc0C9jDWFd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî XGBoost + HP (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"rBK7SLBcNk"},{"type":"output","id":"Zia2ZGotveli-TuyJS8t9","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3241674099.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f50e07d60d5b9c437c78786d278975df","path":"/f50e07d60d5b9c437c78786d278975df.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"KRi4uGGTWh"}],"key":"tGwAkSNEzY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.1.3 Caso negativo de Churn (i=500)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UmdN4Q8TLU"}],"key":"yqsKbboFQz"}],"identifier":"id-3-1-3-caso-negativo-de-churn-i-500","label":"3.1.3 Caso negativo de Churn (i=500)","html_id":"id-3-1-3-caso-negativo-de-churn-i-500","implicit":true,"key":"xlBdjnUwCb"}],"key":"xO7DqZEqap"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #500 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"D0R3f8OZU6"}],"key":"QuqKWeIdKO"}],"key":"XEKAO8R4EB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = xgb_final.named_steps[\"preprocessor\"]\nclassifier = xgb_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"cDgFqSueYw"},{"type":"output","id":"8fF60MHA81ZaOjHYlqLpo","data":[],"key":"YB7A2BcZFR"}],"key":"s7KFjrzO5y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 500\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"cpAXoAj6Q1"},{"type":"output","id":"wjWnY7zjKdC1szECz8Kpk","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #500\n--------------------------------------------------------------------------------\nClase predicha: No Churn \nProbabilidades -> No: 0.950 | S√≠: 0.050\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                       Caracter√≠stica      Peso\n cat__contract_Month-to-month <= 0.00 -0.306627\n                   num__tenure > 0.92 -0.213865\n     cat__internet_support_No <= 0.00 -0.088601\n        num__charges_monthly <= -0.97 -0.078065\n    cat__internet_Fiber optic <= 0.00 -0.061932\n    cat__internet_security_No <= 0.00 -0.059241\n       cat__contract_One year <= 0.00 -0.057930\ncat__payment_Electronic check <= 0.00 -0.049070\n        cat__contract_Two year > 0.00 -0.048957\n      cat__internet_backup_No <= 0.00 -0.033199\n================================================================================\n"}],"key":"heM9ftWEuH"}],"key":"bNTYsKBaru"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 500\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"DGUUG7Up9p"},{"type":"output","id":"3MwHKS1iGtsRi3_jZsLBY","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"54603cf3d7afeaa4334052bc235464d6","path":"/54603cf3d7afeaa4334052bc235464d6.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"A9S7pcOb0a"}],"key":"yQnV5mfNXM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî XGBoost + HP (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"YHU8EFDAQz"},{"type":"output","id":"eUBpXgNYU7HqLedv63_9g","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3241674099.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e18d0306a6bd1bd991b083ad5207d174","path":"/e18d0306a6bd1bd991b083ad5207d174.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"Gw1WnPDKE0"}],"key":"EbAWnSpQpB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.2 LightGBM usando Hiperparametrizacion e is_unbalance=True (GPU)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FMEntXtqLY"}],"key":"e7CqBulRFB"}],"identifier":"id-3-2-lightgbm-usando-hiperparametrizacion-e-is-unbalance-true-gpu","label":"3.2 LightGBM usando Hiperparametrizacion e is_unbalance=True (GPU)","html_id":"id-3-2-lightgbm-usando-hiperparametrizacion-e-is-unbalance-true-gpu","implicit":true,"key":"O9KCIwkpnY"}],"key":"yINCcur2PU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Acto siguiente, vamos a observar cuales fueron las diez features mas importantes por modelo, de forma descendente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H31md6dajv"}],"key":"GzqLivI15R"}],"key":"Y6tNfQgiI0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lgb_final = joblib.load(\"lgb_hp_best.pkl\")\n\nlgb_final\n","key":"Gv7QntH2uN"},{"type":"output","id":"Uvu0Y5QxHF5zX_psJCm-v","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<style>#sk-container-id-11 {\n  /* Definition of color scheme common for light and dark mode */\n  --sklearn-color-text: #000;\n  --sklearn-color-text-muted: #666;\n  --sklearn-color-line: gray;\n  /* Definition of color scheme for unfitted estimators */\n  --sklearn-color-unfitted-level-0: #fff5e6;\n  --sklearn-color-unfitted-level-1: #f6e4d2;\n  --sklearn-color-unfitted-level-2: #ffe0b3;\n  --sklearn-color-unfitted-level-3: chocolate;\n  /* Definition of color scheme for fitted estimators */\n  --sklearn-color-fitted-level-0: #f0f8ff;\n  --sklearn-color-fitted-level-1: #d4ebff;\n  --sklearn-color-fitted-level-2: #b3dbfd;\n  --sklearn-color-fitted-level-3: cornflowerblue;\n\n  /* Specific color for light theme */\n  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));\n  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-icon: #696969;\n\n  @media (prefers-color-scheme: dark) {\n    /* Redefinition of color scheme for dark theme */\n    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));\n    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-icon: #878787;\n  }\n}\n\n#sk-container-id-11 {\n  color: var(--sklearn-color-text);\n}\n\n#sk-container-id-11 pre {\n  padding: 0;\n}\n\n#sk-container-id-11 input.sk-hidden--visually {\n  border: 0;\n  clip: rect(1px 1px 1px 1px);\n  clip: rect(1px, 1px, 1px, 1px);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n#sk-container-id-11 div.sk-dashed-wrapped {\n  border: 1px dashed var(--sklearn-color-line);\n  margin: 0 0.4em 0.5em 0.4em;\n  box-sizing: border-box;\n  padding-bottom: 0.4em;\n  background-color: var(--sklearn-color-background);\n}\n\n#sk-container-id-11 div.sk-container {\n  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`\n     but bootstrap.min.css set `[hidden] { display: none !important; }`\n     so we also need the `!important` here to be able to override the\n     default hidden behavior on the sphinx rendered scikit-learn.org.\n     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */\n  display: inline-block !important;\n  position: relative;\n}\n\n#sk-container-id-11 div.sk-text-repr-fallback {\n  display: none;\n}\n\ndiv.sk-parallel-item,\ndiv.sk-serial,\ndiv.sk-item {\n  /* draw centered vertical line to link estimators */\n  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));\n  background-size: 2px 100%;\n  background-repeat: no-repeat;\n  background-position: center center;\n}\n\n/* Parallel-specific style estimator block */\n\n#sk-container-id-11 div.sk-parallel-item::after {\n  content: \"\";\n  width: 100%;\n  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);\n  flex-grow: 1;\n}\n\n#sk-container-id-11 div.sk-parallel {\n  display: flex;\n  align-items: stretch;\n  justify-content: center;\n  background-color: var(--sklearn-color-background);\n  position: relative;\n}\n\n#sk-container-id-11 div.sk-parallel-item {\n  display: flex;\n  flex-direction: column;\n}\n\n#sk-container-id-11 div.sk-parallel-item:first-child::after {\n  align-self: flex-end;\n  width: 50%;\n}\n\n#sk-container-id-11 div.sk-parallel-item:last-child::after {\n  align-self: flex-start;\n  width: 50%;\n}\n\n#sk-container-id-11 div.sk-parallel-item:only-child::after {\n  width: 0;\n}\n\n/* Serial-specific style estimator block */\n\n#sk-container-id-11 div.sk-serial {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background-color: var(--sklearn-color-background);\n  padding-right: 1em;\n  padding-left: 1em;\n}\n\n\n/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is\nclickable and can be expanded/collapsed.\n- Pipeline and ColumnTransformer use this feature and define the default style\n- Estimators will overwrite some part of the style using the `sk-estimator` class\n*/\n\n/* Pipeline and ColumnTransformer style (default) */\n\n#sk-container-id-11 div.sk-toggleable {\n  /* Default theme specific background. It is overwritten whether we have a\n  specific estimator or a Pipeline/ColumnTransformer */\n  background-color: var(--sklearn-color-background);\n}\n\n/* Toggleable label */\n#sk-container-id-11 label.sk-toggleable__label {\n  cursor: pointer;\n  display: flex;\n  width: 100%;\n  margin-bottom: 0;\n  padding: 0.5em;\n  box-sizing: border-box;\n  text-align: center;\n  align-items: start;\n  justify-content: space-between;\n  gap: 0.5em;\n}\n\n#sk-container-id-11 label.sk-toggleable__label .caption {\n  font-size: 0.6rem;\n  font-weight: lighter;\n  color: var(--sklearn-color-text-muted);\n}\n\n#sk-container-id-11 label.sk-toggleable__label-arrow:before {\n  /* Arrow on the left of the label */\n  content: \"‚ñ∏\";\n  float: left;\n  margin-right: 0.25em;\n  color: var(--sklearn-color-icon);\n}\n\n#sk-container-id-11 label.sk-toggleable__label-arrow:hover:before {\n  color: var(--sklearn-color-text);\n}\n\n/* Toggleable content - dropdown */\n\n#sk-container-id-11 div.sk-toggleable__content {\n  max-height: 0;\n  max-width: 0;\n  overflow: hidden;\n  text-align: left;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-11 div.sk-toggleable__content.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-11 div.sk-toggleable__content pre {\n  margin: 0.2em;\n  border-radius: 0.25em;\n  color: var(--sklearn-color-text);\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-11 div.sk-toggleable__content.fitted pre {\n  /* unfitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-11 input.sk-toggleable__control:checked~div.sk-toggleable__content {\n  /* Expand drop-down */\n  max-height: 200px;\n  max-width: 100%;\n  overflow: auto;\n}\n\n#sk-container-id-11 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {\n  content: \"‚ñæ\";\n}\n\n/* Pipeline/ColumnTransformer-specific style */\n\n#sk-container-id-11 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-11 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator-specific style */\n\n/* Colorize estimator box */\n#sk-container-id-11 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-11 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n#sk-container-id-11 div.sk-label label.sk-toggleable__label,\n#sk-container-id-11 div.sk-label label {\n  /* The background is the default theme color */\n  color: var(--sklearn-color-text-on-default-background);\n}\n\n/* On hover, darken the color of the background */\n#sk-container-id-11 div.sk-label:hover label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n/* Label box, darken color on hover, fitted */\n#sk-container-id-11 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator label */\n\n#sk-container-id-11 div.sk-label label {\n  font-family: monospace;\n  font-weight: bold;\n  display: inline-block;\n  line-height: 1.2em;\n}\n\n#sk-container-id-11 div.sk-label-container {\n  text-align: center;\n}\n\n/* Estimator-specific */\n#sk-container-id-11 div.sk-estimator {\n  font-family: monospace;\n  border: 1px dotted var(--sklearn-color-border-box);\n  border-radius: 0.25em;\n  box-sizing: border-box;\n  margin-bottom: 0.5em;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-11 div.sk-estimator.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n/* on hover */\n#sk-container-id-11 div.sk-estimator:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-11 div.sk-estimator.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Specification for estimator info (e.g. \"i\" and \"?\") */\n\n/* Common style for \"i\" and \"?\" */\n\n.sk-estimator-doc-link,\na:link.sk-estimator-doc-link,\na:visited.sk-estimator-doc-link {\n  float: right;\n  font-size: smaller;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1em;\n  height: 1em;\n  width: 1em;\n  text-decoration: none !important;\n  margin-left: 0.5em;\n  text-align: center;\n  /* unfitted */\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n  color: var(--sklearn-color-unfitted-level-1);\n}\n\n.sk-estimator-doc-link.fitted,\na:link.sk-estimator-doc-link.fitted,\na:visited.sk-estimator-doc-link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\ndiv.sk-estimator:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\ndiv.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n/* Span, style for the box shown on hovering the info icon */\n.sk-estimator-doc-link span {\n  display: none;\n  z-index: 9999;\n  position: relative;\n  font-weight: normal;\n  right: .2ex;\n  padding: .5ex;\n  margin: .5ex;\n  width: min-content;\n  min-width: 20ex;\n  max-width: 50ex;\n  color: var(--sklearn-color-text);\n  box-shadow: 2pt 2pt 4pt #999;\n  /* unfitted */\n  background: var(--sklearn-color-unfitted-level-0);\n  border: .5pt solid var(--sklearn-color-unfitted-level-3);\n}\n\n.sk-estimator-doc-link.fitted span {\n  /* fitted */\n  background: var(--sklearn-color-fitted-level-0);\n  border: var(--sklearn-color-fitted-level-3);\n}\n\n.sk-estimator-doc-link:hover span {\n  display: block;\n}\n\n/* \"?\"-specific style due to the `<a>` HTML tag */\n\n#sk-container-id-11 a.estimator_doc_link {\n  float: right;\n  font-size: 1rem;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1rem;\n  height: 1rem;\n  width: 1rem;\n  text-decoration: none;\n  /* unfitted */\n  color: var(--sklearn-color-unfitted-level-1);\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n}\n\n#sk-container-id-11 a.estimator_doc_link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\n#sk-container-id-11 a.estimator_doc_link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n#sk-container-id-11 a.estimator_doc_link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n}\n</style><div id=\"sk-container-id-11\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,\n                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                                  [&#x27;tenure&#x27;,\n                                                   &#x27;charges_monthly&#x27;]),\n                                                 (&#x27;cat&#x27;,\n                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                                  [&#x27;gender&#x27;, &#x27;senior&#x27;,\n                                                   &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                                   &#x27;phone&#x27;, &#x27;phone_multiple&#x27;,\n                                                   &#x27;internet&#x27;,\n                                                   &#x27;internet_security&#x27;,\n                                                   &#x27;internet_backup&#x27;,\n                                                   &#x27;internet_protection&#x27;,\n                                                   &#x27;internet_support&#x27;,\n                                                   &#x27;streaming_tv&#x27;,\n                                                   &#x27;streaming_movies&#x27;,\n                                                   &#x27;contract&#x27;, &#x27;paperless&#x27;,\n                                                   &#x27;payment&#x27;])])),\n                (&#x27;clf&#x27;,\n                 LGBMClassifier(device=&#x27;gpu&#x27;, is_unbalance=True, max_bin=255,\n                                min_child_samples=50, random_state=42,\n                                reg_alpha=0, reg_lambda=0.5, subsample=0.8))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item sk-dashed-wrapped\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-73\" type=\"checkbox\" ><label for=\"sk-estimator-id-73\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>Pipeline</div></div><div><span class=\"sk-estimator-doc-link fitted\">i<span>Fitted</span></span></div></label><div class=\"sk-toggleable__content fitted\"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,\n                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                                  [&#x27;tenure&#x27;,\n                                                   &#x27;charges_monthly&#x27;]),\n                                                 (&#x27;cat&#x27;,\n                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                                  [&#x27;gender&#x27;, &#x27;senior&#x27;,\n                                                   &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                                   &#x27;phone&#x27;, &#x27;phone_multiple&#x27;,\n                                                   &#x27;internet&#x27;,\n                                                   &#x27;internet_security&#x27;,\n                                                   &#x27;internet_backup&#x27;,\n                                                   &#x27;internet_protection&#x27;,\n                                                   &#x27;internet_support&#x27;,\n                                                   &#x27;streaming_tv&#x27;,\n                                                   &#x27;streaming_movies&#x27;,\n                                                   &#x27;contract&#x27;, &#x27;paperless&#x27;,\n                                                   &#x27;payment&#x27;])])),\n                (&#x27;clf&#x27;,\n                 LGBMClassifier(device=&#x27;gpu&#x27;, is_unbalance=True, max_bin=255,\n                                min_child_samples=50, random_state=42,\n                                reg_alpha=0, reg_lambda=0.5, subsample=0.8))])</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item sk-dashed-wrapped\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-74\" type=\"checkbox\" ><label for=\"sk-estimator-id-74\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>preprocessor: ColumnTransformer</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html\">?<span>Documentation for preprocessor: ColumnTransformer</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                 [&#x27;tenure&#x27;, &#x27;charges_monthly&#x27;]),\n                                (&#x27;cat&#x27;, OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                 [&#x27;gender&#x27;, &#x27;senior&#x27;, &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                  &#x27;phone&#x27;, &#x27;phone_multiple&#x27;, &#x27;internet&#x27;,\n                                  &#x27;internet_security&#x27;, &#x27;internet_backup&#x27;,\n                                  &#x27;internet_protection&#x27;, &#x27;internet_support&#x27;,\n                                  &#x27;streaming_tv&#x27;, &#x27;streaming_movies&#x27;,\n                                  &#x27;contract&#x27;, &#x27;paperless&#x27;, &#x27;payment&#x27;])])</pre></div> </div></div><div class=\"sk-parallel\"><div class=\"sk-parallel-item\"><div class=\"sk-item\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-75\" type=\"checkbox\" ><label for=\"sk-estimator-id-75\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>num</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>[&#x27;tenure&#x27;, &#x27;charges_monthly&#x27;]</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-76\" type=\"checkbox\" ><label for=\"sk-estimator-id-76\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>StandardScaler</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html\">?<span>Documentation for StandardScaler</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class=\"sk-parallel-item\"><div class=\"sk-item\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-77\" type=\"checkbox\" ><label for=\"sk-estimator-id-77\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>cat</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>[&#x27;gender&#x27;, &#x27;senior&#x27;, &#x27;partner&#x27;, &#x27;dependents&#x27;, &#x27;phone&#x27;, &#x27;phone_multiple&#x27;, &#x27;internet&#x27;, &#x27;internet_security&#x27;, &#x27;internet_backup&#x27;, &#x27;internet_protection&#x27;, &#x27;internet_support&#x27;, &#x27;streaming_tv&#x27;, &#x27;streaming_movies&#x27;, &#x27;contract&#x27;, &#x27;paperless&#x27;, &#x27;payment&#x27;]</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-78\" type=\"checkbox\" ><label for=\"sk-estimator-id-78\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>OneHotEncoder</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.OneHotEncoder.html\">?<span>Documentation for OneHotEncoder</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-79\" type=\"checkbox\" ><label for=\"sk-estimator-id-79\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>LGBMClassifier</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>LGBMClassifier(device=&#x27;gpu&#x27;, is_unbalance=True, max_bin=255,\n               min_child_samples=50, random_state=42, reg_alpha=0,\n               reg_lambda=0.5, subsample=0.8)</pre></div> </div></div></div></div></div></div>","content_type":"text/html"},"text/plain":{"content":"Pipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num', StandardScaler(),\n                                                  ['tenure',\n                                                   'charges_monthly']),\n                                                 ('cat',\n                                                  OneHotEncoder(handle_unknown='ignore'),\n                                                  ['gender', 'senior',\n                                                   'partner', 'dependents',\n                                                   'phone', 'phone_multiple',\n                                                   'internet',\n                                                   'internet_security',\n                                                   'internet_backup',\n                                                   'internet_protection',\n                                                   'internet_support',\n                                                   'streaming_tv',\n                                                   'streaming_movies',\n                                                   'contract', 'paperless',\n                                                   'payment'])])),\n                ('clf',\n                 LGBMClassifier(device='gpu', is_unbalance=True, max_bin=255,\n                                min_child_samples=50, random_state=42,\n                                reg_alpha=0, reg_lambda=0.5, subsample=0.8))])","content_type":"text/plain"}}}],"key":"iTTDQEgzQv"}],"key":"gmnJSFPX9Y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lgb_model = list(lgb_final.named_steps.values())[-1] \nfeature_names = lgb_final.named_steps[\"preprocessor\"].get_feature_names_out()\nimportances = lgb_model.feature_importances_\n\nfeat_importance = (\n    pd.DataFrame({\"Feature\": feature_names, \"Importance\": importances})\n    .sort_values(by=\"Importance\", ascending=False)\n    .reset_index(drop=True)\n)\n\n\ntop10 = feat_importance.head(10)\n\n\nplt.figure(figsize=(10, 6))\nsns.barplot(data=top10, x=\"Importance\", y=\"Feature\", palette=\"Blues_r\")\nplt.title(\"Top 10 Features m√°s importantes ‚Äî LightGBM + HP + is_unbalance=True\", fontsize=14)\nplt.xlabel(\"Importancia\")\nplt.ylabel(\"Caracter√≠sticas\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()\n","key":"MoYQOD0RfG"},{"type":"output","id":"97soN8zgYDSkZCZYYANB1","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\2406429536.py:16: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(data=top10, x=\"Importance\", y=\"Feature\", palette=\"Blues_r\")\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"90e116729c43692d549876e39fbe755e","path":"/90e116729c43692d549876e39fbe755e.png"},"text/plain":{"content":"<Figure size 1000x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"oTSeNJNaOp"}],"key":"nizf83eTbo"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aqui, los features mas importantes fueron:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Vay6JTPCa3"}],"key":"ZPTBrLOIVH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"num_charges_monthly, num_tenure, cat_payment_Electronic check, cat_dependents_no, cat_internet_security_no","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GXFsENCHll"}],"key":"U9hufxG8cU"}],"key":"fChsrjDWkK"}],"key":"X0htUHH44Q"}],"key":"Fm7m1hU8E3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.2.1 Caso mixto de Churn (i=10)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DZ3JpJ05kY"}],"key":"VcH0n0c1JQ"}],"identifier":"id-3-2-1-caso-mixto-de-churn-i-10","label":"3.2.1 Caso mixto de Churn (i=10)","html_id":"id-3-2-1-caso-mixto-de-churn-i-10","implicit":true,"key":"jxFe5DNb4Q"}],"key":"EbVq7T4S0e"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #10 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XnKWM0ChBf"}],"key":"khIV98HMgu"}],"key":"ZlS4ZW8WZB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = lgb_final.named_steps[\"preprocessor\"]\nclassifier = lgb_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"snKxZl84O6"},{"type":"output","id":"_KT0dGjLhgrAUojRffHL2","data":[],"key":"f8ZknUsag2"}],"key":"alcksOV44S"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 10\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"ovKYatE7fT"},{"type":"output","id":"WTxkljtYoZ07wNFXPlP4k","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #10\n--------------------------------------------------------------------------------\nClase predicha: S√≠ Churn \nProbabilidades -> No: 0.489 | S√≠: 0.511\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                              Caracter√≠stica      Peso\n 0.00 < cat__contract_Month-to-month <= 1.00  0.211945\n                          num__tenure > 0.92 -0.178962\n                 num__charges_monthly > 0.83  0.117772\n              cat__contract_Two year <= 0.00  0.091441\n    0.00 < cat__internet_Fiber optic <= 1.00  0.084710\n           cat__internet_security_No <= 0.00 -0.065589\n0.00 < cat__payment_Electronic check <= 1.00  0.055556\n     0.00 < cat__internet_support_No <= 1.00  0.051176\n           cat__payment_Mailed check <= 0.00  0.029493\n              cat__phone_multiple_No <= 0.00  0.028504\n================================================================================\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\nc:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"}],"key":"vIUQ4sAiY6"}],"key":"aHX2yvtNot"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 10  \nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"Ek1aooxhve"},{"type":"output","id":"nsLFneHAPS5nQ1y3a1_n7","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"d1a06686a61226542f76759127d8233c","path":"/d1a06686a61226542f76759127d8233c.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"vvL4WJr7JB"}],"key":"sSAXPkHhLr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî LightGBM + HP + is_unbalance=True (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"n11aKzvkj5"},{"type":"output","id":"38v4HIjPi-_OSycemziAt","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\2846921519.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"338804a5e278f7743cc9d532d6f5c31a","path":"/338804a5e278f7743cc9d532d6f5c31a.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"SNWKq1syxp"}],"key":"HJStukGWEk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.2.2 Caso positivo de Churn (i=100)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VXsVuFYyhd"}],"key":"aoQkh6A8sP"}],"identifier":"id-3-2-2-caso-positivo-de-churn-i-100","label":"3.2.2 Caso positivo de Churn (i=100)","html_id":"id-3-2-2-caso-positivo-de-churn-i-100","implicit":true,"key":"eyvOIJuHBH"}],"key":"pA5r0lNQWu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #100 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uWDRVGgYnk"}],"key":"nioDTn3pWU"}],"key":"MJKBDm6oA6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = lgb_final.named_steps[\"preprocessor\"]\nclassifier = lgb_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"FbvhT2VGWs"},{"type":"output","id":"6uSUzAv8UoSiNCKnIs2aK","data":[],"key":"XtMxBL18xP"}],"key":"TMbNnpk5aQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 100\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"PfQPImRx2q"},{"type":"output","id":"G91jL6UpSrQ5k5i7HoeOe","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #100\n--------------------------------------------------------------------------------\nClase predicha: S√≠ Churn \nProbabilidades -> No: 0.092 | S√≠: 0.908\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                              Caracter√≠stica      Peso\n 0.00 < cat__contract_Month-to-month <= 1.00  0.214130\n                 num__charges_monthly > 0.83  0.115655\n              cat__contract_Two year <= 0.00  0.102290\n    0.00 < cat__internet_Fiber optic <= 1.00  0.074868\n    0.00 < cat__internet_security_No <= 1.00  0.056041\n     0.00 < cat__internet_support_No <= 1.00  0.053031\n0.00 < cat__payment_Electronic check <= 1.00  0.050408\n                -0.96 < num__tenure <= -0.14  0.038837\n              cat__contract_One year <= 0.00 -0.036699\n           0.00 < cat__dependents_No <= 1.00  0.027543\n================================================================================\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\nc:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"}],"key":"ejslrxMwTN"}],"key":"fVVVm169qy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 100\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"eScE1MW9gh"},{"type":"output","id":"uz59RJhvtzy9dSer0azjP","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"9a4a7aac2ed28859fc7430a299beedba","path":"/9a4a7aac2ed28859fc7430a299beedba.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"rzZwqDtpjv"}],"key":"qpSClAfNfT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî LightGBM + HP + is_unbalance=True (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"aKhmvvYsM8"},{"type":"output","id":"FD0ouRzbEPsRQemFBsJnJ","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\2846921519.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8efcfe615335d4e59aa569e4db7389d4","path":"/8efcfe615335d4e59aa569e4db7389d4.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"wHwCpQzSkz"}],"key":"Nmd4TRMn0A"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.2.3 Caso negativo de Churn (i=500)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ELuVAv0dwJ"}],"key":"ppT04G2Dd3"}],"identifier":"id-3-2-3-caso-negativo-de-churn-i-500","label":"3.2.3 Caso negativo de Churn (i=500)","html_id":"id-3-2-3-caso-negativo-de-churn-i-500","implicit":true,"key":"YXa7kUeF6m"}],"key":"a164qBvu3l"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #500 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"liNuuuwxSt"}],"key":"LbUmyxkxxv"}],"key":"QPKQt3SDD6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = lgb_final.named_steps[\"preprocessor\"]\nclassifier = lgb_final.named_steps[\"clf\"]\n\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"kFN1rluXvL"},{"type":"output","id":"610ST2gTJUMxZgIvWzbB0","data":[],"key":"XwyxHW56HM"}],"key":"V0CROwZo57"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 500\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"IQTiJTJre6"},{"type":"output","id":"cecG5qbvPJ7g61SJEfLKJ","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #500\n--------------------------------------------------------------------------------\nClase predicha: No Churn \nProbabilidades -> No: 0.904 | S√≠: 0.096\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                       Caracter√≠stica      Peso\n cat__contract_Month-to-month <= 0.00 -0.209840\n                   num__tenure > 0.92 -0.164397\n        cat__contract_Two year > 0.00 -0.095385\n    cat__internet_Fiber optic <= 0.00 -0.082338\n    cat__internet_security_No <= 0.00 -0.064800\ncat__payment_Electronic check <= 0.00 -0.055262\n        num__charges_monthly <= -0.97 -0.054454\n     cat__internet_support_No <= 0.00 -0.053411\n       cat__contract_One year <= 0.00 -0.034037\n    0.00 < cat__paperless_Yes <= 1.00  0.033337\n================================================================================\n"},{"name":"stderr","output_type":"stream","text":"c:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\nc:\\Users\\taran\\miniconda3\\envs\\gpu_venv\\lib\\site-packages\\sklearn\\utils\\validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n  warnings.warn(\n"}],"key":"bV1kOihMJz"}],"key":"OqlWyhzWrI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 500\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"BDo6G56gro"},{"type":"output","id":"TQw8sLn6KzCmmRMzqokw6","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"c079b9767772b9330a05c469ef3739f6","path":"/c079b9767772b9330a05c469ef3739f6.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"any0W8APK5"}],"key":"v6Vfv5lGkr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî LightGBM + HP + is_unbalance=True (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"j1r6iBAaLm"},{"type":"output","id":"pk1tFIbwIWs2Yuaolwasn","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\2846921519.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8a0c384d45ad718a0ec28f0e43bfb49e","path":"/8a0c384d45ad718a0ec28f0e43bfb49e.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"vd06uJRklr"}],"key":"lDgl4lBfs9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.3 RandomForest usando Hiperparametrizacion y SMOTE (GPU)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qx3gKQ9AfX"}],"key":"OLRJ9zLLdP"}],"identifier":"id-3-3-randomforest-usando-hiperparametrizacion-y-smote-gpu","label":"3.3 RandomForest usando Hiperparametrizacion y SMOTE (GPU)","html_id":"id-3-3-randomforest-usando-hiperparametrizacion-y-smote-gpu","implicit":true,"key":"aa6h9DUB1G"}],"key":"vxhIigDAx1"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Acto siguiente, vamos a observar cuales fueron las diez features mas importantes por modelo, de forma descendente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VjkqsqGnVq"}],"key":"AcpbtL17MR"}],"key":"UGPG4067mp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"rf_final = joblib.load(\"rf_smote_best.pkl\")\n\nrf_final\n","key":"mAfTDBKILI"},{"type":"output","id":"X-i0tMdHF7HAvCgpFpj0w","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<style>#sk-container-id-12 {\n  /* Definition of color scheme common for light and dark mode */\n  --sklearn-color-text: #000;\n  --sklearn-color-text-muted: #666;\n  --sklearn-color-line: gray;\n  /* Definition of color scheme for unfitted estimators */\n  --sklearn-color-unfitted-level-0: #fff5e6;\n  --sklearn-color-unfitted-level-1: #f6e4d2;\n  --sklearn-color-unfitted-level-2: #ffe0b3;\n  --sklearn-color-unfitted-level-3: chocolate;\n  /* Definition of color scheme for fitted estimators */\n  --sklearn-color-fitted-level-0: #f0f8ff;\n  --sklearn-color-fitted-level-1: #d4ebff;\n  --sklearn-color-fitted-level-2: #b3dbfd;\n  --sklearn-color-fitted-level-3: cornflowerblue;\n\n  /* Specific color for light theme */\n  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));\n  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-icon: #696969;\n\n  @media (prefers-color-scheme: dark) {\n    /* Redefinition of color scheme for dark theme */\n    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));\n    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-icon: #878787;\n  }\n}\n\n#sk-container-id-12 {\n  color: var(--sklearn-color-text);\n}\n\n#sk-container-id-12 pre {\n  padding: 0;\n}\n\n#sk-container-id-12 input.sk-hidden--visually {\n  border: 0;\n  clip: rect(1px 1px 1px 1px);\n  clip: rect(1px, 1px, 1px, 1px);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n#sk-container-id-12 div.sk-dashed-wrapped {\n  border: 1px dashed var(--sklearn-color-line);\n  margin: 0 0.4em 0.5em 0.4em;\n  box-sizing: border-box;\n  padding-bottom: 0.4em;\n  background-color: var(--sklearn-color-background);\n}\n\n#sk-container-id-12 div.sk-container {\n  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`\n     but bootstrap.min.css set `[hidden] { display: none !important; }`\n     so we also need the `!important` here to be able to override the\n     default hidden behavior on the sphinx rendered scikit-learn.org.\n     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */\n  display: inline-block !important;\n  position: relative;\n}\n\n#sk-container-id-12 div.sk-text-repr-fallback {\n  display: none;\n}\n\ndiv.sk-parallel-item,\ndiv.sk-serial,\ndiv.sk-item {\n  /* draw centered vertical line to link estimators */\n  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));\n  background-size: 2px 100%;\n  background-repeat: no-repeat;\n  background-position: center center;\n}\n\n/* Parallel-specific style estimator block */\n\n#sk-container-id-12 div.sk-parallel-item::after {\n  content: \"\";\n  width: 100%;\n  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);\n  flex-grow: 1;\n}\n\n#sk-container-id-12 div.sk-parallel {\n  display: flex;\n  align-items: stretch;\n  justify-content: center;\n  background-color: var(--sklearn-color-background);\n  position: relative;\n}\n\n#sk-container-id-12 div.sk-parallel-item {\n  display: flex;\n  flex-direction: column;\n}\n\n#sk-container-id-12 div.sk-parallel-item:first-child::after {\n  align-self: flex-end;\n  width: 50%;\n}\n\n#sk-container-id-12 div.sk-parallel-item:last-child::after {\n  align-self: flex-start;\n  width: 50%;\n}\n\n#sk-container-id-12 div.sk-parallel-item:only-child::after {\n  width: 0;\n}\n\n/* Serial-specific style estimator block */\n\n#sk-container-id-12 div.sk-serial {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background-color: var(--sklearn-color-background);\n  padding-right: 1em;\n  padding-left: 1em;\n}\n\n\n/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is\nclickable and can be expanded/collapsed.\n- Pipeline and ColumnTransformer use this feature and define the default style\n- Estimators will overwrite some part of the style using the `sk-estimator` class\n*/\n\n/* Pipeline and ColumnTransformer style (default) */\n\n#sk-container-id-12 div.sk-toggleable {\n  /* Default theme specific background. It is overwritten whether we have a\n  specific estimator or a Pipeline/ColumnTransformer */\n  background-color: var(--sklearn-color-background);\n}\n\n/* Toggleable label */\n#sk-container-id-12 label.sk-toggleable__label {\n  cursor: pointer;\n  display: flex;\n  width: 100%;\n  margin-bottom: 0;\n  padding: 0.5em;\n  box-sizing: border-box;\n  text-align: center;\n  align-items: start;\n  justify-content: space-between;\n  gap: 0.5em;\n}\n\n#sk-container-id-12 label.sk-toggleable__label .caption {\n  font-size: 0.6rem;\n  font-weight: lighter;\n  color: var(--sklearn-color-text-muted);\n}\n\n#sk-container-id-12 label.sk-toggleable__label-arrow:before {\n  /* Arrow on the left of the label */\n  content: \"‚ñ∏\";\n  float: left;\n  margin-right: 0.25em;\n  color: var(--sklearn-color-icon);\n}\n\n#sk-container-id-12 label.sk-toggleable__label-arrow:hover:before {\n  color: var(--sklearn-color-text);\n}\n\n/* Toggleable content - dropdown */\n\n#sk-container-id-12 div.sk-toggleable__content {\n  max-height: 0;\n  max-width: 0;\n  overflow: hidden;\n  text-align: left;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-12 div.sk-toggleable__content.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-12 div.sk-toggleable__content pre {\n  margin: 0.2em;\n  border-radius: 0.25em;\n  color: var(--sklearn-color-text);\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-12 div.sk-toggleable__content.fitted pre {\n  /* unfitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-12 input.sk-toggleable__control:checked~div.sk-toggleable__content {\n  /* Expand drop-down */\n  max-height: 200px;\n  max-width: 100%;\n  overflow: auto;\n}\n\n#sk-container-id-12 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {\n  content: \"‚ñæ\";\n}\n\n/* Pipeline/ColumnTransformer-specific style */\n\n#sk-container-id-12 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-12 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator-specific style */\n\n/* Colorize estimator box */\n#sk-container-id-12 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-12 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n#sk-container-id-12 div.sk-label label.sk-toggleable__label,\n#sk-container-id-12 div.sk-label label {\n  /* The background is the default theme color */\n  color: var(--sklearn-color-text-on-default-background);\n}\n\n/* On hover, darken the color of the background */\n#sk-container-id-12 div.sk-label:hover label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n/* Label box, darken color on hover, fitted */\n#sk-container-id-12 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator label */\n\n#sk-container-id-12 div.sk-label label {\n  font-family: monospace;\n  font-weight: bold;\n  display: inline-block;\n  line-height: 1.2em;\n}\n\n#sk-container-id-12 div.sk-label-container {\n  text-align: center;\n}\n\n/* Estimator-specific */\n#sk-container-id-12 div.sk-estimator {\n  font-family: monospace;\n  border: 1px dotted var(--sklearn-color-border-box);\n  border-radius: 0.25em;\n  box-sizing: border-box;\n  margin-bottom: 0.5em;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-12 div.sk-estimator.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n/* on hover */\n#sk-container-id-12 div.sk-estimator:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-12 div.sk-estimator.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Specification for estimator info (e.g. \"i\" and \"?\") */\n\n/* Common style for \"i\" and \"?\" */\n\n.sk-estimator-doc-link,\na:link.sk-estimator-doc-link,\na:visited.sk-estimator-doc-link {\n  float: right;\n  font-size: smaller;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1em;\n  height: 1em;\n  width: 1em;\n  text-decoration: none !important;\n  margin-left: 0.5em;\n  text-align: center;\n  /* unfitted */\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n  color: var(--sklearn-color-unfitted-level-1);\n}\n\n.sk-estimator-doc-link.fitted,\na:link.sk-estimator-doc-link.fitted,\na:visited.sk-estimator-doc-link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\ndiv.sk-estimator:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\ndiv.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n/* Span, style for the box shown on hovering the info icon */\n.sk-estimator-doc-link span {\n  display: none;\n  z-index: 9999;\n  position: relative;\n  font-weight: normal;\n  right: .2ex;\n  padding: .5ex;\n  margin: .5ex;\n  width: min-content;\n  min-width: 20ex;\n  max-width: 50ex;\n  color: var(--sklearn-color-text);\n  box-shadow: 2pt 2pt 4pt #999;\n  /* unfitted */\n  background: var(--sklearn-color-unfitted-level-0);\n  border: .5pt solid var(--sklearn-color-unfitted-level-3);\n}\n\n.sk-estimator-doc-link.fitted span {\n  /* fitted */\n  background: var(--sklearn-color-fitted-level-0);\n  border: var(--sklearn-color-fitted-level-3);\n}\n\n.sk-estimator-doc-link:hover span {\n  display: block;\n}\n\n/* \"?\"-specific style due to the `<a>` HTML tag */\n\n#sk-container-id-12 a.estimator_doc_link {\n  float: right;\n  font-size: 1rem;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1rem;\n  height: 1rem;\n  width: 1rem;\n  text-decoration: none;\n  /* unfitted */\n  color: var(--sklearn-color-unfitted-level-1);\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n}\n\n#sk-container-id-12 a.estimator_doc_link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\n#sk-container-id-12 a.estimator_doc_link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n#sk-container-id-12 a.estimator_doc_link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n}\n</style><div id=\"sk-container-id-12\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,\n                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                                  [&#x27;tenure&#x27;,\n                                                   &#x27;charges_monthly&#x27;]),\n                                                 (&#x27;cat&#x27;,\n                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                                  [&#x27;gender&#x27;, &#x27;senior&#x27;,\n                                                   &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                                   &#x27;phone&#x27;, &#x27;phone_multiple&#x27;,\n                                                   &#x27;internet&#x27;,\n                                                   &#x27;internet_security&#x27;,\n                                                   &#x27;internet_backup&#x27;,\n                                                   &#x27;internet_protection&#x27;,\n                                                   &#x27;internet_support&#x27;,\n                                                   &#x27;streaming_tv&#x27;,\n                                                   &#x27;streaming_movies&#x27;,\n                                                   &#x27;contract&#x27;, &#x27;paperless&#x27;,\n                                                   &#x27;payment&#x27;])])),\n                (&#x27;smote&#x27;, SMOTE(random_state=42)),\n                (&#x27;clf&#x27;,\n                 RandomForestClassifier(max_features=&#x27;log2&#x27;, min_samples_leaf=4,\n                                        random_state=42))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item sk-dashed-wrapped\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-80\" type=\"checkbox\" ><label for=\"sk-estimator-id-80\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>Pipeline</div></div><div><span class=\"sk-estimator-doc-link fitted\">i<span>Fitted</span></span></div></label><div class=\"sk-toggleable__content fitted\"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,\n                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                                  [&#x27;tenure&#x27;,\n                                                   &#x27;charges_monthly&#x27;]),\n                                                 (&#x27;cat&#x27;,\n                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                                  [&#x27;gender&#x27;, &#x27;senior&#x27;,\n                                                   &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                                   &#x27;phone&#x27;, &#x27;phone_multiple&#x27;,\n                                                   &#x27;internet&#x27;,\n                                                   &#x27;internet_security&#x27;,\n                                                   &#x27;internet_backup&#x27;,\n                                                   &#x27;internet_protection&#x27;,\n                                                   &#x27;internet_support&#x27;,\n                                                   &#x27;streaming_tv&#x27;,\n                                                   &#x27;streaming_movies&#x27;,\n                                                   &#x27;contract&#x27;, &#x27;paperless&#x27;,\n                                                   &#x27;payment&#x27;])])),\n                (&#x27;smote&#x27;, SMOTE(random_state=42)),\n                (&#x27;clf&#x27;,\n                 RandomForestClassifier(max_features=&#x27;log2&#x27;, min_samples_leaf=4,\n                                        random_state=42))])</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item sk-dashed-wrapped\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-81\" type=\"checkbox\" ><label for=\"sk-estimator-id-81\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>preprocessor: ColumnTransformer</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html\">?<span>Documentation for preprocessor: ColumnTransformer</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                 [&#x27;tenure&#x27;, &#x27;charges_monthly&#x27;]),\n                                (&#x27;cat&#x27;, OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                 [&#x27;gender&#x27;, &#x27;senior&#x27;, &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                  &#x27;phone&#x27;, &#x27;phone_multiple&#x27;, &#x27;internet&#x27;,\n                                  &#x27;internet_security&#x27;, &#x27;internet_backup&#x27;,\n                                  &#x27;internet_protection&#x27;, &#x27;internet_support&#x27;,\n                                  &#x27;streaming_tv&#x27;, &#x27;streaming_movies&#x27;,\n                                  &#x27;contract&#x27;, &#x27;paperless&#x27;, &#x27;payment&#x27;])])</pre></div> </div></div><div class=\"sk-parallel\"><div class=\"sk-parallel-item\"><div class=\"sk-item\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-82\" type=\"checkbox\" ><label for=\"sk-estimator-id-82\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>num</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>[&#x27;tenure&#x27;, &#x27;charges_monthly&#x27;]</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-83\" type=\"checkbox\" ><label for=\"sk-estimator-id-83\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>StandardScaler</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html\">?<span>Documentation for StandardScaler</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class=\"sk-parallel-item\"><div class=\"sk-item\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-84\" type=\"checkbox\" ><label for=\"sk-estimator-id-84\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>cat</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>[&#x27;gender&#x27;, &#x27;senior&#x27;, &#x27;partner&#x27;, &#x27;dependents&#x27;, &#x27;phone&#x27;, &#x27;phone_multiple&#x27;, &#x27;internet&#x27;, &#x27;internet_security&#x27;, &#x27;internet_backup&#x27;, &#x27;internet_protection&#x27;, &#x27;internet_support&#x27;, &#x27;streaming_tv&#x27;, &#x27;streaming_movies&#x27;, &#x27;contract&#x27;, &#x27;paperless&#x27;, &#x27;payment&#x27;]</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-85\" type=\"checkbox\" ><label for=\"sk-estimator-id-85\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>OneHotEncoder</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.OneHotEncoder.html\">?<span>Documentation for OneHotEncoder</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-86\" type=\"checkbox\" ><label for=\"sk-estimator-id-86\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>SMOTE</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>SMOTE(random_state=42)</pre></div> </div></div><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-87\" type=\"checkbox\" ><label for=\"sk-estimator-id-87\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>RandomForestClassifier</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.RandomForestClassifier.html\">?<span>Documentation for RandomForestClassifier</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>RandomForestClassifier(max_features=&#x27;log2&#x27;, min_samples_leaf=4, random_state=42)</pre></div> </div></div></div></div></div></div>","content_type":"text/html"},"text/plain":{"content":"Pipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num', StandardScaler(),\n                                                  ['tenure',\n                                                   'charges_monthly']),\n                                                 ('cat',\n                                                  OneHotEncoder(handle_unknown='ignore'),\n                                                  ['gender', 'senior',\n                                                   'partner', 'dependents',\n                                                   'phone', 'phone_multiple',\n                                                   'internet',\n                                                   'internet_security',\n                                                   'internet_backup',\n                                                   'internet_protection',\n                                                   'internet_support',\n                                                   'streaming_tv',\n                                                   'streaming_movies',\n                                                   'contract', 'paperless',\n                                                   'payment'])])),\n                ('smote', SMOTE(random_state=42)),\n                ('clf',\n                 RandomForestClassifier(max_features='log2', min_samples_leaf=4,\n                                        random_state=42))])","content_type":"text/plain"}}}],"key":"VyOXgnWcrQ"}],"key":"O0PaW0TEoz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"rf_model = list(rf_final.named_steps.values())[-1] \nfeature_names = rf_final.named_steps[\"preprocessor\"].get_feature_names_out()\nimportances = rf_model.feature_importances_\n\nfeat_importance = (\n    pd.DataFrame({\"Feature\": feature_names, \"Importance\": importances})\n    .sort_values(by=\"Importance\", ascending=False)\n    .reset_index(drop=True)\n)\n\ntop10 = feat_importance.head(10)\n\n\nplt.figure(figsize=(10, 6))\nsns.barplot(data=top10, x=\"Importance\", y=\"Feature\", palette=\"Blues_r\")\nplt.title(\"Top 10 Features m√°s importantes ‚Äî RandomForest + HP + SMOTE\", fontsize=14)\nplt.xlabel(\"Importancia\")\nplt.ylabel(\"Caracter√≠sticas\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()\n","key":"GLhiCcswDs"},{"type":"output","id":"6cHrZrGUJNcI3TZg8fTVD","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\1322585804.py:15: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(data=top10, x=\"Importance\", y=\"Feature\", palette=\"Blues_r\")\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4fd0b5c5f7ed4ba4eb06a038fa10840e","path":"/4fd0b5c5f7ed4ba4eb06a038fa10840e.png"},"text/plain":{"content":"<Figure size 1000x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"YKFntMuUHk"}],"key":"XoYwlXTVUg"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aqui, los features mas importantes fueron:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Emqjnrmxu1"}],"key":"W9IJkAdzMU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"num_tenure, cat_contract_Month-to-month, cat_internet_security_no, cat_contract_Two year, y cat_payment_Electronic check","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sOVZeJRQyc"}],"key":"gtbU69RqSi"}],"key":"CP3KmgeCmy"}],"key":"Ps0MhHJ8rk"}],"key":"LN3tixA6WH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.3.1 Caso mixto de Churn (i=10)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g1oUOZ8kj3"}],"key":"Tk0E1Q7mLS"}],"identifier":"id-3-3-1-caso-mixto-de-churn-i-10","label":"3.3.1 Caso mixto de Churn (i=10)","html_id":"id-3-3-1-caso-mixto-de-churn-i-10","implicit":true,"key":"L2VyYlMEyE"}],"key":"MwDiQ2FumQ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #10 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"U3tI5zG7Y0"}],"key":"efBj6vMYaK"}],"key":"Whlnii5UPn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = rf_final.named_steps[\"preprocessor\"]\nclassifier = rf_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"EQKPdSXFzs"},{"type":"output","id":"xX38ycRH-JlDTcWHgONMp","data":[],"key":"PERXrzIYtD"}],"key":"xZsqeoAJtt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 10\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"snitRBk66y"},{"type":"output","id":"EsNJEImZ-rcHDEVsJUOb3","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #10\n--------------------------------------------------------------------------------\nClase predicha: No Churn \nProbabilidades -> No: 0.784 | S√≠: 0.216\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                              Caracter√≠stica      Peso\n 0.00 < cat__contract_Month-to-month <= 1.00  0.125976\n              cat__contract_Two year <= 0.00  0.112032\n                          num__tenure > 0.92 -0.065256\n    0.00 < cat__internet_Fiber optic <= 1.00  0.055367\n           cat__internet_security_No <= 0.00 -0.049559\n     0.00 < cat__internet_support_No <= 1.00  0.039823\n              cat__contract_One year <= 0.00  0.037018\n0.00 < cat__payment_Electronic check <= 1.00  0.036081\n                   cat__internet_DSL <= 0.00  0.029111\n             cat__internet_backup_No <= 0.00 -0.025897\n================================================================================\n"}],"key":"u7asoOYpE6"}],"key":"vDTzbqiayS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 10  \nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"vEEvUxwyqD"},{"type":"output","id":"0r8U9QXwg0q-JoKDFwXdL","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"4ab0f0948b8190edbf7e0b477dc5cae5","path":"/4ab0f0948b8190edbf7e0b477dc5cae5.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"DQ6svW0OcC"}],"key":"Dvdj72DhxP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî  RandomForest + HP + SMOTE (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"W448mqYuLr"},{"type":"output","id":"Zw6hue00ufMM7sRZE7dKn","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\1000242734.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c5481c3b56e484f65ea70a7fa39bbcc9","path":"/c5481c3b56e484f65ea70a7fa39bbcc9.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"F8ikFpdzcn"}],"key":"oTBKRzsn42"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.3.2 Caso positivo de Churn (i=100)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZdzrfaQa3h"}],"key":"msNV1UzHt4"}],"identifier":"id-3-3-2-caso-positivo-de-churn-i-100","label":"3.3.2 Caso positivo de Churn (i=100)","html_id":"id-3-3-2-caso-positivo-de-churn-i-100","implicit":true,"key":"do97sBmPPo"}],"key":"Z9OKmEJ7UY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #100 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wachV32Jx4"}],"key":"nf3IGuW8dH"}],"key":"ZEH55iAB6U"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = rf_final.named_steps[\"preprocessor\"]\nclassifier = rf_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"KFhOKaCAOf"},{"type":"output","id":"FjjDlnSdqOk0VcUggk_Bb","data":[],"key":"htkZioBF3m"}],"key":"pSRZfmwNBV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 100\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"HjugIDrrCN"},{"type":"output","id":"wTs4mUKAJcJx1d3mEdTi7","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #100\n--------------------------------------------------------------------------------\nClase predicha: S√≠ Churn \nProbabilidades -> No: 0.104 | S√≠: 0.896\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                              Caracter√≠stica      Peso\n 0.00 < cat__contract_Month-to-month <= 1.00  0.127851\n              cat__contract_Two year <= 0.00  0.107441\n    0.00 < cat__internet_Fiber optic <= 1.00  0.057844\n    0.00 < cat__internet_security_No <= 1.00  0.050673\n     0.00 < cat__internet_support_No <= 1.00  0.039019\n              cat__contract_One year <= 0.00  0.037405\n0.00 < cat__payment_Electronic check <= 1.00  0.029534\n                 num__charges_monthly > 0.83  0.025748\n                   cat__internet_DSL <= 0.00  0.025092\n             cat__internet_backup_No <= 0.00 -0.022727\n================================================================================\n"}],"key":"UIgci3YKUR"}],"key":"O3NI2kgv8B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 100\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"rPTJDB0vbY"},{"type":"output","id":"MGPBiE2JTCNiHyj8DIxsw","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"d6075d9fb8e68d2ddbcbee1016a417e3","path":"/d6075d9fb8e68d2ddbcbee1016a417e3.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"JBsoLZOTrR"}],"key":"VMc4wsMKV6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî  RandomForest + HP + SMOTE (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"yTn4B2IJrv"},{"type":"output","id":"wEn05HWcMPHWJ8DDayZop","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\1000242734.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7da25138bf3dc564a9b4998cfc2db22d","path":"/7da25138bf3dc564a9b4998cfc2db22d.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"v6kD82FsdW"}],"key":"MaK8Cm3EbB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.3.3 Caso negativo de Churn (i=500)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"guerLGT0CH"}],"key":"m2nETmvwwk"}],"identifier":"id-3-3-3-caso-negativo-de-churn-i-500","label":"3.3.3 Caso negativo de Churn (i=500)","html_id":"id-3-3-3-caso-negativo-de-churn-i-500","implicit":true,"key":"bnhGv0Kr29"}],"key":"PzAbnqqimm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #500 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bkuAFlQ1eb"}],"key":"tfcRo5HXFE"}],"key":"nW9w3TaZDU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = rf_final.named_steps[\"preprocessor\"]\nclassifier = rf_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"BVUkkVB5Y3"},{"type":"output","id":"p8Z6Csn3Nil9GzDJtDju3","data":[],"key":"BBX8QS2ll7"}],"key":"pzCDYEOAp8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 500\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"kPTm91HqF6"},{"type":"output","id":"ng_1cDKBiscUzik9IckHq","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #500\n--------------------------------------------------------------------------------\nClase predicha: No Churn \nProbabilidades -> No: 0.953 | S√≠: 0.047\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                       Caracter√≠stica      Peso\n cat__contract_Month-to-month <= 0.00 -0.121935\n        cat__contract_Two year > 0.00 -0.111966\n                   num__tenure > 0.92 -0.067853\n    cat__internet_Fiber optic <= 0.00 -0.055226\n    cat__internet_security_No <= 0.00 -0.047913\n     cat__internet_support_No <= 0.00 -0.039761\n       cat__contract_One year <= 0.00  0.034803\ncat__payment_Electronic check <= 0.00 -0.028197\n            cat__internet_DSL <= 0.00  0.027670\n    0.00 < cat__paperless_Yes <= 1.00  0.023012\n================================================================================\n"}],"key":"MofHXOyMAu"}],"key":"pwdVRlOTZx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 500\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"fYFGt3tfuV"},{"type":"output","id":"1OryD2ciQs_j1bwIUV29x","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"621f15963b74caa99f5f3006a28b1fd3","path":"/621f15963b74caa99f5f3006a28b1fd3.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"rmZyZJTitY"}],"key":"QRLkr8CpGK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî RandomForest + HP + SMOTE (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"rwOin2CIw1"},{"type":"output","id":"ZEqCg7yV6KpbV5tLwaeDt","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\1450505222.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bb818e5a5152586b4ad34b03e05c4c16","path":"/bb818e5a5152586b4ad34b03e05c4c16.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"CUlKRf2LQV"}],"key":"fUh1WClHxp"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.4 CatBoost Hiperparametrizado","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mNrFtBH1TU"}],"key":"DRu8FwzAVw"}],"identifier":"id-3-4-catboost-hiperparametrizado","label":"3.4 CatBoost Hiperparametrizado","html_id":"id-3-4-catboost-hiperparametrizado","implicit":true,"key":"G1AORP5HnC"}],"key":"AP3wHQ5SPn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aqui, vamos a primero cargar el modelo.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"niWCQR7b8O"}],"key":"pF4BYC3Uli"}],"key":"LHLz84o1Hk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cat_final = joblib.load(\"cat_hp_best.pkl\")\n\ncat_final","key":"nA0i07UU2L"},{"type":"output","id":"CoiB7I7hyPt2VKMSkmzlq","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<style>#sk-container-id-13 {\n  /* Definition of color scheme common for light and dark mode */\n  --sklearn-color-text: #000;\n  --sklearn-color-text-muted: #666;\n  --sklearn-color-line: gray;\n  /* Definition of color scheme for unfitted estimators */\n  --sklearn-color-unfitted-level-0: #fff5e6;\n  --sklearn-color-unfitted-level-1: #f6e4d2;\n  --sklearn-color-unfitted-level-2: #ffe0b3;\n  --sklearn-color-unfitted-level-3: chocolate;\n  /* Definition of color scheme for fitted estimators */\n  --sklearn-color-fitted-level-0: #f0f8ff;\n  --sklearn-color-fitted-level-1: #d4ebff;\n  --sklearn-color-fitted-level-2: #b3dbfd;\n  --sklearn-color-fitted-level-3: cornflowerblue;\n\n  /* Specific color for light theme */\n  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));\n  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-icon: #696969;\n\n  @media (prefers-color-scheme: dark) {\n    /* Redefinition of color scheme for dark theme */\n    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));\n    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-icon: #878787;\n  }\n}\n\n#sk-container-id-13 {\n  color: var(--sklearn-color-text);\n}\n\n#sk-container-id-13 pre {\n  padding: 0;\n}\n\n#sk-container-id-13 input.sk-hidden--visually {\n  border: 0;\n  clip: rect(1px 1px 1px 1px);\n  clip: rect(1px, 1px, 1px, 1px);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n#sk-container-id-13 div.sk-dashed-wrapped {\n  border: 1px dashed var(--sklearn-color-line);\n  margin: 0 0.4em 0.5em 0.4em;\n  box-sizing: border-box;\n  padding-bottom: 0.4em;\n  background-color: var(--sklearn-color-background);\n}\n\n#sk-container-id-13 div.sk-container {\n  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`\n     but bootstrap.min.css set `[hidden] { display: none !important; }`\n     so we also need the `!important` here to be able to override the\n     default hidden behavior on the sphinx rendered scikit-learn.org.\n     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */\n  display: inline-block !important;\n  position: relative;\n}\n\n#sk-container-id-13 div.sk-text-repr-fallback {\n  display: none;\n}\n\ndiv.sk-parallel-item,\ndiv.sk-serial,\ndiv.sk-item {\n  /* draw centered vertical line to link estimators */\n  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));\n  background-size: 2px 100%;\n  background-repeat: no-repeat;\n  background-position: center center;\n}\n\n/* Parallel-specific style estimator block */\n\n#sk-container-id-13 div.sk-parallel-item::after {\n  content: \"\";\n  width: 100%;\n  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);\n  flex-grow: 1;\n}\n\n#sk-container-id-13 div.sk-parallel {\n  display: flex;\n  align-items: stretch;\n  justify-content: center;\n  background-color: var(--sklearn-color-background);\n  position: relative;\n}\n\n#sk-container-id-13 div.sk-parallel-item {\n  display: flex;\n  flex-direction: column;\n}\n\n#sk-container-id-13 div.sk-parallel-item:first-child::after {\n  align-self: flex-end;\n  width: 50%;\n}\n\n#sk-container-id-13 div.sk-parallel-item:last-child::after {\n  align-self: flex-start;\n  width: 50%;\n}\n\n#sk-container-id-13 div.sk-parallel-item:only-child::after {\n  width: 0;\n}\n\n/* Serial-specific style estimator block */\n\n#sk-container-id-13 div.sk-serial {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background-color: var(--sklearn-color-background);\n  padding-right: 1em;\n  padding-left: 1em;\n}\n\n\n/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is\nclickable and can be expanded/collapsed.\n- Pipeline and ColumnTransformer use this feature and define the default style\n- Estimators will overwrite some part of the style using the `sk-estimator` class\n*/\n\n/* Pipeline and ColumnTransformer style (default) */\n\n#sk-container-id-13 div.sk-toggleable {\n  /* Default theme specific background. It is overwritten whether we have a\n  specific estimator or a Pipeline/ColumnTransformer */\n  background-color: var(--sklearn-color-background);\n}\n\n/* Toggleable label */\n#sk-container-id-13 label.sk-toggleable__label {\n  cursor: pointer;\n  display: flex;\n  width: 100%;\n  margin-bottom: 0;\n  padding: 0.5em;\n  box-sizing: border-box;\n  text-align: center;\n  align-items: start;\n  justify-content: space-between;\n  gap: 0.5em;\n}\n\n#sk-container-id-13 label.sk-toggleable__label .caption {\n  font-size: 0.6rem;\n  font-weight: lighter;\n  color: var(--sklearn-color-text-muted);\n}\n\n#sk-container-id-13 label.sk-toggleable__label-arrow:before {\n  /* Arrow on the left of the label */\n  content: \"‚ñ∏\";\n  float: left;\n  margin-right: 0.25em;\n  color: var(--sklearn-color-icon);\n}\n\n#sk-container-id-13 label.sk-toggleable__label-arrow:hover:before {\n  color: var(--sklearn-color-text);\n}\n\n/* Toggleable content - dropdown */\n\n#sk-container-id-13 div.sk-toggleable__content {\n  max-height: 0;\n  max-width: 0;\n  overflow: hidden;\n  text-align: left;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-13 div.sk-toggleable__content.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-13 div.sk-toggleable__content pre {\n  margin: 0.2em;\n  border-radius: 0.25em;\n  color: var(--sklearn-color-text);\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-13 div.sk-toggleable__content.fitted pre {\n  /* unfitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-13 input.sk-toggleable__control:checked~div.sk-toggleable__content {\n  /* Expand drop-down */\n  max-height: 200px;\n  max-width: 100%;\n  overflow: auto;\n}\n\n#sk-container-id-13 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {\n  content: \"‚ñæ\";\n}\n\n/* Pipeline/ColumnTransformer-specific style */\n\n#sk-container-id-13 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-13 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator-specific style */\n\n/* Colorize estimator box */\n#sk-container-id-13 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-13 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n#sk-container-id-13 div.sk-label label.sk-toggleable__label,\n#sk-container-id-13 div.sk-label label {\n  /* The background is the default theme color */\n  color: var(--sklearn-color-text-on-default-background);\n}\n\n/* On hover, darken the color of the background */\n#sk-container-id-13 div.sk-label:hover label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n/* Label box, darken color on hover, fitted */\n#sk-container-id-13 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator label */\n\n#sk-container-id-13 div.sk-label label {\n  font-family: monospace;\n  font-weight: bold;\n  display: inline-block;\n  line-height: 1.2em;\n}\n\n#sk-container-id-13 div.sk-label-container {\n  text-align: center;\n}\n\n/* Estimator-specific */\n#sk-container-id-13 div.sk-estimator {\n  font-family: monospace;\n  border: 1px dotted var(--sklearn-color-border-box);\n  border-radius: 0.25em;\n  box-sizing: border-box;\n  margin-bottom: 0.5em;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-13 div.sk-estimator.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n/* on hover */\n#sk-container-id-13 div.sk-estimator:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-13 div.sk-estimator.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Specification for estimator info (e.g. \"i\" and \"?\") */\n\n/* Common style for \"i\" and \"?\" */\n\n.sk-estimator-doc-link,\na:link.sk-estimator-doc-link,\na:visited.sk-estimator-doc-link {\n  float: right;\n  font-size: smaller;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1em;\n  height: 1em;\n  width: 1em;\n  text-decoration: none !important;\n  margin-left: 0.5em;\n  text-align: center;\n  /* unfitted */\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n  color: var(--sklearn-color-unfitted-level-1);\n}\n\n.sk-estimator-doc-link.fitted,\na:link.sk-estimator-doc-link.fitted,\na:visited.sk-estimator-doc-link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\ndiv.sk-estimator:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\ndiv.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n/* Span, style for the box shown on hovering the info icon */\n.sk-estimator-doc-link span {\n  display: none;\n  z-index: 9999;\n  position: relative;\n  font-weight: normal;\n  right: .2ex;\n  padding: .5ex;\n  margin: .5ex;\n  width: min-content;\n  min-width: 20ex;\n  max-width: 50ex;\n  color: var(--sklearn-color-text);\n  box-shadow: 2pt 2pt 4pt #999;\n  /* unfitted */\n  background: var(--sklearn-color-unfitted-level-0);\n  border: .5pt solid var(--sklearn-color-unfitted-level-3);\n}\n\n.sk-estimator-doc-link.fitted span {\n  /* fitted */\n  background: var(--sklearn-color-fitted-level-0);\n  border: var(--sklearn-color-fitted-level-3);\n}\n\n.sk-estimator-doc-link:hover span {\n  display: block;\n}\n\n/* \"?\"-specific style due to the `<a>` HTML tag */\n\n#sk-container-id-13 a.estimator_doc_link {\n  float: right;\n  font-size: 1rem;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1rem;\n  height: 1rem;\n  width: 1rem;\n  text-decoration: none;\n  /* unfitted */\n  color: var(--sklearn-color-unfitted-level-1);\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n}\n\n#sk-container-id-13 a.estimator_doc_link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\n#sk-container-id-13 a.estimator_doc_link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n#sk-container-id-13 a.estimator_doc_link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n}\n</style><div id=\"sk-container-id-13\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,\n                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                                  [&#x27;tenure&#x27;,\n                                                   &#x27;charges_monthly&#x27;]),\n                                                 (&#x27;cat&#x27;,\n                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                                  [&#x27;gender&#x27;, &#x27;senior&#x27;,\n                                                   &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                                   &#x27;phone&#x27;, &#x27;phone_multiple&#x27;,\n                                                   &#x27;internet&#x27;,\n                                                   &#x27;internet_security&#x27;,\n                                                   &#x27;internet_backup&#x27;,\n                                                   &#x27;internet_protection&#x27;,\n                                                   &#x27;internet_support&#x27;,\n                                                   &#x27;streaming_tv&#x27;,\n                                                   &#x27;streaming_movies&#x27;,\n                                                   &#x27;contract&#x27;, &#x27;paperless&#x27;,\n                                                   &#x27;payment&#x27;])])),\n                (&#x27;clf&#x27;,\n                 &lt;catboost.core.CatBoostClassifier object at 0x00000233BEA691F0&gt;)])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item sk-dashed-wrapped\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-88\" type=\"checkbox\" ><label for=\"sk-estimator-id-88\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>Pipeline</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html\">?<span>Documentation for Pipeline</span></a><span class=\"sk-estimator-doc-link fitted\">i<span>Fitted</span></span></div></label><div class=\"sk-toggleable__content fitted\"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,\n                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                                  [&#x27;tenure&#x27;,\n                                                   &#x27;charges_monthly&#x27;]),\n                                                 (&#x27;cat&#x27;,\n                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                                  [&#x27;gender&#x27;, &#x27;senior&#x27;,\n                                                   &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                                   &#x27;phone&#x27;, &#x27;phone_multiple&#x27;,\n                                                   &#x27;internet&#x27;,\n                                                   &#x27;internet_security&#x27;,\n                                                   &#x27;internet_backup&#x27;,\n                                                   &#x27;internet_protection&#x27;,\n                                                   &#x27;internet_support&#x27;,\n                                                   &#x27;streaming_tv&#x27;,\n                                                   &#x27;streaming_movies&#x27;,\n                                                   &#x27;contract&#x27;, &#x27;paperless&#x27;,\n                                                   &#x27;payment&#x27;])])),\n                (&#x27;clf&#x27;,\n                 &lt;catboost.core.CatBoostClassifier object at 0x00000233BEA691F0&gt;)])</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item sk-dashed-wrapped\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-89\" type=\"checkbox\" ><label for=\"sk-estimator-id-89\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>preprocessor: ColumnTransformer</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html\">?<span>Documentation for preprocessor: ColumnTransformer</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),\n                                 [&#x27;tenure&#x27;, &#x27;charges_monthly&#x27;]),\n                                (&#x27;cat&#x27;, OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),\n                                 [&#x27;gender&#x27;, &#x27;senior&#x27;, &#x27;partner&#x27;, &#x27;dependents&#x27;,\n                                  &#x27;phone&#x27;, &#x27;phone_multiple&#x27;, &#x27;internet&#x27;,\n                                  &#x27;internet_security&#x27;, &#x27;internet_backup&#x27;,\n                                  &#x27;internet_protection&#x27;, &#x27;internet_support&#x27;,\n                                  &#x27;streaming_tv&#x27;, &#x27;streaming_movies&#x27;,\n                                  &#x27;contract&#x27;, &#x27;paperless&#x27;, &#x27;payment&#x27;])])</pre></div> </div></div><div class=\"sk-parallel\"><div class=\"sk-parallel-item\"><div class=\"sk-item\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-90\" type=\"checkbox\" ><label for=\"sk-estimator-id-90\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>num</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>[&#x27;tenure&#x27;, &#x27;charges_monthly&#x27;]</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-91\" type=\"checkbox\" ><label for=\"sk-estimator-id-91\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>StandardScaler</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html\">?<span>Documentation for StandardScaler</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class=\"sk-parallel-item\"><div class=\"sk-item\"><div class=\"sk-label-container\"><div class=\"sk-label fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-92\" type=\"checkbox\" ><label for=\"sk-estimator-id-92\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>cat</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>[&#x27;gender&#x27;, &#x27;senior&#x27;, &#x27;partner&#x27;, &#x27;dependents&#x27;, &#x27;phone&#x27;, &#x27;phone_multiple&#x27;, &#x27;internet&#x27;, &#x27;internet_security&#x27;, &#x27;internet_backup&#x27;, &#x27;internet_protection&#x27;, &#x27;internet_support&#x27;, &#x27;streaming_tv&#x27;, &#x27;streaming_movies&#x27;, &#x27;contract&#x27;, &#x27;paperless&#x27;, &#x27;payment&#x27;]</pre></div> </div></div><div class=\"sk-serial\"><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-93\" type=\"checkbox\" ><label for=\"sk-estimator-id-93\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>OneHotEncoder</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.OneHotEncoder.html\">?<span>Documentation for OneHotEncoder</span></a></div></label><div class=\"sk-toggleable__content fitted\"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-94\" type=\"checkbox\" ><label for=\"sk-estimator-id-94\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>CatBoostClassifier</div></div></label><div class=\"sk-toggleable__content fitted\"><pre>&lt;catboost.core.CatBoostClassifier object at 0x00000233BEA691F0&gt;</pre></div> </div></div></div></div></div></div>","content_type":"text/html"},"text/plain":{"content":"Pipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num', StandardScaler(),\n                                                  ['tenure',\n                                                   'charges_monthly']),\n                                                 ('cat',\n                                                  OneHotEncoder(handle_unknown='ignore'),\n                                                  ['gender', 'senior',\n                                                   'partner', 'dependents',\n                                                   'phone', 'phone_multiple',\n                                                   'internet',\n                                                   'internet_security',\n                                                   'internet_backup',\n                                                   'internet_protection',\n                                                   'internet_support',\n                                                   'streaming_tv',\n                                                   'streaming_movies',\n                                                   'contract', 'paperless',\n                                                   'payment'])])),\n                ('clf',\n                 <catboost.core.CatBoostClassifier object at 0x00000233BEA691F0>)])","content_type":"text/plain"}}}],"key":"bPUJnW2FGA"}],"key":"oHhsOfQhFo"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Acto siguiente, vamos a observar cuales fueron las diez features mas importantes por modelo, de forma descendente.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OJNlxPS9R4"}],"key":"dvaAaKIjmF"}],"key":"NRXrKOgeeu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cat_model = list(cat_final.named_steps.values())[-1] \nfeature_names = cat_final.named_steps[\"preprocessor\"].get_feature_names_out()\nimportances = cat_model.feature_importances_\n\nfeat_importance = (\n    pd.DataFrame({\"Feature\": feature_names, \"Importance\": importances})\n    .sort_values(by=\"Importance\", ascending=False)\n    .reset_index(drop=True)\n)\n\n\ntop10 = feat_importance.head(10)\n\nplt.figure(figsize=(10, 6))\nsns.barplot(data=top10, x=\"Importance\", y=\"Feature\", palette=\"Blues_r\")\nplt.title(\"Top 10 Features m√°s importantes ‚Äî CatBoost + HP\", fontsize=14)\nplt.xlabel(\"Importancia\")\nplt.ylabel(\"Caracter√≠sticas\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()\n","key":"zBJX6Z1dht"},{"type":"output","id":"eYCXygvwqEI-PH6BBvJ_2","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\777005001.py:15: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(data=top10, x=\"Importance\", y=\"Feature\", palette=\"Blues_r\")\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4d0030455f0b1539aace0f4cc862945f","path":"/4d0030455f0b1539aace0f4cc862945f.png"},"text/plain":{"content":"<Figure size 1000x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"pp5CI4Mosu"}],"key":"Xbckk7PU7y"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aqui, los features mas importantes fueron:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JqfjtQGmhI"}],"key":"BJ1WACjMa0"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"num_tenure, num_charges_monthly, cat_contract_Month-to-month, cat_payment_Electronic check y cat_payment_Back transfor (automatic)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GO9VHuzvcR"}],"key":"fqh8L8Tj7r"}],"key":"wvpRIQwl57"}],"key":"vSDjUnN6BO"}],"key":"xdGGWEmRot"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.3.1 Caso mixto de Churn (i=10)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iB7SiiPziI"}],"key":"rha9zzay0z"}],"identifier":"id-3-3-1-caso-mixto-de-churn-i-10","label":"3.3.1 Caso mixto de Churn (i=10)","html_id":"id-3-3-1-caso-mixto-de-churn-i-10-1","implicit":true,"key":"MuZkwjpYQL"}],"key":"s9dQSCyvQt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #10 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jYKnWNVUAU"}],"key":"Lf2LeiNB1h"}],"key":"PHPsd0RWPX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = cat_final.named_steps[\"preprocessor\"]\nclassifier = cat_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"uF01gDrthh"},{"type":"output","id":"VBwYybMwrWjUXRB1JgYM1","data":[],"key":"cDbfRuei0h"}],"key":"jrYNe4zAtq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 10\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"mmGcDjwPJ4"},{"type":"output","id":"LzCCaQY0kXeMsnLkA7UDg","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #10\n--------------------------------------------------------------------------------\nClase predicha: No Churn \nProbabilidades -> No: 0.894 | S√≠: 0.106\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                             Caracter√≠stica      Peso\n                         num__tenure > 0.92 -0.145752\n0.00 < cat__contract_Month-to-month <= 1.00  0.110127\n             cat__contract_Two year <= 0.00  0.076354\n   0.00 < cat__internet_Fiber optic <= 1.00  0.071606\n                num__charges_monthly > 0.83  0.049091\n    0.00 < cat__internet_support_No <= 1.00  0.037021\n          cat__internet_security_No <= 0.00 -0.031489\n  0.00 < cat__internet_security_Yes <= 1.00 -0.025109\n             cat__phone_multiple_No <= 0.00  0.023661\n                  cat__paperless_No <= 0.00  0.022551\n================================================================================\n"}],"key":"yYVpajkrTT"}],"key":"a883yKPEo6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 10  \nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"dlVu9JNX9Z"},{"type":"output","id":"pP9EzjfDCn9dILNtCmXgS","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"6f8e1592993cb664a95190ba0910d7d7","path":"/6f8e1592993cb664a95190ba0910d7d7.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"Y4wiFDdWUn"}],"key":"B4WQHFf03n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî  CatBoost + HP (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"zzcHx2mIil"},{"type":"output","id":"q4z2NhBbDjMfNBZMMVFAe","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\925539086.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"85f794d674dd63674d16101062aeafc4","path":"/85f794d674dd63674d16101062aeafc4.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"IihOfKEO5B"}],"key":"UuXf2PKZzg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.3.2 Caso positivo de Churn (i=100)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Vclh9n7rYv"}],"key":"AbtHVdiz63"}],"identifier":"id-3-3-2-caso-positivo-de-churn-i-100","label":"3.3.2 Caso positivo de Churn (i=100)","html_id":"id-3-3-2-caso-positivo-de-churn-i-100-1","implicit":true,"key":"YpfJFKZjC5"}],"key":"DBL1gvNFir"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #100 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hf1UA2RVQC"}],"key":"F6HgmagJXP"}],"key":"On4zqYwSaO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = cat_final.named_steps[\"preprocessor\"]\nclassifier = cat_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"SGJ2rPfNDd"},{"type":"output","id":"g2Wmb5sDhHrFFzN4ipZ8q","data":[],"key":"i2K5ihwd2V"}],"key":"SBbH4LKQLr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 100\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"XTn5jAWtai"},{"type":"output","id":"VFWNv5HDfanBCUPSnv_tc","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #100\n--------------------------------------------------------------------------------\nClase predicha: S√≠ Churn \nProbabilidades -> No: 0.242 | S√≠: 0.758\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                             Caracter√≠stica     Peso\n0.00 < cat__contract_Month-to-month <= 1.00 0.103377\n             cat__contract_Two year <= 0.00 0.081688\n   0.00 < cat__internet_Fiber optic <= 1.00 0.072533\n                num__charges_monthly > 0.83 0.057876\n    0.00 < cat__internet_support_No <= 1.00 0.039615\n   0.00 < cat__internet_security_No <= 1.00 0.034392\n             cat__phone_multiple_No <= 0.00 0.030209\n                  cat__paperless_No <= 0.00 0.025841\n             cat__contract_One year <= 0.00 0.024152\n                     cat__senior_Yes > 0.00 0.022402\n================================================================================\n"}],"key":"gcEcOnEH2f"}],"key":"kNnYqr8Tqw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 100\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"G7sbsV6xYO"},{"type":"output","id":"wxZYdLKyp5e4G-8N-VIwq","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"4b311b653566ba28120b6fffbd075ba7","path":"/4b311b653566ba28120b6fffbd075ba7.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"JrI9HYzGRS"}],"key":"ydBBHZcc8D"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî  CatBoost + HP  (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"qP1Bgh9H5d"},{"type":"output","id":"6JCU00f6AQOeVEyncIXy7","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\1968648908.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"09f0cf85d7a6512b19ac67e4a45c5c2a","path":"/09f0cf85d7a6512b19ac67e4a45c5c2a.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"MQ95MUgot4"}],"key":"mlWsYnhWoM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.3.3 Caso negativo de Churn (i=500)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uOBS0lFqpf"}],"key":"gcMeEjvpAc"}],"identifier":"id-3-3-3-caso-negativo-de-churn-i-500","label":"3.3.3 Caso negativo de Churn (i=500)","html_id":"id-3-3-3-caso-negativo-de-churn-i-500-1","implicit":true,"key":"HitquSOh6l"}],"key":"HePwRIlwqW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Para esta seccion, vamos a ver como se compara este modelo con el registro #500 del dataset estudiado, y ver como se comparan los modelos y sus feature importances.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qv67ohP6dN"}],"key":"HG5hAHhNWS"}],"key":"lNKBRreHzW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preprocessor = cat_final.named_steps[\"preprocessor\"]\nclassifier = cat_final.named_steps[\"clf\"]\n\nX_train_trans = preprocessor.transform(X_train)\nX_test_trans = preprocessor.transform(X_test)\nfeature_names = preprocessor.get_feature_names_out()\n\nexplainer = LimeTabularExplainer(\n    training_data=np.array(X_train_trans),\n    feature_names=feature_names,\n    class_names=[\"No Churn\", \"S√≠ Churn\"],\n    mode=\"classification\"\n)","key":"HIAUTGnA2U"},{"type":"output","id":"3QeGP4ZID-MrnMNeOwv58","data":[],"key":"k0v5k4misd"}],"key":"L7oNY3oFIx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 500\n\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=classifier.predict_proba,\n    num_features=10\n)\n\npred_proba = classifier.predict_proba([X_test_trans[i]])[0]\npred_class = np.argmax(pred_proba)\n\nlime_features = exp.as_list()\ndf_lime = pd.DataFrame(lime_features, columns=[\"Caracter√≠stica\", \"Peso\"])\ndf_lime[\"abs_peso\"] = df_lime[\"Peso\"].abs()\ndf_lime = df_lime.sort_values(by=\"abs_peso\", ascending=False).reset_index(drop=True)\n\nprint(\"=\" * 80)\nprint(f\"Interpretaci√≥n LIME ‚Äî Caso #{i}\")\nprint(\"-\" * 80)\nprint(f\"Clase predicha: {'S√≠ Churn ' if pred_class == 1 else 'No Churn '}\")\nprint(f\"Probabilidades -> No: {pred_proba[0]:.3f} | S√≠: {pred_proba[1]:.3f}\")\nprint(\"\\nTop 10 caracter√≠sticas m√°s influyentes:\")\nprint(df_lime[[\"Caracter√≠stica\", \"Peso\"]].to_string(index=False))\nprint(\"=\" * 80)\n","key":"fUPNGZusNo"},{"type":"output","id":"xfozDaWHACg8sUDGUR8Lk","data":[{"name":"stdout","output_type":"stream","text":"================================================================================\nInterpretaci√≥n LIME ‚Äî Caso #500\n--------------------------------------------------------------------------------\nClase predicha: No Churn \nProbabilidades -> No: 0.979 | S√≠: 0.021\n\nTop 10 caracter√≠sticas m√°s influyentes:\n                      Caracter√≠stica      Peso\n                  num__tenure > 0.92 -0.145482\ncat__contract_Month-to-month <= 0.00 -0.105621\n   cat__internet_Fiber optic <= 0.00 -0.074210\n       cat__contract_Two year > 0.00 -0.072053\n       num__charges_monthly <= -0.97 -0.044454\n    cat__internet_support_No <= 0.00 -0.037209\n      cat__contract_One year <= 0.00  0.031873\n   cat__internet_security_No <= 0.00 -0.031306\n      cat__phone_multiple_No <= 0.00  0.027877\n           cat__internet_DSL <= 0.00  0.024821\n================================================================================\n"}],"key":"bT3hE8U14w"}],"key":"wambg0jOsE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = 500\nexp = explainer.explain_instance(\n    data_row=X_test_trans[i],\n    predict_fn=xgb_model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook(show_table=True)","key":"cvdw2lxCM5"},{"type":"output","id":"1_ail1SSdeatfsjHQWXne","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"7b7b99f0634176fecf27ef7a71002fdc","path":"/7b7b99f0634176fecf27ef7a71002fdc.html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"key":"nsFC3qMssT"}],"key":"OnehacTkG2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(8, 6))\ncolors = [\"#d62728\" if w > 0 else \"#1f77b4\" for w in df_lime[\"Peso\"]]\n\nsns.barplot(\n    data=df_lime.sort_values(by=\"Peso\", ascending=True),\n    x=\"Peso\",\n    y=\"Caracter√≠stica\",\n    palette=colors\n)\n\nplt.title(f\"LIME ‚Äî CatBoost + HP (Caso #{i})\", fontsize=13)\nplt.xlabel(\"Impacto en la predicci√≥n (Peso)\")\nplt.ylabel(\"\")\nplt.grid(axis=\"x\", linestyle=\"--\", alpha=0.6)\nplt.tight_layout()\nplt.show()","key":"ibkAQ9IBRq"},{"type":"output","id":"03uYSdPjI8RwUPo2Xdsma","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\2794980300.py:4: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"950dff41f36cfaecbcdc80b54c0b7624","path":"/950dff41f36cfaecbcdc80b54c0b7624.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"E3LmRW8Hn3"}],"key":"mL8aWOetSK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.5 Comparacion final entre modelos","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"njqVKxGLaU"}],"key":"wtziNF3RN5"}],"identifier":"id-3-5-comparacion-final-entre-modelos","label":"3.5 Comparacion final entre modelos","html_id":"id-3-5-comparacion-final-entre-modelos","implicit":true,"key":"hIf1yyVU2L"}],"key":"ZK3YdJic1s"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"models = {\n    \"XGBoost + HP\": pipe_xgb,\n    \"LightGBM + HP + is_unbalanced=True (GPU)\": pipe_lgb,\n    \"RandomForest + HP + SMOTE (GPU)\": pipe_rf,\n    \"CatBoost + HP\": pipe_cat\n}\n\nfeature_orig = X_train.columns\n","key":"h5G0iepu6i"},{"type":"output","id":"HFjZpDllvIOMefba6P5qp","data":[],"key":"nQW4xSqPnr"}],"key":"tPWqgAYLDk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"models_fitted = {\n    \"XGBoost + HP\": grid_xgb.best_estimator_,\n    \"LightGBM + HP + is_unbalanced=True (GPU)\": grid_lgb.best_estimator_,\n    \"RandomForest + HP + SMOTE (GPU)\": grid_rf.best_estimator_,\n    \"CatBoost + HP\": grid_cat.best_estimator_\n}\n","key":"tfLVwyfZLS"},{"type":"output","id":"Ai4AcKS3uxXhvWAu9SsR2","data":[],"key":"Dq2TxElHt2"}],"key":"tlDTSwv2k3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"feature_importances = {}\n\nfor name, pipe in models_fitted.items():\n    feature_names = pipe.named_steps[\"preprocessor\"].get_feature_names_out()\n    clf = pipe.named_steps[\"clf\"]\n\n    if hasattr(clf, \"feature_importances_\"):\n        importances = clf.feature_importances_\n    elif \"CatBoost\" in name:\n        importances = clf.get_feature_importance()\n    else:\n        importances = np.zeros(len(feature_names))\n\n    df_imp = pd.DataFrame({\n        \"Feature\": feature_names,\n        \"Importance\": importances\n    }).sort_values(\"Importance\", ascending=False).reset_index(drop=True)\n\n    feature_importances[name] = df_imp\n","key":"KjgVfw9yks"},{"type":"output","id":"AfYVAM1_fRNbTT2efxSCO","data":[],"key":"t1Tqbvzub1"}],"key":"WzcADi1NXm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\nplt.figure(figsize=(18, 12))\nfor i, (name, df_imp) in enumerate(feature_importances.items(), 1):\n    plt.subplot(2, 2, i)\n    top10 = df_imp.head(10)\n    sns.barplot(\n        data=top10.sort_values(\"Importance\", ascending=True),\n        x=\"Importance\",\n        y=\"Feature\",\n        palette=\"Blues\"\n    )\n    plt.title(f\"Top 10 Features ‚Äî {name}\", fontsize=12)\n    plt.xlabel(\"Importancia\")\n    plt.ylabel(\"\")\n    plt.grid(axis=\"x\", linestyle=\"--\", alpha=0.5)\n\nplt.tight_layout()\nplt.show()\n","key":"N7rwe2tIMH"},{"type":"output","id":"A3k0IGACMZqbxjQWlkJGE","data":[{"name":"stderr","output_type":"stream","text":"C:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3630990556.py:5: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\nC:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3630990556.py:5: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\nC:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3630990556.py:5: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\nC:\\Users\\taran\\AppData\\Local\\Temp\\ipykernel_19104\\3630990556.py:5: FutureWarning: \n\nPassing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.\n\n  sns.barplot(\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7025d766b66e79f3ee798d2371f61572","path":"/7025d766b66e79f3ee798d2371f61572.png"},"text/plain":{"content":"<Figure size 1800x1200 with 4 Axes>","content_type":"text/plain"}}}],"key":"PD9PtBiZtL"}],"key":"Jkip9QMzFE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"top_n = 21  \nall_features = set()\n\nfor df in feature_importances.values():\n    all_features.update(df.head(top_n)[\"Feature\"].tolist())\n\nall_features = list(all_features)\n\nheatmap_df = pd.DataFrame(index=all_features)\n\nfor name, df in feature_importances.items():\n    temp = df.set_index(\"Feature\")[\"Importance\"]\n    heatmap_df[name] = temp\n\nheatmap_df = heatmap_df.fillna(0)\n\nheatmap_norm = heatmap_df / heatmap_df.max()\n\nplt.figure(figsize=(12, 10))\nsns.heatmap(\n    heatmap_norm, \n    annot=True, \n    cmap=\"Blues\", \n    cbar_kws={'label': 'Importancia relativa'}, \n    linewidths=0.5\n)\nplt.title(\"Comparaci√≥n de Feature Importances - Top Features\", fontsize=16)\nplt.ylabel(\"Caracter√≠sticas\")\nplt.xlabel(\"Modelo\")\nplt.tight_layout()\nplt.show()\n","key":"ylieLURRry"},{"type":"output","id":"tpmCjRaeg_n1eqP_c6Glg","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"154badfd41ea7d2058758bb55a4c5835","path":"/154badfd41ea7d2058758bb55a4c5835.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}}],"key":"M9mBFMtHo8"}],"key":"vHH0VsduXW"}],"key":"X2OVgjI1rQ"},"references":{"cite":{"order":[],"data":{}}}}